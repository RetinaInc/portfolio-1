var app=angular.module("ng-portfolio",["ui.router","ui.bootstrap","ngTable","hc.marked","ngTagsInput"]);app.config(function($httpProvider){$httpProvider.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"});app.config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/dashboard");$stateProvider.state("dashboard",{url:"/dashboard",templateUrl:"/vendor/portfolio/admin/views/dashboard.html",controller:"DashboardController"}).state("project",{url:"/project",templateUrl:"/vendor/portfolio/admin/views/project/project.html"}).state("project.index",{url:"/index",templateUrl:"/vendor/portfolio/admin/views/project/project.index.html",controller:"ProjectController"}).state("project.create",{url:"/create",templateUrl:"/vendor/portfolio/admin/views/project/project.edit.html",controller:"ProjectCreateController"}).state("project.edit",{url:"/:id/edit",templateUrl:"/vendor/portfolio/admin/views/project/project.edit.html",controller:"ProjectEditController"}).state("project-section",{url:"/project/:id/section",templateUrl:"/vendor/portfolio/admin/views/project/project.section.index.html",controller:"ProjectSectionController"}).state("section-edit",{url:"/section/:id/edit",templateUrl:"/vendor/portfolio/admin/views/section/section.edit.html",controller:"SectionEditController"}).state("tag",{url:"/tag",templateUrl:"/vendor/portfolio/admin/views/tag/tag.html"}).state("tag.index",{url:"/index",templateUrl:"/vendor/portfolio/admin/views/tag/tag.index.html",controller:"TagController"}).state("tag.create",{url:"/create",templateUrl:"/vendor/portfolio/admin/views/tag/tag.edit.html",controller:"TagCreateController"}).state("tag.edit",{url:"/:id/edit",templateUrl:"/vendor/portfolio/admin/views/tag/tag.edit.html",controller:"TagEditController"})});app.config(["markedProvider",function(markedProvider){markedProvider.setOptions({gfm:true,tables:true})}]);app.factory("RestfulApi",function($http,notificationService){var checkResponseCode=function(data,status){switch(status){case 422:notificationService.clear();var msg=[];angular.forEach(data,function(value,key){msg=msg.concat(value)});notificationService.add("Validation failed, please correct the following issues:","danger",msg);break;case 401:notificationService.add("You have been logged out","warning");break;case 500:notificationService.add("API error","danger");break;default:console.log("Some other problem!");console.log(data)}};return{getRoute:function(resource,method,id){if(typeof id==="undefined"){id="0"}var prefix="/admin/api";var routes={project:{index:prefix+"/project",show:prefix+"/project/"+id,store:prefix+"/project",update:prefix+"/project/"+id,destroy:prefix+"/project/"+id},section:{index:prefix+"/section",show:prefix+"/section/"+id,store:prefix+"/section",update:prefix+"/section/"+id,destroy:prefix+"/section/"+id},projectSection:{store:prefix+"/project/"+id+"/section"},tag:{index:prefix+"/tag",show:prefix+"/tag/"+id,store:prefix+"/tag",update:prefix+"/tag/"+id,destroy:prefix+"/tag/"+id}};return routes[resource][method]},success:function(data,status,headers,config){notificationService.removeByType("danger");return data},error:function(data,status,headers,config){checkResponseCode(data,status);return data}}});app.service("notificationService",function($timeout){var notifications=[];this.get=function(){return notifications};this.add=function(message,type,messages){if(type=="success"){this.removeByType("success")}var notification={type:type,message:message,messages:messages};notifications.push(notification);console.log("added "+type+" message");if(type!="danger"){$timeout(function(){notifications.splice(notifications.indexOf(notification),1)},6e3)}};this.removeByIndex=function(index){console.log("removing one message: "+index);notifications.splice(index,1)};this.removeByType=function(type){console.log("clearing "+type+" messages");for(i=0;i<notifications.length;i++){if(notifications[i].type==type){notifications.splice(i,1)}}};this.clear=function(){console.log("clearing all messages");notifications=[]}});app.controller("NotificationController",function($scope,notificationService,$timeout){$scope.notifier=notificationService;$scope.$watch("notifier.get()",function(notifications){if(angular.isDefined(notifications)){$scope.notifications=notifications}},true);$scope.closeNotification=function(index){notificationService.removeByIndex(index)}});app.controller("DashboardController",function($scope,$http,$stateParams){});app.controller("ProjectController",function($scope,$filter,ngTableParams,$http,RestfulApi,notificationService){$scope.data=[];$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{updated_at:"desc"}},{filterDelay:10,total:$scope.data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data;var orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length);$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}});$scope.init=function(){$http.get(RestfulApi.getRoute("project","index")).success(function(data,status,headers,config){RestfulApi.success(data,status,headers,config);$scope.data=data;$scope.tableParams.reload()}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config)})};$scope.delete=function(id,title){if(confirm("Are you sure you wish to delete "+title+"?")){$http.delete("/admin/api/project/"+id).success(function(data,status,headers,config){notificationService.add("Project '"+data.title+"' deleted successfully","info");$scope.init()}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config);$scope.errors=data})}};$scope.init()});app.controller("ProjectCreateController",function($scope,$http,$stateParams,$state,RestfulApi,notificationService){$scope.data={};$scope.create=true;$scope.save=function(apply){$http.post(RestfulApi.getRoute("project","store"),$scope.data).success(function(data,status,headers,config){RestfulApi.success(data,status,headers,config);notificationService.add("Project '"+data.title+"' added successfully","success");$scope.errors=[];if(!apply){$state.go("project.index")}else{$state.go("project.edit",{id:data.id})}}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config);$scope.errors=data})}});app.controller("ProjectEditController",function($scope,$http,$stateParams,$state,RestfulApi,notificationService,ngTableParams,$filter,$modal){$scope.data={sections:[]};$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{updated_at:"desc"}},{filterDelay:10,total:$scope.data.sections.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data.sections,params.filter()):$scope.data.sections;var orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data.sections;params.total(orderedData.length);$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}});$http.get(RestfulApi.getRoute("project","show",$stateParams.id)).success(function(data,status,headers,config){RestfulApi.success(data,status,headers,config);$scope.data=data;$scope.slug=$scope.data.slug;$scope.tableParams.reload()}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config);$scope.errors=data});$scope.editSection=function(create,sectionId){sectionId=typeof sectionId!=="undefined"?sectionId:false;modalData={create:create,projectId:$scope.data.id,sectionId:sectionId};console.log(modalData);var modalInstance=$modal.open({animation:true,templateUrl:"sectionEdit.html",controller:"editSectionController",size:"lg",resolve:{modalData:function(){return modalData}}});modalInstance.result.then(function(section,create){if(create){$scope.data.sections.push(section)}else{angular.forEach($scope.data.sections,function(value,key){if(value.id==sectionId){$scope.data.sections[value.id]=section}})}$scope.tableParams.reload()},function(){})};$scope.slugWarning=function(){notificationService.removeByType("warning");if($scope.slug!=$scope.data.slug){notificationService.add("You have modified the project slug. Please be aware that this may break hyperlinks to this project.","warning")}};$scope.save=function(apply){apply=typeof apply!=="undefined"?apply:false;if($scope.slug!=$scope.data.slug){if(confirm("Are you sure you wish to change the slug?")){$scope.put(apply)}else{$scope.data.slug=$scope.slug;notificationService.removeByType("warning");notificationService.add("Slug reset","info")}}else{$scope.put(apply)}};$scope.put=function(apply){$http.put(RestfulApi.getRoute("project","update",$stateParams.id),$scope.data).success(function(data,status,headers,config){RestfulApi.success(data,status,headers,config);notificationService.add("Project '"+data.title+"' updated successfully","success");$scope.errors=[];if(!apply){$state.go("project.index")}}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config);$scope.errors=data})}});app.controller("editSectionController",function($scope,$http,$modalInstance,RestfulApi,notificationService,modalData){if(!modalData.create){$http.get(RestfulApi.getRoute("section","show",modalData.sectionId)).success(function(data,status,headers,config){RestfulApi.success(data,status,headers,config);$scope.section=data}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config);$scope.errors=data})}$scope.save=function(){console.log(modalData.projectId);if(modalData.create){$http.post(RestfulApi.getRoute("projectSection","store",modalData.projectId),$scope.section).success(function(data,status,headers,config){RestfulApi.success(data,status,headers,config);notificationService.add("Section '"+data.title+"' created successfully","success");$scope.errors=[];$modalInstance.close(data,true)}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config);$scope.errors=data})}else{$http.put(RestfulApi.getRoute("section","update",$scope.section.id),$scope.section).success(function(data,status,headers,config){RestfulApi.success(data,status,headers,config);notificationService.add("Section '"+data.title+"' updated successfully","success");$scope.errors=[];$modalInstance.close(data,false)}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config);$scope.errors=data})}};$scope.cancel=function(){$modalInstance.dismiss("cancel")}});app.controller("ProjectSectionController",function($scope,$filter,ngTableParams,$http,$route,$routeParams,$location){$scope.data=[];$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{created_at:"desc"}},{filterDelay:10,total:$scope.data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data;var orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length);$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}});$scope.init=function(){console.log($routeParams.project_id);$http.get("/admin/api/project/"+$routeParams.project_id+"/section").success(function(data,status,headers,config){$scope.data=data;angular.forEach(data,function(data){data.id=parseFloat(data.id)});$scope.tableParams.reload()}).error(function(data,status,headers,config){console.log(status);if(status==401){$scope.errors=[{"Logged out":"You have been logged out. Refresh the page to log back in again"}]}else{$scope.errors=data}})};$scope.delete=function(id){$http.delete("/admin/api/project/"+id).success(function(data,status,headers,config){$scope.init()}).error(function(data,status,headers,config){$scope.errors=data})};$scope.init()});app.controller("SectionCreateController",function($scope,$http,$route,$routeParams,$location){$scope.data={};$scope.save=function(){$http.post("/admin/api/project",$scope.data).success(function(data,status,headers,config){$location.path("/project")}).error(function(data,status,headers,config){if(status==401){$scope.errors=[{"Logged out":"You have been logged out. Refresh the page to log back in again"}]}else{$scope.errors=data}})}});app.controller("SectionEditController",function($scope,$http,$route,$routeParams,$location){$scope.data={};$http.get("/admin/api/section/"+$routeParams.id).success(function(data,status,headers,config){$scope.data=data}).error(function(data,status,headers,config){if(status==401){$scope.errors=[{"Logged out":"You have been logged out. Refresh the page to log back in again"}]}else{$scope.errors=data}});$scope.addSection=function(){$scope.data.sections.push({})};$scope.deleteSection=function(index){$scope.data.sections.splice(index,1)};$scope.save=function(){$http.put("/admin/api/section/"+$routeParams.id,$scope.data).success(function(data,status,headers,config){$location.path("/project/"+data.attachment_id+"/section")}).error(function(data,status,headers,config){if(status==401){$scope.errors=[{"Logged out":"You have been logged out. Refresh the page to log back in again"}]}else{$scope.errors=data}})}});app.controller("TagController",function($scope,$filter,ngTableParams,$http,RestfulApi,notificationService){$scope.data=[];$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{updated_at:"desc"}},{filterDelay:10,total:$scope.data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data;var orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length);$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}});$scope.init=function(){$http.get(RestfulApi.getRoute("tag","index")).success(function(data,status,headers,config){RestfulApi.success(data,status,headers,config);$scope.data=data;$scope.tableParams.reload()}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config)})};$scope.delete=function(id,title){if(confirm("Are you sure you wish to delete "+title+"?")){$http.delete(RestfulApi.getRoute("tag","destroy",id)).success(function(data,status,headers,config){notificationService.add("Project '"+data.title+"' deleted successfully","info");$scope.init()}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config);$scope.errors=data})}};$scope.init()});app.controller("TagCreateController",function($scope,$http,$stateParams,$state,RestfulApi,notificationService){$scope.data={};$scope.create=true;$scope.save=function(apply){$http.post(RestfulApi.getRoute("tag","store"),$scope.data).success(function(data,status,headers,config){RestfulApi.success(data,status,headers,config);notificationService.add("Tag '"+data.title+"' added successfully","success");$scope.errors=[];if(!apply){$state.go("tag.index")}else{$state.go("tag.edit",{id:data.id})}}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config);$scope.errors=data})}});app.controller("TagEditController",function($scope,$http,$stateParams,$state,RestfulApi,notificationService,ngTableParams,$filter,$modal){$scope.data={};$http.get(RestfulApi.getRoute("tag","show",$stateParams.id)).success(function(data,status,headers,config){RestfulApi.success(data,status,headers,config);$scope.data=data}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config);$scope.errors=data});$scope.save=function(apply){apply=typeof apply!=="undefined"?apply:false;$scope.put(apply)};$scope.put=function(apply){$http.put(RestfulApi.getRoute("tag","update",$stateParams.id),$scope.data).success(function(data,status,headers,config){RestfulApi.success(data,status,headers,config);notificationService.add("Tag '"+data.title+"' updated successfully","success");$scope.errors=[];if(!apply){$state.go("tag.index")}}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config);$scope.errors=data})}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9wdWJsaWMvYWRtaW4vanMvbWFpbi5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJGh0dHBQcm92aWRlciIsImRlZmF1bHRzIiwiaGVhZGVycyIsImNvbW1vbiIsIiRzdGF0ZVByb3ZpZGVyIiwiJHVybFJvdXRlclByb3ZpZGVyIiwib3RoZXJ3aXNlIiwic3RhdGUiLCJ1cmwiLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJtYXJrZWRQcm92aWRlciIsInNldE9wdGlvbnMiLCJnZm0iLCJ0YWJsZXMiLCJmYWN0b3J5IiwiJGh0dHAiLCJub3RpZmljYXRpb25TZXJ2aWNlIiwiY2hlY2tSZXNwb25zZUNvZGUiLCJkYXRhIiwic3RhdHVzIiwiY2xlYXIiLCJtc2ciLCJmb3JFYWNoIiwidmFsdWUiLCJrZXkiLCJjb25jYXQiLCJhZGQiLCJjb25zb2xlIiwibG9nIiwiZ2V0Um91dGUiLCJyZXNvdXJjZSIsIm1ldGhvZCIsImlkIiwicHJlZml4Iiwicm91dGVzIiwicHJvamVjdCIsImluZGV4Iiwic2hvdyIsInN0b3JlIiwidXBkYXRlIiwiZGVzdHJveSIsInNlY3Rpb24iLCJwcm9qZWN0U2VjdGlvbiIsInRhZyIsInN1Y2Nlc3MiLCJyZW1vdmVCeVR5cGUiLCJlcnJvciIsInNlcnZpY2UiLCIkdGltZW91dCIsIm5vdGlmaWNhdGlvbnMiLCJ0aGlzIiwiZ2V0IiwibWVzc2FnZSIsInR5cGUiLCJtZXNzYWdlcyIsIm5vdGlmaWNhdGlvbiIsInB1c2giLCJzcGxpY2UiLCJpbmRleE9mIiwicmVtb3ZlQnlJbmRleCIsImkiLCJsZW5ndGgiLCIkc2NvcGUiLCJub3RpZmllciIsIiR3YXRjaCIsImlzRGVmaW5lZCIsImNsb3NlTm90aWZpY2F0aW9uIiwiJHN0YXRlUGFyYW1zIiwiJGZpbHRlciIsIm5nVGFibGVQYXJhbXMiLCJSZXN0ZnVsQXBpIiwidGFibGVQYXJhbXMiLCJwYWdlIiwiY291bnQiLCJzb3J0aW5nIiwidXBkYXRlZF9hdCIsImZpbHRlckRlbGF5IiwidG90YWwiLCJnZXREYXRhIiwiJGRlZmVyIiwicGFyYW1zIiwiZmlsdGVyZWREYXRhIiwiZmlsdGVyIiwib3JkZXJlZERhdGEiLCJvcmRlckJ5IiwicmVzb2x2ZSIsInNsaWNlIiwiaW5pdCIsInJlbG9hZCIsImRlbGV0ZSIsInRpdGxlIiwiY29uZmlybSIsImVycm9ycyIsIiRzdGF0ZSIsImNyZWF0ZSIsInNhdmUiLCJhcHBseSIsInBvc3QiLCJnbyIsIiRtb2RhbCIsInNlY3Rpb25zIiwic2x1ZyIsImVkaXRTZWN0aW9uIiwic2VjdGlvbklkIiwibW9kYWxEYXRhIiwicHJvamVjdElkIiwibW9kYWxJbnN0YW5jZSIsIm9wZW4iLCJhbmltYXRpb24iLCJzaXplIiwicmVzdWx0IiwidGhlbiIsInNsdWdXYXJuaW5nIiwicHV0IiwiJG1vZGFsSW5zdGFuY2UiLCJjbG9zZSIsImNhbmNlbCIsImRpc21pc3MiLCIkcm91dGUiLCIkcm91dGVQYXJhbXMiLCIkbG9jYXRpb24iLCJjcmVhdGVkX2F0IiwicHJvamVjdF9pZCIsInBhcnNlRmxvYXQiLCJMb2dnZWQgb3V0IiwicGF0aCIsImFkZFNlY3Rpb24iLCJkZWxldGVTZWN0aW9uIiwiYXR0YWNobWVudF9pZCJdLCJtYXBwaW5ncyI6IkFBQ0EsR0FBSUEsS0FBTUMsUUFBUUMsT0FBTyxnQkFBaUIsWUFBYSxlQUFnQixVQUFXLFlBQWEsZUFVL0ZGLEtBQUlHLE9BQU8sU0FBU0MsZUFFaEJBLGNBQWNDLFNBQVNDLFFBQVFDLE9BQU8sb0JBQXNCLGtCQUtoRVAsS0FBSUcsT0FBTyxTQUFTSyxlQUFnQkMsb0JBR2xDQSxtQkFBbUJDLFVBQVUsYUFLN0JGLGdCQUNHRyxNQUFNLGFBQ0xDLElBQUssYUFDTEMsWUFBYSwrQ0FDYkMsV0FBWSx3QkFFYkgsTUFBTSxXQUNMQyxJQUFLLFdBQ0xDLFlBQWEsdURBRWRGLE1BQU0saUJBQ0xDLElBQUssU0FDTEMsWUFBYSwyREFDYkMsV0FBWSxzQkFFYkgsTUFBTSxrQkFDTEMs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QyxPQUFRbEIsUUFBU0gsUUFDbEN3RSxXQUFXeEIsTUFBTTVCLEtBQU1DLE9BQVFsQixRQUFTSCxPQUN4Q2dFLFFBQU84QixPQUFTMUUsTUFHeEI0QyxRQUFPaUMsS0FBTyxTQUFTQyxPQUNuQkEsWUFBZUEsU0FBVSxZQUFjQSxNQUFRLEtBQy9DbEMsUUFBT21ELElBQUlqQixPQUdmbEMsUUFBT21ELElBQU0sU0FBU2pCLE9BQ2xCakYsTUFBTWtHLElBQUkzQyxXQUFXekMsU0FBUyxNQUFPLFNBQVVzQyxhQUFhbkMsSUFBSzhCLE9BQU81QyxNQUN4RTBCLFFBQVEsU0FBUzFCLEtBQU1DLE9BQVFsQixRQUFTSCxRQUNwQ3dFLFdBQVcxQixRQUFRMUIsS0FBTUMsT0FBUWxCLFFBQVNILE9BQzFDa0IscUJBQW9CVSxJQUFJLFFBQVVSLEtBQUt3RSxNQUFRLHlCQUEwQixVQUN6RTVCLFFBQU84QixTQUNQLEtBQUtJLE1BQU8sQ0FDUkgsT0FBT0ssR0FBSSxnQkFHbkJwRCxNQUFNLFNBQVM1QixLQUFNQyxPQUFRbEIsUUFBU0gsUUFDbEN3RSxXQUFXeEIsTUFBTTVCLEtBQU1DLE9BQVFsQixRQUFTSCxPQUN4Q2dFLFFBQU84QixPQUFTMUUiLCJmaWxlIjoic3JjL3B1YmxpYy9hZG1pbi9qcy9tYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gRmlyZSB1cCB0aGUgYXBwXG52YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ25nLXBvcnRmb2xpbycsIFsndWkucm91dGVyJywgJ3VpLmJvb3RzdHJhcCcsICduZ1RhYmxlJywgJ2hjLm1hcmtlZCcsICduZ1RhZ3NJbnB1dCddKTtcblxuLy8gQ29uZmlndXJlIEFuZ3VsYXJcblxuLyogYXBwLmNvbmZpZyhmdW5jdGlvbigkaW50ZXJwb2xhdGVQcm92aWRlcikge1xuICAgIC8vIFNldCBBbmd1bGFyIHRvIHVzZSBzcXVhcmUtYnJhY2tldHMgaW5zdGVhZCBvZiBjdXJseSAtIGEgd29yayBhcm91bmQgdG8gcGxheSBuaWNlIHdpdGggTGFyYXZlbCBCbGFkZSB0ZW1wbGF0ZXNcbiAgICAkaW50ZXJwb2xhdGVQcm92aWRlci5zdGFydFN5bWJvbCgne3snKTtcbiAgICAkaW50ZXJwb2xhdGVQcm92aWRlci5lbmRTeW1ib2woJ319Jyk7XG59KTsgKi9cblxuYXBwLmNvbmZpZyhmdW5jdGlvbigkaHR0cFByb3ZpZGVyKSB7XG4gICAgLy8gQWRkIHRoZSBYTUxIdHRwUmVxdWVzdCBoZWFkZXIgc28gdGhhdCBMYXJhdmVsIGNhbiB0ZWxsIGFwYXJ0IEFKQVggcmVxdWVzdHNcbiAgICAkaHR0cFByb3ZpZGVyLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uW1wiWC1SZXF1ZXN0ZWQtV2l0aFwiXSA9IFwiWE1MSHR0cFJlcXVlc3RcIjtcbn0pO1xuXG5cbi8vIFNldHVwIHRoZSBzdGF0ZSBtYW5hZ2VyIChSb3V0ZXIpXG5hcHAuY29uZmlnKGZ1bmN0aW9uKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcblxuICAvLyBGb3IgYW55IHVubWF0Y2hlZCB1cmwsIHJlZGlyZWN0IHRvIC9zdGF0ZTFcbiAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZShcIi9kYXNoYm9hcmRcIik7XG5cbiAgLy8kdXJsUm91dGVyUHJvdmlkZXIud2hlbignL3Byb2plY3QnLCAnL3Byb2plY3QvaW5kZXgnKTtcblxuICAvLyBOb3cgc2V0IHVwIHRoZSBzdGF0ZXNcbiAgJHN0YXRlUHJvdmlkZXJcbiAgICAuc3RhdGUoJ2Rhc2hib2FyZCcsIHtcbiAgICAgIHVybDogXCIvZGFzaGJvYXJkXCIsXG4gICAgICB0ZW1wbGF0ZVVybDogXCIvdmVuZG9yL3BvcnRmb2xpby9hZG1pbi92aWV3cy9kYXNoYm9hcmQuaHRtbFwiLFxuICAgICAgY29udHJvbGxlcjogXCJEYXNoYm9hcmRDb250cm9sbGVyXCJcbiAgICB9KVxuICAgIC5zdGF0ZSgncHJvamVjdCcsIHtcbiAgICAgIHVybDogXCIvcHJvamVjdFwiLFxuICAgICAgdGVtcGxhdGVVcmw6IFwiL3ZlbmRvci9wb3J0Zm9saW8vYWRtaW4vdmlld3MvcHJvamVjdC9wcm9qZWN0Lmh0bWxcIixcbiAgICB9KVxuICAgIC5zdGF0ZSgncHJvamVjdC5pbmRleCcsIHtcbiAgICAgIHVybDogXCIvaW5kZXhcIixcbiAgICAgIHRlbXBsYXRlVXJsOiBcIi92ZW5kb3IvcG9ydGZvbGlvL2FkbWluL3ZpZXdzL3Byb2plY3QvcHJvamVjdC5pbmRleC5odG1sXCIsXG4gICAgICBjb250cm9sbGVyOiBcIlByb2plY3RDb250cm9sbGVyXCJcbiAgICB9KVxuICAgIC5zdGF0ZSgncHJvamVjdC5jcmVhdGUnLCB7XG4gICAgICB1cmw6IFwiL2NyZWF0ZVwiLFxuICAgICAgdGVtcGxhdGVVcmw6IFwiL3ZlbmRvci9wb3J0Zm9saW8vYWRtaW4vdmlld3MvcHJvamVjdC9wcm9qZWN0LmVkaXQuaHRtbFwiLFxuICAgICAgY29udHJvbGxlcjogXCJQcm9qZWN0Q3JlYXRlQ29udHJvbGxlclwiXG4gICAgfSlcbiAgICAuc3RhdGUoJ3Byb2plY3QuZWRpdCcsIHtcbiAgICAgIHVybDogXCIvOmlkL2VkaXRcIixcbiAgICAgIHRlbXBsYXRlVXJsOiBcIi92ZW5kb3IvcG9ydGZvbGlvL2FkbWluL3ZpZXdzL3Byb2plY3QvcHJvamVjdC5lZGl0Lmh0bWxcIixcbiAgICAgIGNvbnRyb2xsZXI6IFwiUHJvamVjdEVkaXRDb250cm9sbGVyXCJcbiAgICB9KVxuICAgIC5zdGF0ZSgncHJvamVjdC1zZWN0aW9uJywge1xuICAgICAgdXJsOiBcIi9wcm9qZWN0LzppZC9zZWN0aW9uXCIsXG4gICAgICB0ZW1wbGF0ZVVybDogXCIvdmVuZG9yL3BvcnRmb2xpby9hZG1pbi92aWV3cy9wcm9qZWN0L3Byb2plY3Quc2VjdGlvbi5pbmRleC5odG1sXCIsXG4gICAgICBjb250cm9sbGVyOiBcIlByb2plY3RTZWN0aW9uQ29udHJvbGxlclwiXG4gICAgfSlcbiAgICAuc3RhdGUoJ3NlY3Rpb24tZWRpdCcsIHtcbiAgICAgIHVybDogXCIvc2VjdGlvbi86aWQvZWRpdFwiLFxuICAgICAgdGVtcGxhdGVVcmw6IFwiL3ZlbmRvci9wb3J0Zm9saW8vYWRtaW4vdmlld3Mvc2VjdGlvbi9zZWN0aW9uLmVkaXQuaHRtbFwiLFxuICAgICAgY29udHJvbGxlcjogXCJTZWN0aW9uRWRpdENvbnRyb2xsZXJcIlxuICAgIH0pXG4gICAgLnN0YXRlKCd0YWcnLCB7XG4gICAgICB1cmw6IFwiL3RhZ1wiLFxuICAgICAgdGVtcGxhdGVVcmw6IFwiL3ZlbmRvci9wb3J0Zm9saW8vYWRtaW4vdmlld3MvdGFnL3RhZy5odG1sXCIsXG4gICAgfSlcbiAgICAuc3RhdGUoJ3RhZy5pbmRleCcsIHtcbiAgICAgIHVybDogXCIvaW5kZXhcIixcbiAgICAgIHRlbXBsYXRlVXJsOiBcIi92ZW5kb3IvcG9ydGZvbGlvL2FkbWluL3ZpZXdzL3RhZy90YWcuaW5kZXguaHRtbFwiLFxuICAgICAgY29udHJvbGxlcjogXCJUYWdDb250cm9sbGVyXCJcbiAgICB9KVxuICAgIC5zdGF0ZSgndGFnLmNyZWF0ZScsIHtcbiAgICAgIHVybDogXCIvY3JlYXRlXCIsXG4gICAgICB0ZW1wbGF0ZVVybDogXCIvdmVuZG9yL3BvcnRmb2xpby9hZG1pbi92aWV3cy90YWcvdGFnLmVkaXQuaHRtbFwiLFxuICAgICAgY29udHJvbGxlcjogXCJUYWdDcmVhdGVDb250cm9sbGVyXCJcbiAgICB9KVxuICAgIC5zdGF0ZSgndGFnLmVkaXQnLCB7XG4gICAgICB1cmw6IFwiLzppZC9lZGl0XCIsXG4gICAgICB0ZW1wbGF0ZVVybDogXCIvdmVuZG9yL3BvcnRmb2xpby9hZG1pbi92aWV3cy90YWcvdGFnLmVkaXQuaHRtbFwiLFxuICAgICAgY29udHJvbGxlcjogXCJUYWdFZGl0Q29udHJvbGxlclwiXG4gICAgfSk7XG59KTtcblxuXG5hcHAuY29uZmlnKFsnbWFya2VkUHJvdmlkZXInLCBmdW5jdGlvbihtYXJrZWRQcm92aWRlcikge1xuICAgIG1hcmtlZFByb3ZpZGVyLnNldE9wdGlvbnMoe1xuICAgICAgICBnZm06IHRydWUsXG4gICAgICAgIHRhYmxlczogdHJ1ZVxuICAgIH0pO1xufV0pO1xuXG5cbi8vIFNvbWUgaGVscGZ1bCBmdW5jdGlvbnMgZm9yIEFKQVggcmVxdWVzdHNcbmFwcC5mYWN0b3J5KCdSZXN0ZnVsQXBpJywgZnVuY3Rpb24gKCRodHRwLCBub3RpZmljYXRpb25TZXJ2aWNlKSB7XG5cbiAgICAvLyBXb3QgdG8gZG8gaW5jYXNlIEFQSSBmYWlscyB0byByZXNwb25kIHdpdGggMjAwXG4gICAgdmFyIGNoZWNrUmVzcG9uc2VDb2RlID0gZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgIHN3aXRjaChzdGF0dXMpIHtcbiAgICAgICAgICAgIC8vIEZhaWxlZCB2YWxpZGF0aW9uXG4gICAgICAgICAgICBjYXNlIDQyMjpcblxuICAgICAgICAgICAgICAgIC8vIENsZWFyIGFsbCBleGlzdGluZyBub3RpZmljYXRpb25zXG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5jbGVhcigpO1xuXG4gICAgICAgICAgICAgICAgLy8gQ29uY2F0ZW5hdGUgYWxsIHRoZSB2YWxpZGF0aW9uIGVycm9yIG1lc3NhZ2VzXG4gICAgICAgICAgICAgICAgdmFyIG1zZyA9IFtdO1xuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChkYXRhLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIG1zZyA9IG1zZy5jb25jYXQodmFsdWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gQWRkIHRoZSBub3RpZmljYXRpb25cbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmFkZChcIlZhbGlkYXRpb24gZmFpbGVkLCBwbGVhc2UgY29ycmVjdCB0aGUgZm9sbG93aW5nIGlzc3VlczpcIiwgJ2RhbmdlcicsIG1zZyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIC8vIFVuYXV0aGVudGljYXRlZFxuICAgICAgICAgICAgY2FzZSA0MDE6XG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5hZGQoJ1lvdSBoYXZlIGJlZW4gbG9nZ2VkIG91dCcsICd3YXJuaW5nJyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDUwMDpcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmFkZCgnQVBJIGVycm9yJywgJ2RhbmdlcicpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNvbWUgb3RoZXIgcHJvYmxlbSFcIik7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuXG4gICAgICAgIC8vIFJldHVybnMgdGhlIHN0cmluZyBvZiBhIHBhcnRpY3VsYXIgcm91dGVcbiAgICAgICAgZ2V0Um91dGU6IGZ1bmN0aW9uKHJlc291cmNlLCBtZXRob2QsIGlkKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGlkID09PSAndW5kZWZpbmVkJykgeyBpZCA9ICcwJzsgfVxuXG4gICAgICAgICAgICB2YXIgcHJlZml4ID0gJy9hZG1pbi9hcGknO1xuXG4gICAgICAgICAgICB2YXIgcm91dGVzID0ge1xuICAgICAgICAgICAgICAgIHByb2plY3QgICAgIDogIHtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggICA6IHByZWZpeCArICcvcHJvamVjdCcsXG4gICAgICAgICAgICAgICAgICAgIHNob3cgICAgOiBwcmVmaXggKyAnL3Byb2plY3QvJyArIGlkLFxuICAgICAgICAgICAgICAgICAgICBzdG9yZSAgIDogcHJlZml4ICsgJy9wcm9qZWN0JyxcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlICA6IHByZWZpeCArICcvcHJvamVjdC8nICsgaWQsXG4gICAgICAgICAgICAgICAgICAgIGRlc3Ryb3kgOiBwcmVmaXggKyAnL3Byb2plY3QvJyArIGlkXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzZWN0aW9uICAgICA6ICB7XG4gICAgICAgICAgICAgICAgICAgIGluZGV4ICAgOiBwcmVmaXggKyAnL3NlY3Rpb24nLFxuICAgICAgICAgICAgICAgICAgICBzaG93ICAgIDogcHJlZml4ICsgJy9zZWN0aW9uLycgKyBpZCxcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUgICA6IHByZWZpeCArICcvc2VjdGlvbicsXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZSAgOiBwcmVmaXggKyAnL3NlY3Rpb24vJyArIGlkLFxuICAgICAgICAgICAgICAgICAgICBkZXN0cm95IDogcHJlZml4ICsgJy9zZWN0aW9uLycgKyBpZFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcHJvamVjdFNlY3Rpb24gICAgIDogIHtcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUgICA6IHByZWZpeCArICcvcHJvamVjdC8nICsgaWQgKyAnL3NlY3Rpb24nXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0YWcgICAgICAgICA6ICB7XG4gICAgICAgICAgICAgICAgICAgIGluZGV4ICAgOiBwcmVmaXggKyAnL3RhZycsXG4gICAgICAgICAgICAgICAgICAgIHNob3cgICAgOiBwcmVmaXggKyAnL3RhZy8nICsgaWQsXG4gICAgICAgICAgICAgICAgICAgIHN0b3JlICAgOiBwcmVmaXggKyAnL3RhZycsXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZSAgOiBwcmVmaXggKyAnL3RhZy8nICsgaWQsXG4gICAgICAgICAgICAgICAgICAgIGRlc3Ryb3kgOiBwcmVmaXggKyAnL3RhZy8nICsgaWRcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICByZXR1cm4gcm91dGVzW3Jlc291cmNlXVttZXRob2RdO1xuXG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gRG8gc29tZSBzdHVmZiB1cG9uIGEgc3VjY2Vzc2Z1bCBBamF4IHJlcXVlc3RcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UucmVtb3ZlQnlUeXBlKCdkYW5nZXInKTtcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICB9LFxuICAgICAgICAvLyBEbyBzb21lIHN0dWZmIHVwb24gYW4gdW5zdWNjZXNzZnVsIEFqYXggcmVxdWVzdFxuICAgICAgICBlcnJvcjogZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgIGNoZWNrUmVzcG9uc2VDb2RlKGRhdGEsIHN0YXR1cyk7XG4gICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG5cbmFwcC5zZXJ2aWNlKCdub3RpZmljYXRpb25TZXJ2aWNlJywgZnVuY3Rpb24gKCR0aW1lb3V0KSB7XG5cbiAgICB2YXIgbm90aWZpY2F0aW9ucyA9IFtdO1xuXG4gICAgLy8gUmV0cmlldmUgYWxsIG1lc3NhZ2VzXG4gICAgdGhpcy5nZXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIG5vdGlmaWNhdGlvbnM7XG4gICAgfTtcblxuICAgIC8vIFJlbW92ZSBuZXcgbm90aWZpY2F0aW9uXG4gICAgdGhpcy5hZGQgPSBmdW5jdGlvbihtZXNzYWdlLCB0eXBlLCBtZXNzYWdlcykge1xuXG4gICAgICAgIC8vIE9ubHkgYWxsb3cgb25lIHN1Y2Nlc3MgbWVzc2FnZSBhdCBhIHRpbWVcbiAgICAgICAgaWYgKHR5cGUgPT0gJ3N1Y2Nlc3MnKSB7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZUJ5VHlwZSgnc3VjY2VzcycpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG5vdGlmaWNhdGlvbiA9IHtcbiAgICAgICAgICAgIHR5cGUgOiB0eXBlLFxuICAgICAgICAgICAgbWVzc2FnZSA6IG1lc3NhZ2UsXG4gICAgICAgICAgICBtZXNzYWdlcyA6IG1lc3NhZ2VzLFxuICAgICAgICAgICAgLy9hY3Rpb24gOiBhY3Rpb25cbiAgICAgICAgfTtcblxuICAgICAgICBub3RpZmljYXRpb25zLnB1c2gobm90aWZpY2F0aW9uKTtcblxuICAgICAgICBjb25zb2xlLmxvZygnYWRkZWQgJyArIHR5cGUgKyAnIG1lc3NhZ2UnKTtcblxuICAgICAgICBpZiAodHlwZSAhPSAnZGFuZ2VyJykge1xuICAgICAgICAgICAgLy8gU2V0IHRoZSBhbGVydCB0byBiZSByZW1vdmVkIGFmdGVyIGEgZGVsYXlcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9ucy5zcGxpY2Uobm90aWZpY2F0aW9ucy5pbmRleE9mKG5vdGlmaWNhdGlvbiksIDEpO1xuICAgICAgICAgICAgICAgIC8vJHNjb3BlLmFsZXJ0cy5zcGxpY2UoJHNjb3BlLmFsZXJ0cy5pbmRleE9mKGFsZXJ0KSwgMSk7XG4gICAgICAgICAgICB9LCA2MDAwKTsgLy8gbWF5YmUgJ30sIDMwMDAsIGZhbHNlKTsnIHRvIGF2b2lkIGNhbGxpbmcgYXBwbHlcbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgIC8vIFJlbW92ZSBub3RpZmljYXRpb24gYnkgYXJyYXkgaW5kZXhcbiAgICB0aGlzLnJlbW92ZUJ5SW5kZXggPSBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICBjb25zb2xlLmxvZygncmVtb3Zpbmcgb25lIG1lc3NhZ2U6ICcgKyBpbmRleCk7XG4gICAgICAgIG5vdGlmaWNhdGlvbnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB9XG5cbiAgICAvLyBSZW1vdmUgYWxsIG5vdGlmaWNhdGlvbnMgb2YgdHlwZVxuICAgIHRoaXMucmVtb3ZlQnlUeXBlID0gZnVuY3Rpb24odHlwZSkge1xuICAgICAgICBjb25zb2xlLmxvZygnY2xlYXJpbmcgJyArIHR5cGUgKyAnIG1lc3NhZ2VzJyk7XG4gICAgICAgIGZvciAoaT0wOyBpIDwgbm90aWZpY2F0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKG5vdGlmaWNhdGlvbnNbaV0udHlwZSA9PSB0eXBlKSB7XG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9ucy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDbGVhciBhbGwgbm90aWZpY2F0aW9uc1xuICAgIHRoaXMuY2xlYXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2NsZWFyaW5nIGFsbCBtZXNzYWdlcycpO1xuICAgICAgICBub3RpZmljYXRpb25zID0gW107XG4gICAgfVxuXG59KTtcblxuYXBwLmNvbnRyb2xsZXIoJ05vdGlmaWNhdGlvbkNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsIG5vdGlmaWNhdGlvblNlcnZpY2UsICR0aW1lb3V0KSB7XG5cbiAgICAkc2NvcGUubm90aWZpZXIgPSBub3RpZmljYXRpb25TZXJ2aWNlO1xuXG5cbiAgICAkc2NvcGUuJHdhdGNoKCdub3RpZmllci5nZXQoKScsIGZ1bmN0aW9uIChub3RpZmljYXRpb25zKSB7XG4gICAgICAgIGlmIChhbmd1bGFyLmlzRGVmaW5lZChub3RpZmljYXRpb25zKSkge1xuICAgICAgICAgICAgJHNjb3BlLm5vdGlmaWNhdGlvbnMgPSBub3RpZmljYXRpb25zO1xuICAgICAgICB9XG4gICAgfSwgdHJ1ZSk7XG5cblxuICAgICRzY29wZS5jbG9zZU5vdGlmaWNhdGlvbiA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UucmVtb3ZlQnlJbmRleChpbmRleCk7XG4gICAgfTtcblxuXG59KTtcblxuYXBwLmNvbnRyb2xsZXIoJ0Rhc2hib2FyZENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkc3RhdGVQYXJhbXMpIHtcblxuXG5cbn0pO1xuXG5hcHAuY29udHJvbGxlcignUHJvamVjdENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRmaWx0ZXIsIG5nVGFibGVQYXJhbXMsICRodHRwLCBSZXN0ZnVsQXBpLCBub3RpZmljYXRpb25TZXJ2aWNlKSB7XG5cbiAgICAvLyBJbml0aWFsaXNlIGFuIGVtcHR5IGFycmF5IHRvIGhvbGQgZGF0YVxuICAgICRzY29wZS5kYXRhID0gW107XG5cbiAgICAvLyBJbml0aWFsaXNlIHRoZSBkYXRhIHRhYmxlXG4gICAgJHNjb3BlLnRhYmxlUGFyYW1zID0gbmV3IG5nVGFibGVQYXJhbXMoe1xuICAgICAgICBwYWdlOiAxLCAgICAgICAgICAgIC8vIHNob3cgZmlyc3QgcGFnZVxuICAgICAgICBjb3VudDogMTAsICAgICAgICAgIC8vIGNvdW50IHBlciBwYWdlXG4gICAgICAgIHNvcnRpbmc6IHtcbiAgICAgICAgICAgIHVwZGF0ZWRfYXQ6ICdkZXNjJyAgICAgLy8gaW5pdGlhbCBzb3J0aW5nXG4gICAgICAgIH0sXG4gICAgfSwge1xuICAgICAgICBmaWx0ZXJEZWxheTogMTAsXG4gICAgICAgIHRvdGFsOiAkc2NvcGUuZGF0YS5sZW5ndGgsIC8vIGxlbmd0aCBvZiBkYXRhXG4gICAgICAgIGdldERhdGE6IGZ1bmN0aW9uKCRkZWZlciwgcGFyYW1zKSB7XG4gICAgICAgICAgICAvLyB1c2UgYnVpbGQtaW4gYW5ndWxhciBmaWx0ZXJcbiAgICAgICAgICAgIHZhciBmaWx0ZXJlZERhdGEgPSBwYXJhbXMuZmlsdGVyKCkgP1xuICAgICAgICAgICAgICAgICAgICAkZmlsdGVyKCdmaWx0ZXInKSgkc2NvcGUuZGF0YSwgcGFyYW1zLmZpbHRlcigpKSA6XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhO1xuICAgICAgICAgICAgdmFyIG9yZGVyZWREYXRhID0gcGFyYW1zLnNvcnRpbmcoKSA/XG4gICAgICAgICAgICAgICAgICAgICRmaWx0ZXIoJ29yZGVyQnknKShmaWx0ZXJlZERhdGEsIHBhcmFtcy5vcmRlckJ5KCkpIDpcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGE7XG5cbiAgICAgICAgICAgIHBhcmFtcy50b3RhbChvcmRlcmVkRGF0YS5sZW5ndGgpOyAvLyBzZXQgdG90YWwgZm9yIHJlY2FsYyBwYWdpbmF0aW9uXG4gICAgICAgICAgICAkZGVmZXIucmVzb2x2ZShvcmRlcmVkRGF0YS5zbGljZSgocGFyYW1zLnBhZ2UoKSAtIDEpICogcGFyYW1zLmNvdW50KCksIHBhcmFtcy5wYWdlKCkgKiBwYXJhbXMuY291bnQoKSkpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBJbml0aWFsaXNlIChsb2FkKSBkYXRhXG4gICAgJHNjb3BlLmluaXQgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAvL2NvbnNvbGUubG9nKFJlc3RmdWxBcGkuZ2V0Um91dGUoJ3Byb2plY3QnLCAndXBkYXRlJywgNCkpO1xuXG4gICAgICAgICRodHRwLmdldChSZXN0ZnVsQXBpLmdldFJvdXRlKCdwcm9qZWN0JywgJ2luZGV4JykpLlxuICAgICAgICBzdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICBSZXN0ZnVsQXBpLnN1Y2Nlc3MoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpO1xuICAgICAgICAgICAgJHNjb3BlLmRhdGEgPSBkYXRhO1xuICAgICAgICAgICAgJHNjb3BlLnRhYmxlUGFyYW1zLnJlbG9hZCgpO1xuICAgICAgICB9KS5cbiAgICAgICAgZXJyb3IoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgIFJlc3RmdWxBcGkuZXJyb3IoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpO1xuICAgICAgICB9KTtcblxuICAgIH07XG5cblxuICAgICRzY29wZS5kZWxldGUgPSBmdW5jdGlvbihpZCwgdGl0bGUpIHtcblxuICAgICAgICBpZiAoY29uZmlybSgnQXJlIHlvdSBzdXJlIHlvdSB3aXNoIHRvIGRlbGV0ZSAnICsgdGl0bGUgKyAnPycpKSB7XG5cbiAgICAgICAgICAgICRodHRwLmRlbGV0ZSgnL2FkbWluL2FwaS9wcm9qZWN0LycgKyBpZCkuXG4gICAgICAgICAgICAgICAgc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmFkZChcIlByb2plY3QgJ1wiICsgZGF0YS50aXRsZSArIFwiJyBkZWxldGVkIHN1Y2Nlc3NmdWxseVwiLCAnaW5mbycpO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaW5pdCgpO1xuICAgICAgICAgICAgICAgIH0pLlxuICAgICAgICAgICAgICAgIGVycm9yKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgIFJlc3RmdWxBcGkuZXJyb3IoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgICRzY29wZS5pbml0KCk7XG5cblxufSk7XG5cblxuXG5hcHAuY29udHJvbGxlcignUHJvamVjdENyZWF0ZUNvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkc3RhdGVQYXJhbXMsICRzdGF0ZSwgUmVzdGZ1bEFwaSwgbm90aWZpY2F0aW9uU2VydmljZSkge1xuXG4gICAgJHNjb3BlLmRhdGEgPSB7fTtcblxuICAgICRzY29wZS5jcmVhdGUgPSB0cnVlO1xuXG4gICAgJHNjb3BlLnNhdmUgPSBmdW5jdGlvbihhcHBseSkge1xuXG4gICAgICAgICRodHRwLnBvc3QoUmVzdGZ1bEFwaS5nZXRSb3V0ZSgncHJvamVjdCcsICdzdG9yZScpLCAkc2NvcGUuZGF0YSkuXG4gICAgICAgICAgICBzdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgUmVzdGZ1bEFwaS5zdWNjZXNzKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKTtcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmFkZChcIlByb2plY3QgJ1wiICsgZGF0YS50aXRsZSArIFwiJyBhZGRlZCBzdWNjZXNzZnVsbHlcIiwgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gW107XG4gICAgICAgICAgICAgICAgaWYgKCFhcHBseSkge1xuICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oIFwicHJvamVjdC5pbmRleFwiICk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgICAgICAgICRzdGF0ZS5nbyggXCJwcm9qZWN0LmVkaXRcIiwge2lkOiBkYXRhLmlkfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuXG4gICAgICAgICAgICBlcnJvcihmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgICAgIFJlc3RmdWxBcGkuZXJyb3IoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpO1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBkYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG59KTtcblxuXG5hcHAuY29udHJvbGxlcignUHJvamVjdEVkaXRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHN0YXRlUGFyYW1zLCAkc3RhdGUsIFJlc3RmdWxBcGksIG5vdGlmaWNhdGlvblNlcnZpY2UsIG5nVGFibGVQYXJhbXMsICRmaWx0ZXIsICRtb2RhbCkge1xuXG4gICAgJHNjb3BlLmRhdGEgPSB7XG4gICAgICAgIHNlY3Rpb25zIDogW11cbiAgICB9O1xuXG5cbiAgICAkc2NvcGUudGFibGVQYXJhbXMgPSBuZXcgbmdUYWJsZVBhcmFtcyh7XG4gICAgICAgIHBhZ2U6IDEsICAgICAgICAgICAgLy8gc2hvdyBmaXJzdCBwYWdlXG4gICAgICAgIGNvdW50OiAxMCwgICAgICAgICAgLy8gY291bnQgcGVyIHBhZ2VcbiAgICAgICAgc29ydGluZzoge1xuICAgICAgICAgICAgdXBkYXRlZF9hdDogJ2Rlc2MnICAgICAvLyBpbml0aWFsIHNvcnRpbmdcbiAgICAgICAgfSxcbiAgICB9LCB7XG4gICAgICAgIGZpbHRlckRlbGF5OiAxMCxcbiAgICAgICAgdG90YWw6ICRzY29wZS5kYXRhLnNlY3Rpb25zLmxlbmd0aCwgLy8gbGVuZ3RoIG9mIGRhdGFcbiAgICAgICAgZ2V0RGF0YTogZnVuY3Rpb24oJGRlZmVyLCBwYXJhbXMpIHtcbiAgICAgICAgICAgIC8vIHVzZSBidWlsZC1pbiBhbmd1bGFyIGZpbHRlclxuICAgICAgICAgICAgdmFyIGZpbHRlcmVkRGF0YSA9IHBhcmFtcy5maWx0ZXIoKSA/XG4gICAgICAgICAgICAgICAgICAgICRmaWx0ZXIoJ2ZpbHRlcicpKCRzY29wZS5kYXRhLnNlY3Rpb25zLCBwYXJhbXMuZmlsdGVyKCkpIDpcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGEuc2VjdGlvbnM7XG4gICAgICAgICAgICB2YXIgb3JkZXJlZERhdGEgPSBwYXJhbXMuc29ydGluZygpID9cbiAgICAgICAgICAgICAgICAgICAgJGZpbHRlcignb3JkZXJCeScpKGZpbHRlcmVkRGF0YSwgcGFyYW1zLm9yZGVyQnkoKSkgOlxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5zZWN0aW9ucztcblxuICAgICAgICAgICAgcGFyYW1zLnRvdGFsKG9yZGVyZWREYXRhLmxlbmd0aCk7IC8vIHNldCB0b3RhbCBmb3IgcmVjYWxjIHBhZ2luYXRpb25cbiAgICAgICAgICAgICRkZWZlci5yZXNvbHZlKG9yZGVyZWREYXRhLnNsaWNlKChwYXJhbXMucGFnZSgpIC0gMSkgKiBwYXJhbXMuY291bnQoKSwgcGFyYW1zLnBhZ2UoKSAqIHBhcmFtcy5jb3VudCgpKSk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuXG4gICAgJGh0dHAuZ2V0KFJlc3RmdWxBcGkuZ2V0Um91dGUoJ3Byb2plY3QnLCAnc2hvdycsICRzdGF0ZVBhcmFtcy5pZCkpLlxuICAgICAgICBzdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICBSZXN0ZnVsQXBpLnN1Y2Nlc3MoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpO1xuICAgICAgICAgICAgJHNjb3BlLmRhdGEgPSBkYXRhO1xuICAgICAgICAgICAgJHNjb3BlLnNsdWcgPSAkc2NvcGUuZGF0YS5zbHVnO1xuICAgICAgICAgICAgJHNjb3BlLnRhYmxlUGFyYW1zLnJlbG9hZCgpO1xuICAgICAgICB9KS5cbiAgICAgICAgZXJyb3IoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgIFJlc3RmdWxBcGkuZXJyb3IoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpO1xuICAgICAgICAgICAgJHNjb3BlLmVycm9ycyA9IGRhdGE7XG4gICAgICAgIH0pO1xuXG5cblxuICAgICRzY29wZS5lZGl0U2VjdGlvbiA9IGZ1bmN0aW9uIChjcmVhdGUsIHNlY3Rpb25JZCkge1xuICAgICAgICBzZWN0aW9uSWQgPSB0eXBlb2Ygc2VjdGlvbklkICE9PSAndW5kZWZpbmVkJyA/IHNlY3Rpb25JZCA6IGZhbHNlO1xuXG4gICAgICAgIG1vZGFsRGF0YSA9IHtcbiAgICAgICAgICAgICdjcmVhdGUnIDogY3JlYXRlLFxuICAgICAgICAgICAgJ3Byb2plY3RJZCcgOiAkc2NvcGUuZGF0YS5pZCxcbiAgICAgICAgICAgICdzZWN0aW9uSWQnIDogc2VjdGlvbklkXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc29sZS5sb2cobW9kYWxEYXRhKTtcblxuICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICRtb2RhbC5vcGVuKHtcbiAgICAgICAgICAgIGFuaW1hdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnc2VjdGlvbkVkaXQuaHRtbCcsXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnZWRpdFNlY3Rpb25Db250cm9sbGVyJyxcbiAgICAgICAgICAgIHNpemU6ICdsZycsXG4gICAgICAgICAgICByZXNvbHZlOiB7XG4gICAgICAgICAgICAgICAgbW9kYWxEYXRhOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vZGFsRGF0YTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIG1vZGFsSW5zdGFuY2UucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHNlY3Rpb24sIGNyZWF0ZSkge1xuICAgICAgICAgICAgaWYgKGNyZWF0ZSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLnNlY3Rpb25zLnB1c2goc2VjdGlvbik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKCRzY29wZS5kYXRhLnNlY3Rpb25zLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5pZCA9PSBzZWN0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLnNlY3Rpb25zW3ZhbHVlLmlkXSA9IHNlY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICRzY29wZS50YWJsZVBhcmFtcy5yZWxvYWQoKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgLy8kbG9nLmluZm8oJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpO1xuICAgICAgICB9KTtcblxuICAgIH07XG5cblxuICAgICRzY29wZS5zbHVnV2FybmluZyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLnJlbW92ZUJ5VHlwZSgnd2FybmluZycpO1xuICAgICAgICBpZiAoJHNjb3BlLnNsdWcgIT0gJHNjb3BlLmRhdGEuc2x1Zykge1xuICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5hZGQoXCJZb3UgaGF2ZSBtb2RpZmllZCB0aGUgcHJvamVjdCBzbHVnLiBQbGVhc2UgYmUgYXdhcmUgdGhhdCB0aGlzIG1heSBicmVhayBoeXBlcmxpbmtzIHRvIHRoaXMgcHJvamVjdC5cIiwgJ3dhcm5pbmcnKTtcbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgJHNjb3BlLnNhdmUgPSBmdW5jdGlvbihhcHBseSkge1xuICAgICAgICBhcHBseSA9IHR5cGVvZiBhcHBseSAhPT0gJ3VuZGVmaW5lZCcgPyBhcHBseSA6IGZhbHNlO1xuXG4gICAgICAgIGlmICgkc2NvcGUuc2x1ZyAhPSAkc2NvcGUuZGF0YS5zbHVnKSB7XG4gICAgICAgICAgICBpZiAoY29uZmlybSgnQXJlIHlvdSBzdXJlIHlvdSB3aXNoIHRvIGNoYW5nZSB0aGUgc2x1Zz8nKSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5wdXQoYXBwbHkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5zbHVnID0gJHNjb3BlLnNsdWc7XG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5yZW1vdmVCeVR5cGUoJ3dhcm5pbmcnKTtcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmFkZChcIlNsdWcgcmVzZXRcIiwgJ2luZm8nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRzY29wZS5wdXQoYXBwbHkpO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICAkc2NvcGUucHV0ID0gZnVuY3Rpb24oYXBwbHkpIHtcbiAgICAgICAgJGh0dHAucHV0KFJlc3RmdWxBcGkuZ2V0Um91dGUoJ3Byb2plY3QnLCAndXBkYXRlJywgJHN0YXRlUGFyYW1zLmlkKSwgJHNjb3BlLmRhdGEpLlxuICAgICAgICBzdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICBSZXN0ZnVsQXBpLnN1Y2Nlc3MoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpO1xuICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5hZGQoXCJQcm9qZWN0ICdcIiArIGRhdGEudGl0bGUgKyBcIicgdXBkYXRlZCBzdWNjZXNzZnVsbHlcIiwgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBbXTtcbiAgICAgICAgICAgIGlmICghYXBwbHkpIHtcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oIFwicHJvamVjdC5pbmRleFwiICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLlxuICAgICAgICBlcnJvcihmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgUmVzdGZ1bEFwaS5lcnJvcihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZyk7XG4gICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gZGF0YTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbn0pO1xuXG5cblxuXG5cbmFwcC5jb250cm9sbGVyKCdlZGl0U2VjdGlvbkNvbnRyb2xsZXInLCBmdW5jdGlvbiAoJHNjb3BlLCAkaHR0cCwgJG1vZGFsSW5zdGFuY2UsIFJlc3RmdWxBcGksIG5vdGlmaWNhdGlvblNlcnZpY2UsIG1vZGFsRGF0YSkge1xuXG4gICAgaWYgKCFtb2RhbERhdGEuY3JlYXRlKSB7XG5cbiAgICAgICAgJGh0dHAuZ2V0KFJlc3RmdWxBcGkuZ2V0Um91dGUoJ3NlY3Rpb24nLCAnc2hvdycsIG1vZGFsRGF0YS5zZWN0aW9uSWQpKS5cbiAgICAgICAgICAgIHN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgICAgICBSZXN0ZnVsQXBpLnN1Y2Nlc3MoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpO1xuICAgICAgICAgICAgICAgICRzY29wZS5zZWN0aW9uID0gZGF0YTtcbiAgICAgICAgICAgIH0pLlxuICAgICAgICAgICAgZXJyb3IoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgICAgICBSZXN0ZnVsQXBpLmVycm9yKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gZGF0YTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgfVxuXG5cbiAgICAkc2NvcGUuc2F2ZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIGNvbnNvbGUubG9nKG1vZGFsRGF0YS5wcm9qZWN0SWQpO1xuXG4gICAgICAgIGlmIChtb2RhbERhdGEuY3JlYXRlKXtcblxuICAgICAgICAgICAgJGh0dHAucG9zdChSZXN0ZnVsQXBpLmdldFJvdXRlKCdwcm9qZWN0U2VjdGlvbicsICdzdG9yZScsIG1vZGFsRGF0YS5wcm9qZWN0SWQpLCAkc2NvcGUuc2VjdGlvbilcbiAgICAgICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgICAgICAgICBSZXN0ZnVsQXBpLnN1Y2Nlc3MoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpO1xuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmFkZChcIlNlY3Rpb24gJ1wiICsgZGF0YS50aXRsZSArIFwiJyBjcmVhdGVkIHN1Y2Nlc3NmdWxseVwiLCAnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gW107XG4gICAgICAgICAgICAgICAgICAgICRtb2RhbEluc3RhbmNlLmNsb3NlKGRhdGEsIHRydWUpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgIFJlc3RmdWxBcGkuZXJyb3IoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAkaHR0cC5wdXQoUmVzdGZ1bEFwaS5nZXRSb3V0ZSgnc2VjdGlvbicsICd1cGRhdGUnLCAkc2NvcGUuc2VjdGlvbi5pZCksICRzY29wZS5zZWN0aW9uKVxuICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgIFJlc3RmdWxBcGkuc3VjY2VzcyhkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZyk7XG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuYWRkKFwiU2VjdGlvbiAnXCIgKyBkYXRhLnRpdGxlICsgXCInIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5XCIsICdzdWNjZXNzJyk7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgJG1vZGFsSW5zdGFuY2UuY2xvc2UoZGF0YSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgIFJlc3RmdWxBcGkuZXJyb3IoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gZGF0YTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJG1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XG4gICAgfTtcbn0pO1xuXG5hcHAuY29udHJvbGxlcignUHJvamVjdFNlY3Rpb25Db250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkZmlsdGVyLCBuZ1RhYmxlUGFyYW1zLCAkaHR0cCwgJHJvdXRlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbikge1xuXG4gICAgJHNjb3BlLmRhdGEgPSBbXTtcblxuICAgIC8vIEluaXRpYWxpc2UgdGhlIGRhdGEgdGFibGVcbiAgICAkc2NvcGUudGFibGVQYXJhbXMgPSBuZXcgbmdUYWJsZVBhcmFtcyh7XG4gICAgICAgIHBhZ2U6IDEsICAgICAgICAgICAgLy8gc2hvdyBmaXJzdCBwYWdlXG4gICAgICAgIGNvdW50OiAxMCwgICAgICAgICAgLy8gY291bnQgcGVyIHBhZ2VcbiAgICAgICAgc29ydGluZzoge1xuICAgICAgICAgICAgY3JlYXRlZF9hdDogJ2Rlc2MnICAgICAvLyBpbml0aWFsIHNvcnRpbmdcbiAgICAgICAgfSxcbiAgICB9LCB7XG4gICAgICAgIGZpbHRlckRlbGF5OiAxMCxcbiAgICAgICAgdG90YWw6ICRzY29wZS5kYXRhLmxlbmd0aCwgLy8gbGVuZ3RoIG9mIGRhdGFcbiAgICAgICAgZ2V0RGF0YTogZnVuY3Rpb24oJGRlZmVyLCBwYXJhbXMpIHtcbiAgICAgICAgICAgIC8vIHVzZSBidWlsZC1pbiBhbmd1bGFyIGZpbHRlclxuICAgICAgICAgICAgdmFyIGZpbHRlcmVkRGF0YSA9IHBhcmFtcy5maWx0ZXIoKSA/XG4gICAgICAgICAgICAgICAgICAgICRmaWx0ZXIoJ2ZpbHRlcicpKCRzY29wZS5kYXRhLCBwYXJhbXMuZmlsdGVyKCkpIDpcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGE7XG4gICAgICAgICAgICB2YXIgb3JkZXJlZERhdGEgPSBwYXJhbXMuc29ydGluZygpID9cbiAgICAgICAgICAgICAgICAgICAgJGZpbHRlcignb3JkZXJCeScpKGZpbHRlcmVkRGF0YSwgcGFyYW1zLm9yZGVyQnkoKSkgOlxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YTtcblxuICAgICAgICAgICAgcGFyYW1zLnRvdGFsKG9yZGVyZWREYXRhLmxlbmd0aCk7IC8vIHNldCB0b3RhbCBmb3IgcmVjYWxjIHBhZ2luYXRpb25cbiAgICAgICAgICAgICRkZWZlci5yZXNvbHZlKG9yZGVyZWREYXRhLnNsaWNlKChwYXJhbXMucGFnZSgpIC0gMSkgKiBwYXJhbXMuY291bnQoKSwgcGFyYW1zLnBhZ2UoKSAqIHBhcmFtcy5jb3VudCgpKSk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgICRzY29wZS5pbml0ID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgY29uc29sZS5sb2coJHJvdXRlUGFyYW1zLnByb2plY3RfaWQpO1xuXG4gICAgICAgICRodHRwLmdldCgnL2FkbWluL2FwaS9wcm9qZWN0LycgKyAkcm91dGVQYXJhbXMucHJvamVjdF9pZCArICcvc2VjdGlvbicpLlxuICAgICAgICBzdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAkc2NvcGUuZGF0YSA9IGRhdGE7XG5cbiAgICAgICAgICAgIC8vIFBhcnNlIElEIGZyb20gdGV4dCB0byBpbnRlZ2VyXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZGF0YSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBkYXRhLmlkICA9IHBhcnNlRmxvYXQoZGF0YS5pZCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJHNjb3BlLnRhYmxlUGFyYW1zLnJlbG9hZCgpO1xuXG4gICAgICAgIH0pLlxuICAgICAgICBlcnJvcihmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coc3RhdHVzKTtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gNDAxKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9ycyA9IFt7XCJMb2dnZWQgb3V0XCIgOiBcIllvdSBoYXZlIGJlZW4gbG9nZ2VkIG91dC4gUmVmcmVzaCB0aGUgcGFnZSB0byBsb2cgYmFjayBpbiBhZ2FpblwifV07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBkYXRhO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuXG4gICAgfTtcblxuXG4gICAgJHNjb3BlLmRlbGV0ZSA9IGZ1bmN0aW9uKGlkKSB7XG5cbiAgICAgICAgJGh0dHAuZGVsZXRlKCcvYWRtaW4vYXBpL3Byb2plY3QvJyArIGlkKS5cbiAgICAgICAgICBzdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmluaXQoKTtcbiAgICAgICAgICB9KS5cbiAgICAgICAgICBlcnJvcihmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBkYXRhO1xuICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgICRzY29wZS5pbml0KCk7XG5cbn0pO1xuXG5cblxuYXBwLmNvbnRyb2xsZXIoJ1NlY3Rpb25DcmVhdGVDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHJvdXRlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbikge1xuXG4gICAgJHNjb3BlLmRhdGEgPSB7fTtcblxuICAgICRzY29wZS5zYXZlID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgJGh0dHAucG9zdCgnL2FkbWluL2FwaS9wcm9qZWN0JywgJHNjb3BlLmRhdGEpLlxuICAgICAgICAgICAgc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCBcIi9wcm9qZWN0XCIgKTtcbiAgICAgICAgICAgIH0pLlxuICAgICAgICAgICAgZXJyb3IoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09IDQwMSkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gW3tcIkxvZ2dlZCBvdXRcIiA6IFwiWW91IGhhdmUgYmVlbiBsb2dnZWQgb3V0LiBSZWZyZXNoIHRoZSBwYWdlIHRvIGxvZyBiYWNrIGluIGFnYWluXCJ9XTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gZGF0YTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbn0pO1xuXG5cbmFwcC5jb250cm9sbGVyKCdTZWN0aW9uRWRpdENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkcm91dGUsICRyb3V0ZVBhcmFtcywgJGxvY2F0aW9uKSB7XG5cbiAgICAkc2NvcGUuZGF0YSA9IHt9O1xuXG4gICAgJGh0dHAuZ2V0KCcvYWRtaW4vYXBpL3NlY3Rpb24vJyArICRyb3V0ZVBhcmFtcy5pZCkuXG4gICAgICAgIHN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgICRzY29wZS5kYXRhID0gZGF0YTtcbiAgICAgICAgfSkuXG4gICAgICAgIGVycm9yKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzID09IDQwMSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBbe1wiTG9nZ2VkIG91dFwiIDogXCJZb3UgaGF2ZSBiZWVuIGxvZ2dlZCBvdXQuIFJlZnJlc2ggdGhlIHBhZ2UgdG8gbG9nIGJhY2sgaW4gYWdhaW5cIn1dO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gZGF0YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cblxuICAgICRzY29wZS5hZGRTZWN0aW9uID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgJHNjb3BlLmRhdGEuc2VjdGlvbnMucHVzaCh7fSk7XG5cbiAgICB9O1xuXG4gICAgJHNjb3BlLmRlbGV0ZVNlY3Rpb24gPSBmdW5jdGlvbihpbmRleCkge1xuXG4gICAgICAgICRzY29wZS5kYXRhLnNlY3Rpb25zLnNwbGljZShpbmRleCwgMSk7XG5cbiAgICB9O1xuXG5cbiAgICAkc2NvcGUuc2F2ZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICRodHRwLnB1dCgnL2FkbWluL2FwaS9zZWN0aW9uLycgKyAkcm91dGVQYXJhbXMuaWQsICRzY29wZS5kYXRhKS5cbiAgICAgICAgICAgIHN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcblxuXG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoIFwiL3Byb2plY3QvXCIgKyBkYXRhLmF0dGFjaG1lbnRfaWQgKyBcIi9zZWN0aW9uXCIpO1xuICAgICAgICAgICAgfSkuXG4gICAgICAgICAgICBlcnJvcihmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT0gNDAxKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBbe1wiTG9nZ2VkIG91dFwiIDogXCJZb3UgaGF2ZSBiZWVuIGxvZ2dlZCBvdXQuIFJlZnJlc2ggdGhlIHBhZ2UgdG8gbG9nIGJhY2sgaW4gYWdhaW5cIn1dO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBkYXRhO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxufSk7XG5hcHAuY29udHJvbGxlcignVGFnQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGZpbHRlciwgbmdUYWJsZVBhcmFtcywgJGh0dHAsIFJlc3RmdWxBcGksIG5vdGlmaWNhdGlvblNlcnZpY2UpIHtcblxuICAgIC8vIEluaXRpYWxpc2UgYW4gZW1wdHkgYXJyYXkgdG8gaG9sZCBkYXRhXG4gICAgJHNjb3BlLmRhdGEgPSBbXTtcblxuICAgIC8vIEluaXRpYWxpc2UgdGhlIGRhdGEgdGFibGVcbiAgICAkc2NvcGUudGFibGVQYXJhbXMgPSBuZXcgbmdUYWJsZVBhcmFtcyh7XG4gICAgICAgIHBhZ2U6IDEsICAgICAgICAgICAgLy8gc2hvdyBmaXJzdCBwYWdlXG4gICAgICAgIGNvdW50OiAxMCwgICAgICAgICAgLy8gY291bnQgcGVyIHBhZ2VcbiAgICAgICAgc29ydGluZzoge1xuICAgICAgICAgICAgdXBkYXRlZF9hdDogJ2Rlc2MnICAgICAvLyBpbml0aWFsIHNvcnRpbmdcbiAgICAgICAgfSxcbiAgICB9LCB7XG4gICAgICAgIGZpbHRlckRlbGF5OiAxMCxcbiAgICAgICAgdG90YWw6ICRzY29wZS5kYXRhLmxlbmd0aCwgLy8gbGVuZ3RoIG9mIGRhdGFcbiAgICAgICAgZ2V0RGF0YTogZnVuY3Rpb24oJGRlZmVyLCBwYXJhbXMpIHtcbiAgICAgICAgICAgIC8vIHVzZSBidWlsZC1pbiBhbmd1bGFyIGZpbHRlclxuICAgICAgICAgICAgdmFyIGZpbHRlcmVkRGF0YSA9IHBhcmFtcy5maWx0ZXIoKSA/XG4gICAgICAgICAgICAgICAgICAgICRmaWx0ZXIoJ2ZpbHRlcicpKCRzY29wZS5kYXRhLCBwYXJhbXMuZmlsdGVyKCkpIDpcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGE7XG4gICAgICAgICAgICB2YXIgb3JkZXJlZERhdGEgPSBwYXJhbXMuc29ydGluZygpID9cbiAgICAgICAgICAgICAgICAgICAgJGZpbHRlcignb3JkZXJCeScpKGZpbHRlcmVkRGF0YSwgcGFyYW1zLm9yZGVyQnkoKSkgOlxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YTtcblxuICAgICAgICAgICAgcGFyYW1zLnRvdGFsKG9yZGVyZWREYXRhLmxlbmd0aCk7IC8vIHNldCB0b3RhbCBmb3IgcmVjYWxjIHBhZ2luYXRpb25cbiAgICAgICAgICAgICRkZWZlci5yZXNvbHZlKG9yZGVyZWREYXRhLnNsaWNlKChwYXJhbXMucGFnZSgpIC0gMSkgKiBwYXJhbXMuY291bnQoKSwgcGFyYW1zLnBhZ2UoKSAqIHBhcmFtcy5jb3VudCgpKSk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEluaXRpYWxpc2UgKGxvYWQpIGRhdGFcbiAgICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIC8vY29uc29sZS5sb2coUmVzdGZ1bEFwaS5nZXRSb3V0ZSgncHJvamVjdCcsICd1cGRhdGUnLCA0KSk7XG5cbiAgICAgICAgJGh0dHAuZ2V0KFJlc3RmdWxBcGkuZ2V0Um91dGUoJ3RhZycsICdpbmRleCcpKS5cbiAgICAgICAgc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgUmVzdGZ1bEFwaS5zdWNjZXNzKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKTtcbiAgICAgICAgICAgICRzY29wZS5kYXRhID0gZGF0YTtcbiAgICAgICAgICAgICRzY29wZS50YWJsZVBhcmFtcy5yZWxvYWQoKTtcbiAgICAgICAgfSkuXG4gICAgICAgIGVycm9yKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICBSZXN0ZnVsQXBpLmVycm9yKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKTtcbiAgICAgICAgfSk7XG5cbiAgICB9O1xuXG5cbiAgICAkc2NvcGUuZGVsZXRlID0gZnVuY3Rpb24oaWQsIHRpdGxlKSB7XG5cbiAgICAgICAgaWYgKGNvbmZpcm0oJ0FyZSB5b3Ugc3VyZSB5b3Ugd2lzaCB0byBkZWxldGUgJyArIHRpdGxlICsgJz8nKSkge1xuXG4gICAgICAgICAgICAkaHR0cC5kZWxldGUoUmVzdGZ1bEFwaS5nZXRSb3V0ZSgndGFnJywgJ2Rlc3Ryb3knLCBpZCkpLlxuICAgICAgICAgICAgICAgIHN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5hZGQoXCJQcm9qZWN0ICdcIiArIGRhdGEudGl0bGUgKyBcIicgZGVsZXRlZCBzdWNjZXNzZnVsbHlcIiwgJ2luZm8nKTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmluaXQoKTtcbiAgICAgICAgICAgICAgICB9KS5cbiAgICAgICAgICAgICAgICBlcnJvcihmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgICAgICAgICBSZXN0ZnVsQXBpLmVycm9yKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9ycyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkc2NvcGUuaW5pdCgpO1xuXG5cbn0pO1xuXG5cbmFwcC5jb250cm9sbGVyKCdUYWdDcmVhdGVDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHN0YXRlUGFyYW1zLCAkc3RhdGUsIFJlc3RmdWxBcGksIG5vdGlmaWNhdGlvblNlcnZpY2UpIHtcblxuICAgICRzY29wZS5kYXRhID0ge307XG5cbiAgICAkc2NvcGUuY3JlYXRlID0gdHJ1ZTtcblxuICAgICRzY29wZS5zYXZlID0gZnVuY3Rpb24oYXBwbHkpIHtcblxuICAgICAgICAkaHR0cC5wb3N0KFJlc3RmdWxBcGkuZ2V0Um91dGUoJ3RhZycsICdzdG9yZScpLCAkc2NvcGUuZGF0YSkuXG4gICAgICAgICAgICBzdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgUmVzdGZ1bEFwaS5zdWNjZXNzKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKTtcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmFkZChcIlRhZyAnXCIgKyBkYXRhLnRpdGxlICsgXCInIGFkZGVkIHN1Y2Nlc3NmdWxseVwiLCAnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBbXTtcbiAgICAgICAgICAgICAgICBpZiAoIWFwcGx5KSB7XG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbyggXCJ0YWcuaW5kZXhcIiApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICAgICAgICAkc3RhdGUuZ28oIFwidGFnLmVkaXRcIiwge2lkOiBkYXRhLmlkfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuXG4gICAgICAgICAgICBlcnJvcihmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgICAgIFJlc3RmdWxBcGkuZXJyb3IoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpO1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBkYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG59KTtcblxuXG5hcHAuY29udHJvbGxlcignVGFnRWRpdENvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRodHRwLCAkc3RhdGVQYXJhbXMsICRzdGF0ZSwgUmVzdGZ1bEFwaSwgbm90aWZpY2F0aW9uU2VydmljZSwgbmdUYWJsZVBhcmFtcywgJGZpbHRlciwgJG1vZGFsKSB7XG5cbiAgICAkc2NvcGUuZGF0YSA9IHt9O1xuXG4gICAgJGh0dHAuZ2V0KFJlc3RmdWxBcGkuZ2V0Um91dGUoJ3RhZycsICdzaG93JywgJHN0YXRlUGFyYW1zLmlkKSkuXG4gICAgICAgIHN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgIFJlc3RmdWxBcGkuc3VjY2VzcyhkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZyk7XG4gICAgICAgICAgICAkc2NvcGUuZGF0YSA9IGRhdGE7XG4gICAgICAgIH0pLlxuICAgICAgICBlcnJvcihmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgUmVzdGZ1bEFwaS5lcnJvcihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZyk7XG4gICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gZGF0YTtcbiAgICAgICAgfSk7XG5cbiAgICAkc2NvcGUuc2F2ZSA9IGZ1bmN0aW9uKGFwcGx5KSB7XG4gICAgICAgIGFwcGx5ID0gdHlwZW9mIGFwcGx5ICE9PSAndW5kZWZpbmVkJyA/IGFwcGx5IDogZmFsc2U7XG4gICAgICAgICRzY29wZS5wdXQoYXBwbHkpO1xuICAgIH1cblxuICAgICRzY29wZS5wdXQgPSBmdW5jdGlvbihhcHBseSkge1xuICAgICAgICAkaHR0cC5wdXQoUmVzdGZ1bEFwaS5nZXRSb3V0ZSgndGFnJywgJ3VwZGF0ZScsICRzdGF0ZVBhcmFtcy5pZCksICRzY29wZS5kYXRhKS5cbiAgICAgICAgc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgUmVzdGZ1bEFwaS5zdWNjZXNzKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKTtcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuYWRkKFwiVGFnICdcIiArIGRhdGEudGl0bGUgKyBcIicgdXBkYXRlZCBzdWNjZXNzZnVsbHlcIiwgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBbXTtcbiAgICAgICAgICAgIGlmICghYXBwbHkpIHtcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oIFwidGFnLmluZGV4XCIgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkuXG4gICAgICAgIGVycm9yKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICBSZXN0ZnVsQXBpLmVycm9yKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKTtcbiAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBkYXRhO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxufSk7XG5cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==