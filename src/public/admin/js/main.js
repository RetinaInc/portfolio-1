var app=angular.module("ng-portfolio",["ui.router","ui.bootstrap","ngTable","hc.marked","ngTagsInput"]);app.config(function($httpProvider){$httpProvider.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";$httpProvider.interceptors.push("HttpInterceptor")});app.config(function(tagsInputConfigProvider){tagsInputConfigProvider.setDefaults("tagsInput",{replaceSpacesWithDashes:false})});app.config(["markedProvider",function(markedProvider){markedProvider.setOptions({gfm:true,tables:true})}]);app.config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/dashboard");$stateProvider.state("dashboard",{url:"/dashboard",templateUrl:"/vendor/portfolio/admin/views/dashboard.html",controller:"DashboardController"}).state("project",{url:"/project",templateUrl:"/vendor/portfolio/admin/views/project/project.html"}).state("project.index",{url:"/index",templateUrl:"/vendor/portfolio/admin/views/project/project.index.html",controller:"ProjectController"}).state("project.create",{url:"/create",templateUrl:"/vendor/portfolio/admin/views/project/project.edit.html",controller:"ProjectCreateController"}).state("project.edit",{url:"/:id/edit",templateUrl:"/vendor/portfolio/admin/views/project/project.edit.html",controller:"ProjectEditController"}).state("tag",{url:"/tag",templateUrl:"/vendor/portfolio/admin/views/tag/tag.html"}).state("tag.index",{url:"/index",templateUrl:"/vendor/portfolio/admin/views/tag/tag.index.html",controller:"TagController"}).state("tag.create",{url:"/create",templateUrl:"/vendor/portfolio/admin/views/tag/tag.edit.html",controller:"TagCreateController"}).state("tag.edit",{url:"/:id/edit",templateUrl:"/vendor/portfolio/admin/views/tag/tag.edit.html",controller:"TagEditController"})});app.factory("RestfulApi",function(){return{getRoute:function(resource,method,id){if(typeof id==="undefined"){id="0"}var prefix="/api";var routes={project:{index:prefix+"/project",show:prefix+"/project/"+id,store:prefix+"/project",update:prefix+"/project/"+id,destroy:prefix+"/project/"+id},section:{index:prefix+"/section",show:prefix+"/section/"+id,store:prefix+"/section",update:prefix+"/section/"+id,destroy:prefix+"/section/"+id},projectSection:{store:prefix+"/project/"+id+"/section"},tag:{index:prefix+"/tag",show:prefix+"/tag/"+id,store:prefix+"/tag",update:prefix+"/tag/"+id,destroy:prefix+"/tag/"+id}};return routes[resource][method]}}});app.factory("HttpInterceptor",function($q,notificationService){var checkResponseCode=function(data,status){switch(status){case 422:notificationService.clear();var msg=[];angular.forEach(data,function(value,key){msg=msg.concat(value)});notificationService.add("Validation failed, please correct the following issues:","danger",msg);break;case 401:notificationService.add("You have been logged out","warning");break;case 500:notificationService.add("API error","danger");break;default:console.log("Some other problem!");console.log(data)}};return{request:function(config){return config},requestError:function(rejection){if(canRecover(rejection)){return responseOrNewPromise}return $q.reject(rejection)},response:function(response){notificationService.removeByType("danger");return response},responseError:function(rejection){checkResponseCode(rejection.data,rejection.status);console.log(rejection);if(canRecover(rejection)){return responseOrNewPromise}return $q.reject(rejection)}}});app.service("notificationService",function($timeout){var notifications=[];this.get=function(){return notifications};this.add=function(message,type,messages){if(type=="success"){this.removeByType("success")}var notification={type:type,message:message,messages:messages};notifications.push(notification);console.log("added "+type+" message");if(type!="danger"){$timeout(function(){notifications.splice(notifications.indexOf(notification),1)},6e3)}};this.removeByIndex=function(index){console.log("removing one message: "+index);notifications.splice(index,1)};this.removeByType=function(type){console.log("clearing "+type+" messages");for(i=0;i<notifications.length;i++){if(notifications[i].type==type){notifications.splice(i,1)}}};this.clear=function(){console.log("clearing all messages");notifications=[]}});app.controller("NotificationController",function($scope,notificationService,$timeout){$scope.notifier=notificationService;$scope.$watch("notifier.get()",function(notifications){if(angular.isDefined(notifications)){$scope.notifications=notifications}},true);$scope.closeNotification=function(index){notificationService.removeByIndex(index)}});app.controller("DashboardController",function($scope,$http,$stateParams){});app.controller("ProjectController",function($scope,$filter,ngTableParams,$http,RestfulApi,notificationService){$scope.data=[];$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{updated_at:"desc"}},{filterDelay:10,total:$scope.data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data;var orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length);$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}});$scope.init=function(){$http.get(RestfulApi.getRoute("project","index")).success(function(data){$scope.data=data;$scope.tableParams.reload()})};$scope.delete=function(id,title){if(confirm("Are you sure you wish to delete "+title+"?")){$http.delete("/admin/api/project/"+id).success(function(data){notificationService.add("Project '"+data.title+"' deleted successfully","info");$scope.init()}).error(function(data){$scope.errors=data})}};$scope.init()});app.controller("ProjectCreateController",function($scope,$http,$stateParams,$state,RestfulApi,notificationService){$scope.data={};$scope.create=true;$scope.save=function(apply){$http.post(RestfulApi.getRoute("project","store"),$scope.data).success(function(data){notificationService.add("Project '"+data.title+"' added successfully","success");$scope.errors=[];if(!apply){$state.go("project.index")}else{$state.go("project.edit",{id:data.id})}}).error(function(data){$scope.errors=data})}});app.controller("ProjectEditController",function($scope,$http,$stateParams,$state,RestfulApi,notificationService,ngTableParams,$filter,$modal){$scope.data={sections:[]};$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{updated_at:"desc"}},{filterDelay:10,total:$scope.data.sections.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data.sections,params.filter()):$scope.data.sections;var orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data.sections;params.total(orderedData.length);$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}});$http.get(RestfulApi.getRoute("project","show",$stateParams.id)).success(function(data){$scope.data=data;$scope.slug=$scope.data.slug;$scope.tableParams.reload()}).error(function(data,status,headers,config){$scope.errors=data});$scope.editSection=function(create,sectionId){sectionId=typeof sectionId!=="undefined"?sectionId:false;modalData={create:create,projectId:$scope.data.id,sectionId:sectionId};console.log(modalData);var modalInstance=$modal.open({animation:true,templateUrl:"sectionEdit.html",controller:"editSectionController",size:"lg",resolve:{modalData:function(){return modalData}}});modalInstance.result.then(function(section){console.log("modal closed");console.log(section);if(create){$scope.data.sections.push(section)}else{angular.forEach($scope.data.sections,function(value,key){if(value.id==sectionId){console.log("updated section: "+value.id);$scope.data.sections[key]=section}})}console.log($scope.data.sections);$scope.tableParams.reload()})};$scope.slugWarning=function(){notificationService.removeByType("warning");if($scope.slug!=$scope.data.slug){notificationService.add("You have modified the project slug. Please be aware that this may break hyperlinks to this project.","warning")}};$scope.save=function(apply){apply=typeof apply!=="undefined"?apply:false;if($scope.slug!=$scope.data.slug){if(confirm("Are you sure you wish to change the slug?")){$scope.put(apply)}else{$scope.data.slug=$scope.slug;notificationService.removeByType("warning");notificationService.add("Slug reset","info")}}else{$scope.put(apply)}};$scope.put=function(apply){$http.put(RestfulApi.getRoute("project","update",$stateParams.id),$scope.data).success(function(data){notificationService.add("Project '"+data.title+"' updated successfully","success");$scope.errors=[];if(!apply){$state.go("project.index")}}).error(function(data){$scope.errors=data})}});app.controller("editSectionController",function($scope,$http,$modalInstance,RestfulApi,notificationService,modalData){if(!modalData.create){$http.get(RestfulApi.getRoute("section","show",modalData.sectionId)).success(function(data){$scope.section=data}).error(function(data){$scope.errors=data})}$scope.save=function(){console.log(modalData.create);if(modalData.create){console.log("creating");$http.post(RestfulApi.getRoute("projectSection","store",modalData.projectId),$scope.section).success(function(data){notificationService.add("Section '"+data.title+"' created successfully","success");$scope.errors=[];$modalInstance.close(data)}).error(function(data){$scope.errors=data})}else{console.log("editing");$http.put(RestfulApi.getRoute("section","update",$scope.section.id),$scope.section).success(function(data){notificationService.add("Section '"+data.title+"' updated successfully","success");$scope.errors=[];$modalInstance.close(data)}).error(function(data){$scope.errors=data})}};$scope.cancel=function(){$modalInstance.dismiss("cancel")}});app.controller("TagController",function($scope,$filter,ngTableParams,$http,notificationService){$scope.data=[];$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{updated_at:"desc"}},{filterDelay:10,total:$scope.data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data;var orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length);$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}});$scope.init=function(){$http.get("/api/tag").success(function(data){$scope.data=data;$scope.tableParams.reload()})};$scope.delete=function(id,title){if(confirm("Are you sure you wish to delete "+title+"?")){$http.delete("/api/tag/"+id).success(function(data){notificationService.add("Project '"+data.title+"' deleted successfully","info");$scope.init()}).error(function(data){$scope.errors=data})}};$scope.init()});app.controller("TagCreateController",function($scope,$http,$stateParams,$state,notificationService){$scope.data={};$scope.save=function(apply){$http.post("/api/tag",$scope.data).success(function(data){notificationService.add("Tag '"+data.title+"' added successfully","success");$scope.errors=[];if(!apply){$state.go("tag.index")}else{$state.go("tag.edit",{id:data.id})}}).error(function(data){$scope.errors=data})}});app.controller("TagEditController",function($scope,$http,$stateParams,$state,notificationService,ngTableParams,$filter,$modal){$scope.data={projects:[]};$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{updated_at:"desc"}},{filterDelay:10,total:$scope.data.projects.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data.projects,params.filter()):$scope.data.projects;var orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data.projects;params.total(orderedData.length);$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}});$http.get("/api/tag/"+$stateParams.id).success(function(data){$scope.data=data;$scope.tableParams.reload()}).error(function(data){$scope.errors=data});$scope.save=function(apply){apply=typeof apply!=="undefined"?apply:false;$http.put("/api/tag/"+$stateParams.id,$scope.data).success(function(data){notificationService.add("Tag '"+data.title+"' updated successfully","success");$scope.errors=[];if(!apply){$state.go("tag.index")}}).error(function(data){$scope.errors=data})}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9wdWJsaWMvYWRtaW4vanMvbWFpbi5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJGh0dHBQcm92aWRlciIsImRlZmF1bHRzIiwiaGVhZGVycyIsImNvbW1vbiIsImludGVyY2VwdG9ycyIsInB1c2giLCJ0YWdzSW5wdXRDb25maWdQcm92aWRlciIsInNldERlZmF1bHRzIiwicmVwbGFjZVNwYWNlc1dpdGhEYXNoZXMiLCJtYXJrZWRQcm92aWRlciIsInNldE9wdGlvbnMiLCJnZm0iLCJ0YWJsZXMiLCIkc3RhdGVQcm92aWRlciIsIiR1cmxSb3V0ZXJQcm92aWRlciIsIm90aGVyd2lzZSIsInN0YXRlIiwidXJsIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwiZmFjdG9yeSIsImdldFJvdXRlIiwicmVzb3VyY2UiLCJtZXRob2QiLCJpZCIsInByZWZpeCIsInJvdXRlcyIsInByb2plY3QiLCJpbmRleCIsInNob3ciLCJzdG9yZSIsInVwZGF0ZSIsImRlc3Ryb3kiLCJzZWN0aW9uIiwicHJvamVjdFNlY3Rpb24iLCJ0YWciLCIkcSIsIm5vdGlmaWNhdGlvblNlcnZpY2UiLCJjaGVja1Jlc3BvbnNlQ29kZSIsImRhdGEiLCJzdGF0dXMiLCJjbGVhciIsIm1zZyIsImZvckVhY2giLCJ2YWx1ZSIsImtleSIsImNvbmNhdCIsImFkZCIsImNvbnNvbGUiLCJsb2ciLCJyZXF1ZXN0IiwicmVxdWVzdEVycm9yIiwicmVqZWN0aW9uIiwiY2FuUmVjb3ZlciIsInJlc3BvbnNlT3JOZXdQcm9taXNlIiwicmVqZWN0IiwicmVzcG9uc2UiLCJyZW1vdmVCeVR5cGUiLCJyZXNwb25zZUVycm9yIiwic2VydmljZSIsIiR0aW1lb3V0Iiwibm90aWZpY2F0aW9ucyIsInRoaXMiLCJnZXQiLCJtZXNzYWdlIiwidHlwZSIsIm1lc3NhZ2VzIiwibm90aWZpY2F0aW9uIiwic3BsaWNlIiwiaW5kZXhPZiIsInJlbW92ZUJ5SW5kZXgiLCJpIiwibGVuZ3RoIiwiJHNjb3BlIiwibm90aWZpZXIiLCIkd2F0Y2giLCJpc0RlZmluZWQiLCJjbG9zZU5vdGlmaWNhdGlvbiIsIiRodHRwIiwiJHN0YXRlUGFyYW1zIiwiJGZpbHRlciIsIm5nVGFibGVQYXJhbXMiLCJSZXN0ZnVsQXBpIiwidGFibGVQYXJhbXMiLCJwYWdlIiwiY291bnQiLCJzb3J0aW5nIiwidXBkYXRlZF9hdCIsImZpbHRlckRlbGF5IiwidG90YWwiLCJnZXREYXRhIiwiJGRlZmVyIiwicGFyYW1zIiwiZmlsdGVyZWREYXRhIiwiZmlsdGVyIiwib3JkZXJlZERhdGEiLCJvcmRlckJ5IiwicmVzb2x2ZSIsInNsaWNlIiwiaW5pdCIsInN1Y2Nlc3MiLCJyZWxvYWQiLCJkZWxldGUiLCJ0aXRsZSIsImNvbmZpcm0iLCJlcnJvciIsImVycm9ycyIsIiRzdGF0ZSIsImNyZWF0ZSIsInNhdmUiLCJhcHBseSIsInBvc3QiLCJnbyIsIiRtb2RhbCIsInNlY3Rpb25zIiwic2x1ZyIsImVkaXRTZWN0aW9uIiwic2VjdGlvbklkIiwibW9kYWxEYXRhIiwicHJvamVjdElkIiwibW9kYWxJbnN0YW5jZSIsIm9wZW4iLCJhbmltYXRpb24iLCJzaXplIiwicmVzdWx0IiwidGhlbiIsInNsdWdXYXJuaW5nIiwicHV0IiwiJG1vZGFsSW5zdGFuY2UiLCJjbG9zZSIsImNhbmNlbCIsImRpc21pc3MiLCJwcm9qZWN0cyJdLCJtYXBwaW5ncyI6IkFBQ0EsR0FBSUEsS0FBTUMsUUFBUUMsT0FBTyxnQkFBaUIsWUFBYSxlQUFnQixVQUFXLFlBQWEsZUFhL0ZGLEtBQUlHLE9BQU8sU0FBU0MsZUFFaEJBLGNBQWNDLFNBQVNDLFFBQVFDLE9BQU8sb0JBQXNCLGdCQUU1REgsZUFBY0ksYUFBYUMsS0FBSyxvQkFHcENULEtBQUlHLE9BQU8sU0FBU08seUJBQ2xCQSx3QkFBd0JDLFlBQVksYUFDbENDLHdCQUEwQixTQU05QlosS0FBSUcsUUFBUSxpQkFBa0IsU0FBU1UsZ0JBQ25DQSxlQUFlQyxZQUNYQyxJQUFL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T0EsSUFDZGtDLFFBQU9VLFlBQVlrQixXQUV0QkksTUFBTSxTQUFTbEUsTUFDWmtDLE9BQU9pQyxPQUFTbkUsTUFJeEJrQyxRQUFPb0MsS0FBTyxTQUFTQyxPQUNuQkEsWUFBZUEsU0FBVSxZQUFjQSxNQUFRLEtBRS9DaEMsT0FBTWlELElBQUksWUFBY2hELGFBQWF2RCxHQUFJaUQsT0FBT2xDLE1BQzNDNkQsUUFBUSxTQUFTN0QsTUFDZEYsb0JBQW9CVSxJQUFJLFFBQVVSLEtBQUtnRSxNQUFRLHlCQUEwQixVQUN6RTlCLFFBQU9pQyxTQUNQLEtBQUtJLE1BQU8sQ0FDUkgsT0FBT0ssR0FBSSxnQkFHbEJQLE1BQU0sU0FBU2xFLE1BQ1prQyxPQUFPaUMsT0FBU25FIiwiZmlsZSI6InNyYy9wdWJsaWMvYWRtaW4vanMvbWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEZpcmUgdXAgdGhlIGFwcFxudmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCduZy1wb3J0Zm9saW8nLCBbJ3VpLnJvdXRlcicsICd1aS5ib290c3RyYXAnLCAnbmdUYWJsZScsICdoYy5tYXJrZWQnLCAnbmdUYWdzSW5wdXQnXSk7XG5cbi8qICBBbmd1bGFyIENvbmZpZ3VyYXRpb25cbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgQW5ndWxhciByb3V0ZXMgKHN0YXRlcykgYXJlIGRlZmluZWQgaGVyZS4gRWFjaCBTdGF0ZSBpcyB1c3VhbGx5IGFzc2lnbmVkIGEgY29udHJvbGxlciBhbmQgYSB2aWV3XG4qL1xuXG4vKiBhcHAuY29uZmlnKGZ1bmN0aW9uKCRpbnRlcnBvbGF0ZVByb3ZpZGVyKSB7XG4gICAgLy8gU2V0IEFuZ3VsYXIgdG8gdXNlIHNxdWFyZS1icmFja2V0cyBpbnN0ZWFkIG9mIGN1cmx5IC0gYSB3b3JrIGFyb3VuZCB0byBwbGF5IG5pY2Ugd2l0aCBMYXJhdmVsIEJsYWRlIHRlbXBsYXRlc1xuICAgICRpbnRlcnBvbGF0ZVByb3ZpZGVyLnN0YXJ0U3ltYm9sKCd7eycpO1xuICAgICRpbnRlcnBvbGF0ZVByb3ZpZGVyLmVuZFN5bWJvbCgnfX0nKTtcbn0pOyAqL1xuXG5hcHAuY29uZmlnKGZ1bmN0aW9uKCRodHRwUHJvdmlkZXIpIHtcbiAgICAvLyBBZGQgdGhlIFhNTEh0dHBSZXF1ZXN0IGhlYWRlciBzbyB0aGF0IExhcmF2ZWwgY2FuIHRlbGwgYXBhcnQgQUpBWCByZXF1ZXN0c1xuICAgICRodHRwUHJvdmlkZXIuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bXCJYLVJlcXVlc3RlZC1XaXRoXCJdID0gXCJYTUxIdHRwUmVxdWVzdFwiO1xuXG4gICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnSHR0cEludGVyY2VwdG9yJyk7XG59KTtcblxuYXBwLmNvbmZpZyhmdW5jdGlvbih0YWdzSW5wdXRDb25maWdQcm92aWRlcikge1xuICB0YWdzSW5wdXRDb25maWdQcm92aWRlci5zZXREZWZhdWx0cygndGFnc0lucHV0Jywge1xuICAgIHJlcGxhY2VTcGFjZXNXaXRoRGFzaGVzIDogZmFsc2VcbiAgICAvL3BsYWNlaG9sZGVyOiAnTmV3IHRhZycsXG4gICAgLy9yZW1vdmVUYWdTeW1ib2w6ICfinJYnXG4gIH0pXG59KTtcblxuYXBwLmNvbmZpZyhbJ21hcmtlZFByb3ZpZGVyJywgZnVuY3Rpb24obWFya2VkUHJvdmlkZXIpIHtcbiAgICBtYXJrZWRQcm92aWRlci5zZXRPcHRpb25zKHtcbiAgICAgICAgZ2ZtOiB0cnVlLFxuICAgICAgICB0YWJsZXM6IHRydWVcbiAgICB9KTtcbn1dKTtcblxuXG4vKiAgU3RhdGUgUHJvdmlkZXJcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgQW5ndWxhciByb3V0ZXMgKHN0YXRlcykgYXJlIGRlZmluZWQgaGVyZS4gRWFjaCBTdGF0ZSBpcyB1c3VhbGx5IGFzc2lnbmVkIGEgY29udHJvbGxlciBhbmQgYSB2aWV3XG4qL1xuYXBwLmNvbmZpZyhmdW5jdGlvbigkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XG5cbiAgLy8gRm9yIGFueSB1bm1hdGNoZWQgdXJsLCByZWRpcmVjdCB0byBkYXNib2FyZFxuICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKFwiL2Rhc2hib2FyZFwiKTtcblxuICAvLyBOb3cgc2V0IHVwIHRoZSBzdGF0ZXNcbiAgJHN0YXRlUHJvdmlkZXJcbiAgICAuc3RhdGUoJ2Rhc2hib2FyZCcsIHtcbiAgICAgIHVybDogXCIvZGFzaGJvYXJkXCIsXG4gICAgICB0ZW1wbGF0ZVVybDogXCIvdmVuZG9yL3BvcnRmb2xpby9hZG1pbi92aWV3cy9kYXNoYm9hcmQuaHRtbFwiLFxuICAgICAgY29udHJvbGxlcjogXCJEYXNoYm9hcmRDb250cm9sbGVyXCJcbiAgICB9KVxuICAgIC5zdGF0ZSgncHJvamVjdCcsIHtcbiAgICAgIHVybDogXCIvcHJvamVjdFwiLFxuICAgICAgdGVtcGxhdGVVcmw6IFwiL3ZlbmRvci9wb3J0Zm9saW8vYWRtaW4vdmlld3MvcHJvamVjdC9wcm9qZWN0Lmh0bWxcIixcbiAgICB9KVxuICAgIC5zdGF0ZSgncHJvamVjdC5pbmRleCcsIHtcbiAgICAgIHVybDogXCIvaW5kZXhcIixcbiAgICAgIHRlbXBsYXRlVXJsOiBcIi92ZW5kb3IvcG9ydGZvbGlvL2FkbWluL3ZpZXdzL3Byb2plY3QvcHJvamVjdC5pbmRleC5odG1sXCIsXG4gICAgICBjb250cm9sbGVyOiBcIlByb2plY3RDb250cm9sbGVyXCJcbiAgICB9KVxuICAgIC5zdGF0ZSgncHJvamVjdC5jcmVhdGUnLCB7XG4gICAgICB1cmw6IFwiL2NyZWF0ZVwiLFxuICAgICAgdGVtcGxhdGVVcmw6IFwiL3ZlbmRvci9wb3J0Zm9saW8vYWRtaW4vdmlld3MvcHJvamVjdC9wcm9qZWN0LmVkaXQuaHRtbFwiLFxuICAgICAgY29udHJvbGxlcjogXCJQcm9qZWN0Q3JlYXRlQ29udHJvbGxlclwiXG4gICAgfSlcbiAgICAuc3RhdGUoJ3Byb2plY3QuZWRpdCcsIHtcbiAgICAgIHVybDogXCIvOmlkL2VkaXRcIixcbiAgICAgIHRlbXBsYXRlVXJsOiBcIi92ZW5kb3IvcG9ydGZvbGlvL2FkbWluL3ZpZXdzL3Byb2plY3QvcHJvamVjdC5lZGl0Lmh0bWxcIixcbiAgICAgIGNvbnRyb2xsZXI6IFwiUHJvamVjdEVkaXRDb250cm9sbGVyXCJcbiAgICB9KVxuICAgIC5zdGF0ZSgndGFnJywge1xuICAgICAgdXJsOiBcIi90YWdcIixcbiAgICAgIHRlbXBsYXRlVXJsOiBcIi92ZW5kb3IvcG9ydGZvbGlvL2FkbWluL3ZpZXdzL3RhZy90YWcuaHRtbFwiLFxuICAgIH0pXG4gICAgLnN0YXRlKCd0YWcuaW5kZXgnLCB7XG4gICAgICB1cmw6IFwiL2luZGV4XCIsXG4gICAgICB0ZW1wbGF0ZVVybDogXCIvdmVuZG9yL3BvcnRmb2xpby9hZG1pbi92aWV3cy90YWcvdGFnLmluZGV4Lmh0bWxcIixcbiAgICAgIGNvbnRyb2xsZXI6IFwiVGFnQ29udHJvbGxlclwiXG4gICAgfSlcbiAgICAuc3RhdGUoJ3RhZy5jcmVhdGUnLCB7XG4gICAgICB1cmw6IFwiL2NyZWF0ZVwiLFxuICAgICAgdGVtcGxhdGVVcmw6IFwiL3ZlbmRvci9wb3J0Zm9saW8vYWRtaW4vdmlld3MvdGFnL3RhZy5lZGl0Lmh0bWxcIixcbiAgICAgIGNvbnRyb2xsZXI6IFwiVGFnQ3JlYXRlQ29udHJvbGxlclwiXG4gICAgfSlcbiAgICAuc3RhdGUoJ3RhZy5lZGl0Jywge1xuICAgICAgdXJsOiBcIi86aWQvZWRpdFwiLFxuICAgICAgdGVtcGxhdGVVcmw6IFwiL3ZlbmRvci9wb3J0Zm9saW8vYWRtaW4vdmlld3MvdGFnL3RhZy5lZGl0Lmh0bWxcIixcbiAgICAgIGNvbnRyb2xsZXI6IFwiVGFnRWRpdENvbnRyb2xsZXJcIlxuICAgIH0pO1xufSk7XG5cblxuXG4vKiAgUmVzdGZ1bCBBcGkgKERlcHJlY2F0ZWQpXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIFNvbWUgaGVscGZ1bCBmdW5jdGlvbnMgZm9yIEFKQVggcmVxdWVzdHNcbiovXG5hcHAuZmFjdG9yeSgnUmVzdGZ1bEFwaScsIGZ1bmN0aW9uICgpIHtcblxuICAgIHJldHVybiB7XG5cbiAgICAgICAgLy8gUmV0dXJucyB0aGUgc3RyaW5nIG9mIGEgcGFydGljdWxhciByb3V0ZVxuICAgICAgICBnZXRSb3V0ZTogZnVuY3Rpb24ocmVzb3VyY2UsIG1ldGhvZCwgaWQpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgaWQgPT09ICd1bmRlZmluZWQnKSB7IGlkID0gJzAnOyB9XG5cbiAgICAgICAgICAgIHZhciBwcmVmaXggPSAnL2FwaSc7XG5cbiAgICAgICAgICAgIHZhciByb3V0ZXMgPSB7XG4gICAgICAgICAgICAgICAgcHJvamVjdCAgICAgOiAge1xuICAgICAgICAgICAgICAgICAgICBpbmRleCAgIDogcHJlZml4ICsgJy9wcm9qZWN0JyxcbiAgICAgICAgICAgICAgICAgICAgc2hvdyAgICA6IHByZWZpeCArICcvcHJvamVjdC8nICsgaWQsXG4gICAgICAgICAgICAgICAgICAgIHN0b3JlICAgOiBwcmVmaXggKyAnL3Byb2plY3QnLFxuICAgICAgICAgICAgICAgICAgICB1cGRhdGUgIDogcHJlZml4ICsgJy9wcm9qZWN0LycgKyBpZCxcbiAgICAgICAgICAgICAgICAgICAgZGVzdHJveSA6IHByZWZpeCArICcvcHJvamVjdC8nICsgaWRcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHNlY3Rpb24gICAgIDogIHtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggICA6IHByZWZpeCArICcvc2VjdGlvbicsXG4gICAgICAgICAgICAgICAgICAgIHNob3cgICAgOiBwcmVmaXggKyAnL3NlY3Rpb24vJyArIGlkLFxuICAgICAgICAgICAgICAgICAgICBzdG9yZSAgIDogcHJlZml4ICsgJy9zZWN0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlICA6IHByZWZpeCArICcvc2VjdGlvbi8nICsgaWQsXG4gICAgICAgICAgICAgICAgICAgIGRlc3Ryb3kgOiBwcmVmaXggKyAnL3NlY3Rpb24vJyArIGlkXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBwcm9qZWN0U2VjdGlvbiAgICAgOiAge1xuICAgICAgICAgICAgICAgICAgICBzdG9yZSAgIDogcHJlZml4ICsgJy9wcm9qZWN0LycgKyBpZCArICcvc2VjdGlvbidcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRhZyAgICAgICAgIDogIHtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggICA6IHByZWZpeCArICcvdGFnJyxcbiAgICAgICAgICAgICAgICAgICAgc2hvdyAgICA6IHByZWZpeCArICcvdGFnLycgKyBpZCxcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUgICA6IHByZWZpeCArICcvdGFnJyxcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlICA6IHByZWZpeCArICcvdGFnLycgKyBpZCxcbiAgICAgICAgICAgICAgICAgICAgZGVzdHJveSA6IHByZWZpeCArICcvdGFnLycgKyBpZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJldHVybiByb3V0ZXNbcmVzb3VyY2VdW21ldGhvZF07XG5cbiAgICAgICAgfVxuICAgIH1cbn0pO1xuXG5cbi8qICBIVFRQIEludGVyY2VwdGVyXG4gICAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIEludGVyY2VwdHMgYWxsIEFKQVggcmVxdWVzdCBhbmQgcmVzcG9uc2VzLiBVc2VkIHRvIHBlcmZvcm0gYSBmZXcgY2hlY2tzIG9uIGVhY2ggcmVxdWVzdC5cbiovXG5hcHAuZmFjdG9yeSgnSHR0cEludGVyY2VwdG9yJywgZnVuY3Rpb24oJHEsIG5vdGlmaWNhdGlvblNlcnZpY2UpIHtcblxuICAgIC8vIFdvdCB0byBkbyBpbmNhc2UgQVBJIGZhaWxzIHRvIHJlc3BvbmQgd2l0aCAyMDBcbiAgICB2YXIgY2hlY2tSZXNwb25zZUNvZGUgPSBmdW5jdGlvbihkYXRhLCBzdGF0dXMpIHtcbiAgICAgICAgc3dpdGNoKHN0YXR1cykge1xuICAgICAgICAgICAgLy8gRmFpbGVkIHZhbGlkYXRpb25cbiAgICAgICAgICAgIGNhc2UgNDIyOlxuXG4gICAgICAgICAgICAgICAgLy8gQ2xlYXIgYWxsIGV4aXN0aW5nIG5vdGlmaWNhdGlvbnNcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmNsZWFyKCk7XG5cbiAgICAgICAgICAgICAgICAvLyBDb25jYXRlbmF0ZSBhbGwgdGhlIHZhbGlkYXRpb24gZXJyb3IgbWVzc2FnZXNcbiAgICAgICAgICAgICAgICB2YXIgbXNnID0gW107XG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGRhdGEsIGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgICAgICAgICAgICAgbXNnID0gbXNnLmNvbmNhdCh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBBZGQgdGhlIG5vdGlmaWNhdGlvblxuICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuYWRkKFwiVmFsaWRhdGlvbiBmYWlsZWQsIHBsZWFzZSBjb3JyZWN0IHRoZSBmb2xsb3dpbmcgaXNzdWVzOlwiLCAnZGFuZ2VyJywgbXNnKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgLy8gVW5hdXRoZW50aWNhdGVkXG4gICAgICAgICAgICBjYXNlIDQwMTpcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmFkZCgnWW91IGhhdmUgYmVlbiBsb2dnZWQgb3V0JywgJ3dhcm5pbmcnKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgNTAwOlxuICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuYWRkKCdBUEkgZXJyb3InLCAnZGFuZ2VyJyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU29tZSBvdGhlciBwcm9ibGVtIVwiKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICAgICAgfVxuICAgIH1cblxuXG4gIHJldHVybiB7XG4gICAgLy8gb3B0aW9uYWwgbWV0aG9kXG4gICAgJ3JlcXVlc3QnOiBmdW5jdGlvbihjb25maWcpIHtcbiAgICAgIC8vIGRvIHNvbWV0aGluZyBvbiBzdWNjZXNzXG4gICAgICAvL2NvbnNvbGUubG9nKCdyZXF1ZXN0Jyk7XG4gICAgICAvL2NvbnNvbGUubG9nKGNvbmZpZyk7XG4gICAgICByZXR1cm4gY29uZmlnO1xuICAgIH0sXG5cbiAgICAvLyBvcHRpb25hbCBtZXRob2RcbiAgICdyZXF1ZXN0RXJyb3InOiBmdW5jdGlvbihyZWplY3Rpb24pIHtcbiAgICAgIC8vIGRvIHNvbWV0aGluZyBvbiBlcnJvclxuICAgICAgaWYgKGNhblJlY292ZXIocmVqZWN0aW9uKSkge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2VPck5ld1Byb21pc2VcbiAgICAgIH1cbiAgICAgIHJldHVybiAkcS5yZWplY3QocmVqZWN0aW9uKTtcbiAgICB9LFxuXG4gICAgLy8gb3B0aW9uYWwgbWV0aG9kXG4gICAgJ3Jlc3BvbnNlJzogZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgIC8vIGRvIHNvbWV0aGluZyBvbiBzdWNjZXNzXG4gICAgICAvL2NvbnNvbGUubG9nKCdSZXNwb25zZScpO1xuICAgICAgLy9jb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICBub3RpZmljYXRpb25TZXJ2aWNlLnJlbW92ZUJ5VHlwZSgnZGFuZ2VyJyk7XG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSxcblxuICAgIC8vIG9wdGlvbmFsIG1ldGhvZFxuICAgJ3Jlc3BvbnNlRXJyb3InOiBmdW5jdGlvbihyZWplY3Rpb24pIHtcbiAgICAgIC8vIGRvIHNvbWV0aGluZyBvbiBlcnJvclxuICAgICAgY2hlY2tSZXNwb25zZUNvZGUocmVqZWN0aW9uLmRhdGEsIHJlamVjdGlvbi5zdGF0dXMpO1xuICAgICAgY29uc29sZS5sb2cocmVqZWN0aW9uKTtcblxuICAgICAgaWYgKGNhblJlY292ZXIocmVqZWN0aW9uKSkge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2VPck5ld1Byb21pc2VcbiAgICAgIH1cbiAgICAgIHJldHVybiAkcS5yZWplY3QocmVqZWN0aW9uKTtcbiAgICB9XG4gIH07XG59KTtcblxuXG4vKiAgTm90aWZpY2F0aW9uIFNlcnZpY2VcbiAgICAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgTWFuYWdlcyBwb3AtdXAgYWxlcnQgaW5mbyAmIGRhbmdlciBtZXNzYWdlcyB0aGF0IGFyZSBkaXNwbGF5ZWQgb24gcGFnZVxuKi9cbmFwcC5zZXJ2aWNlKCdub3RpZmljYXRpb25TZXJ2aWNlJywgZnVuY3Rpb24gKCR0aW1lb3V0KSB7XG5cbiAgICB2YXIgbm90aWZpY2F0aW9ucyA9IFtdO1xuXG4gICAgLy8gUmV0cmlldmUgYWxsIG1lc3NhZ2VzXG4gICAgdGhpcy5nZXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIG5vdGlmaWNhdGlvbnM7XG4gICAgfTtcblxuICAgIC8vIFJlbW92ZSBuZXcgbm90aWZpY2F0aW9uXG4gICAgdGhpcy5hZGQgPSBmdW5jdGlvbihtZXNzYWdlLCB0eXBlLCBtZXNzYWdlcykge1xuXG4gICAgICAgIC8vIE9ubHkgYWxsb3cgb25lIHN1Y2Nlc3MgbWVzc2FnZSBhdCBhIHRpbWVcbiAgICAgICAgaWYgKHR5cGUgPT0gJ3N1Y2Nlc3MnKSB7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZUJ5VHlwZSgnc3VjY2VzcycpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIG5vdGlmaWNhdGlvbiA9IHtcbiAgICAgICAgICAgIHR5cGUgOiB0eXBlLFxuICAgICAgICAgICAgbWVzc2FnZSA6IG1lc3NhZ2UsXG4gICAgICAgICAgICBtZXNzYWdlcyA6IG1lc3NhZ2VzLFxuICAgICAgICAgICAgLy9hY3Rpb24gOiBhY3Rpb25cbiAgICAgICAgfTtcblxuICAgICAgICBub3RpZmljYXRpb25zLnB1c2gobm90aWZpY2F0aW9uKTtcblxuICAgICAgICBjb25zb2xlLmxvZygnYWRkZWQgJyArIHR5cGUgKyAnIG1lc3NhZ2UnKTtcblxuICAgICAgICBpZiAodHlwZSAhPSAnZGFuZ2VyJykge1xuICAgICAgICAgICAgLy8gU2V0IHRoZSBhbGVydCB0byBiZSByZW1vdmVkIGFmdGVyIGEgZGVsYXlcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9ucy5zcGxpY2Uobm90aWZpY2F0aW9ucy5pbmRleE9mKG5vdGlmaWNhdGlvbiksIDEpO1xuICAgICAgICAgICAgfSwgNjAwMCk7IC8vIG1heWJlICd9LCAzMDAwLCBmYWxzZSk7JyB0byBhdm9pZCBjYWxsaW5nIGFwcGx5XG4gICAgICAgIH1cblxuICAgIH07XG5cbiAgICAvLyBSZW1vdmUgbm90aWZpY2F0aW9uIGJ5IGFycmF5IGluZGV4XG4gICAgdGhpcy5yZW1vdmVCeUluZGV4ID0gZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ3JlbW92aW5nIG9uZSBtZXNzYWdlOiAnICsgaW5kZXgpO1xuICAgICAgICBub3RpZmljYXRpb25zLnNwbGljZShpbmRleCwgMSk7XG4gICAgfVxuXG4gICAgLy8gUmVtb3ZlIGFsbCBub3RpZmljYXRpb25zIG9mIHR5cGVcbiAgICB0aGlzLnJlbW92ZUJ5VHlwZSA9IGZ1bmN0aW9uKHR5cGUpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2NsZWFyaW5nICcgKyB0eXBlICsgJyBtZXNzYWdlcycpO1xuICAgICAgICBmb3IgKGk9MDsgaSA8IG5vdGlmaWNhdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChub3RpZmljYXRpb25zW2ldLnR5cGUgPT0gdHlwZSkge1xuICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvbnMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2xlYXIgYWxsIG5vdGlmaWNhdGlvbnNcbiAgICB0aGlzLmNsZWFyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdjbGVhcmluZyBhbGwgbWVzc2FnZXMnKTtcbiAgICAgICAgbm90aWZpY2F0aW9ucyA9IFtdO1xuICAgIH1cblxufSk7XG5cbmFwcC5jb250cm9sbGVyKCdOb3RpZmljYXRpb25Db250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCBub3RpZmljYXRpb25TZXJ2aWNlLCAkdGltZW91dCkge1xuXG4gICAgJHNjb3BlLm5vdGlmaWVyID0gbm90aWZpY2F0aW9uU2VydmljZTtcblxuXG4gICAgJHNjb3BlLiR3YXRjaCgnbm90aWZpZXIuZ2V0KCknLCBmdW5jdGlvbiAobm90aWZpY2F0aW9ucykge1xuICAgICAgICBpZiAoYW5ndWxhci5pc0RlZmluZWQobm90aWZpY2F0aW9ucykpIHtcbiAgICAgICAgICAgICRzY29wZS5ub3RpZmljYXRpb25zID0gbm90aWZpY2F0aW9ucztcbiAgICAgICAgfVxuICAgIH0sIHRydWUpO1xuXG5cbiAgICAkc2NvcGUuY2xvc2VOb3RpZmljYXRpb24gPSBmdW5jdGlvbihpbmRleCkge1xuICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLnJlbW92ZUJ5SW5kZXgoaW5kZXgpO1xuICAgIH07XG5cblxufSk7XG5cbmFwcC5jb250cm9sbGVyKCdEYXNoYm9hcmRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHN0YXRlUGFyYW1zKSB7XG5cblxuXG59KTtcblxuYXBwLmNvbnRyb2xsZXIoJ1Byb2plY3RDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkZmlsdGVyLCBuZ1RhYmxlUGFyYW1zLCAkaHR0cCwgUmVzdGZ1bEFwaSwgbm90aWZpY2F0aW9uU2VydmljZSkge1xuXG4gICAgLy8gSW5pdGlhbGlzZSBhbiBlbXB0eSBhcnJheSB0byBob2xkIGRhdGFcbiAgICAkc2NvcGUuZGF0YSA9IFtdO1xuXG4gICAgLy8gSW5pdGlhbGlzZSB0aGUgZGF0YSB0YWJsZVxuICAgICRzY29wZS50YWJsZVBhcmFtcyA9IG5ldyBuZ1RhYmxlUGFyYW1zKHtcbiAgICAgICAgcGFnZTogMSwgICAgICAgICAgICAvLyBzaG93IGZpcnN0IHBhZ2VcbiAgICAgICAgY291bnQ6IDEwLCAgICAgICAgICAvLyBjb3VudCBwZXIgcGFnZVxuICAgICAgICBzb3J0aW5nOiB7XG4gICAgICAgICAgICB1cGRhdGVkX2F0OiAnZGVzYycgICAgIC8vIGluaXRpYWwgc29ydGluZ1xuICAgICAgICB9LFxuICAgIH0sIHtcbiAgICAgICAgZmlsdGVyRGVsYXk6IDEwLFxuICAgICAgICB0b3RhbDogJHNjb3BlLmRhdGEubGVuZ3RoLCAvLyBsZW5ndGggb2YgZGF0YVxuICAgICAgICBnZXREYXRhOiBmdW5jdGlvbigkZGVmZXIsIHBhcmFtcykge1xuICAgICAgICAgICAgLy8gdXNlIGJ1aWxkLWluIGFuZ3VsYXIgZmlsdGVyXG4gICAgICAgICAgICB2YXIgZmlsdGVyZWREYXRhID0gcGFyYW1zLmZpbHRlcigpID9cbiAgICAgICAgICAgICAgICAgICAgJGZpbHRlcignZmlsdGVyJykoJHNjb3BlLmRhdGEsIHBhcmFtcy5maWx0ZXIoKSkgOlxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YTtcbiAgICAgICAgICAgIHZhciBvcmRlcmVkRGF0YSA9IHBhcmFtcy5zb3J0aW5nKCkgP1xuICAgICAgICAgICAgICAgICAgICAkZmlsdGVyKCdvcmRlckJ5JykoZmlsdGVyZWREYXRhLCBwYXJhbXMub3JkZXJCeSgpKSA6XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhO1xuXG4gICAgICAgICAgICBwYXJhbXMudG90YWwob3JkZXJlZERhdGEubGVuZ3RoKTsgLy8gc2V0IHRvdGFsIGZvciByZWNhbGMgcGFnaW5hdGlvblxuICAgICAgICAgICAgJGRlZmVyLnJlc29sdmUob3JkZXJlZERhdGEuc2xpY2UoKHBhcmFtcy5wYWdlKCkgLSAxKSAqIHBhcmFtcy5jb3VudCgpLCBwYXJhbXMucGFnZSgpICogcGFyYW1zLmNvdW50KCkpKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gSW5pdGlhbGlzZSAobG9hZCkgZGF0YVxuICAgICRzY29wZS5pbml0ID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgJGh0dHAuZ2V0KFJlc3RmdWxBcGkuZ2V0Um91dGUoJ3Byb2plY3QnLCAnaW5kZXgnKSlcbiAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YSA9IGRhdGE7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnRhYmxlUGFyYW1zLnJlbG9hZCgpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICB9O1xuXG5cbiAgICAkc2NvcGUuZGVsZXRlID0gZnVuY3Rpb24oaWQsIHRpdGxlKSB7XG5cbiAgICAgICAgaWYgKGNvbmZpcm0oJ0FyZSB5b3Ugc3VyZSB5b3Ugd2lzaCB0byBkZWxldGUgJyArIHRpdGxlICsgJz8nKSkge1xuXG4gICAgICAgICAgICAkaHR0cC5kZWxldGUoJy9hZG1pbi9hcGkvcHJvamVjdC8nICsgaWQpXG4gICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmFkZChcIlByb2plY3QgJ1wiICsgZGF0YS50aXRsZSArIFwiJyBkZWxldGVkIHN1Y2Nlc3NmdWxseVwiLCAnaW5mbycpO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaW5pdCgpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9ycyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkc2NvcGUuaW5pdCgpO1xuXG59KTtcblxuXG5cbmFwcC5jb250cm9sbGVyKCdQcm9qZWN0Q3JlYXRlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRzdGF0ZVBhcmFtcywgJHN0YXRlLCBSZXN0ZnVsQXBpLCBub3RpZmljYXRpb25TZXJ2aWNlKSB7XG5cbiAgICAkc2NvcGUuZGF0YSA9IHt9O1xuXG4gICAgJHNjb3BlLmNyZWF0ZSA9IHRydWU7XG5cbiAgICAkc2NvcGUuc2F2ZSA9IGZ1bmN0aW9uKGFwcGx5KSB7XG5cbiAgICAgICAgJGh0dHAucG9zdChSZXN0ZnVsQXBpLmdldFJvdXRlKCdwcm9qZWN0JywgJ3N0b3JlJyksICRzY29wZS5kYXRhKVxuICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuYWRkKFwiUHJvamVjdCAnXCIgKyBkYXRhLnRpdGxlICsgXCInIGFkZGVkIHN1Y2Nlc3NmdWxseVwiLCAnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBbXTtcbiAgICAgICAgICAgICAgICBpZiAoIWFwcGx5KSB7XG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbyggXCJwcm9qZWN0LmluZGV4XCIgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXHQgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCBcInByb2plY3QuZWRpdFwiLCB7aWQ6IGRhdGEuaWR9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gZGF0YTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxufSk7XG5cblxuYXBwLmNvbnRyb2xsZXIoJ1Byb2plY3RFZGl0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRzdGF0ZVBhcmFtcywgJHN0YXRlLCBSZXN0ZnVsQXBpLCBub3RpZmljYXRpb25TZXJ2aWNlLCBuZ1RhYmxlUGFyYW1zLCAkZmlsdGVyLCAkbW9kYWwpIHtcblxuICAgICRzY29wZS5kYXRhID0ge1xuICAgICAgICBzZWN0aW9ucyA6IFtdXG4gICAgfTtcblxuICAgICRzY29wZS50YWJsZVBhcmFtcyA9IG5ldyBuZ1RhYmxlUGFyYW1zKHtcbiAgICAgICAgcGFnZTogMSwgICAgICAgICAgICAvLyBzaG93IGZpcnN0IHBhZ2VcbiAgICAgICAgY291bnQ6IDEwLCAgICAgICAgICAvLyBjb3VudCBwZXIgcGFnZVxuICAgICAgICBzb3J0aW5nOiB7XG4gICAgICAgICAgICB1cGRhdGVkX2F0OiAnZGVzYycgICAgIC8vIGluaXRpYWwgc29ydGluZ1xuICAgICAgICB9LFxuICAgIH0sIHtcbiAgICAgICAgZmlsdGVyRGVsYXk6IDEwLFxuICAgICAgICB0b3RhbDogJHNjb3BlLmRhdGEuc2VjdGlvbnMubGVuZ3RoLCAvLyBsZW5ndGggb2YgZGF0YVxuICAgICAgICBnZXREYXRhOiBmdW5jdGlvbigkZGVmZXIsIHBhcmFtcykge1xuICAgICAgICAgICAgLy8gdXNlIGJ1aWxkLWluIGFuZ3VsYXIgZmlsdGVyXG4gICAgICAgICAgICB2YXIgZmlsdGVyZWREYXRhID0gcGFyYW1zLmZpbHRlcigpID9cbiAgICAgICAgICAgICAgICAgICAgJGZpbHRlcignZmlsdGVyJykoJHNjb3BlLmRhdGEuc2VjdGlvbnMsIHBhcmFtcy5maWx0ZXIoKSkgOlxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5zZWN0aW9ucztcbiAgICAgICAgICAgIHZhciBvcmRlcmVkRGF0YSA9IHBhcmFtcy5zb3J0aW5nKCkgP1xuICAgICAgICAgICAgICAgICAgICAkZmlsdGVyKCdvcmRlckJ5JykoZmlsdGVyZWREYXRhLCBwYXJhbXMub3JkZXJCeSgpKSA6XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLnNlY3Rpb25zO1xuXG4gICAgICAgICAgICBwYXJhbXMudG90YWwob3JkZXJlZERhdGEubGVuZ3RoKTsgLy8gc2V0IHRvdGFsIGZvciByZWNhbGMgcGFnaW5hdGlvblxuICAgICAgICAgICAgJGRlZmVyLnJlc29sdmUob3JkZXJlZERhdGEuc2xpY2UoKHBhcmFtcy5wYWdlKCkgLSAxKSAqIHBhcmFtcy5jb3VudCgpLCBwYXJhbXMucGFnZSgpICogcGFyYW1zLmNvdW50KCkpKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG5cbiAgICAkaHR0cC5nZXQoUmVzdGZ1bEFwaS5nZXRSb3V0ZSgncHJvamVjdCcsICdzaG93JywgJHN0YXRlUGFyYW1zLmlkKSlcbiAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgJHNjb3BlLmRhdGEgPSBkYXRhO1xuICAgICAgICAgICAgJHNjb3BlLnNsdWcgPSAkc2NvcGUuZGF0YS5zbHVnO1xuICAgICAgICAgICAgJHNjb3BlLnRhYmxlUGFyYW1zLnJlbG9hZCgpO1xuICAgICAgICB9KVxuICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBkYXRhO1xuICAgICAgICB9KTtcblxuXG5cbiAgICAkc2NvcGUuZWRpdFNlY3Rpb24gPSBmdW5jdGlvbiAoY3JlYXRlLCBzZWN0aW9uSWQpIHtcbiAgICAgICAgc2VjdGlvbklkID0gdHlwZW9mIHNlY3Rpb25JZCAhPT0gJ3VuZGVmaW5lZCcgPyBzZWN0aW9uSWQgOiBmYWxzZTtcblxuICAgICAgICBtb2RhbERhdGEgPSB7XG4gICAgICAgICAgICAnY3JlYXRlJyA6IGNyZWF0ZSxcbiAgICAgICAgICAgICdwcm9qZWN0SWQnIDogJHNjb3BlLmRhdGEuaWQsXG4gICAgICAgICAgICAnc2VjdGlvbklkJyA6IHNlY3Rpb25JZFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnNvbGUubG9nKG1vZGFsRGF0YSk7XG5cbiAgICAgICAgdmFyIG1vZGFsSW5zdGFuY2UgPSAkbW9kYWwub3Blbih7XG4gICAgICAgICAgICBhbmltYXRpb246IHRydWUsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ3NlY3Rpb25FZGl0Lmh0bWwnLFxuICAgICAgICAgICAgY29udHJvbGxlcjogJ2VkaXRTZWN0aW9uQ29udHJvbGxlcicsXG4gICAgICAgICAgICBzaXplOiAnbGcnLFxuICAgICAgICAgICAgcmVzb2x2ZToge1xuICAgICAgICAgICAgICAgIG1vZGFsRGF0YTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtb2RhbERhdGE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChzZWN0aW9uKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnbW9kYWwgY2xvc2VkJyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhzZWN0aW9uKTtcblxuICAgICAgICAgICAgaWYgKGNyZWF0ZSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLnNlY3Rpb25zLnB1c2goc2VjdGlvbik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKCRzY29wZS5kYXRhLnNlY3Rpb25zLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5pZCA9PSBzZWN0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCd1cGRhdGVkIHNlY3Rpb246ICcgKyB2YWx1ZS5pZClcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLnNlY3Rpb25zW2tleV0gPSBzZWN0aW9uXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLmRhdGEuc2VjdGlvbnMpO1xuICAgICAgICAgICAgJHNjb3BlLnRhYmxlUGFyYW1zLnJlbG9hZCgpO1xuICAgICAgICB9KTtcblxuICAgIH07XG5cblxuICAgICRzY29wZS5zbHVnV2FybmluZyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLnJlbW92ZUJ5VHlwZSgnd2FybmluZycpO1xuICAgICAgICBpZiAoJHNjb3BlLnNsdWcgIT0gJHNjb3BlLmRhdGEuc2x1Zykge1xuICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5hZGQoXCJZb3UgaGF2ZSBtb2RpZmllZCB0aGUgcHJvamVjdCBzbHVnLiBQbGVhc2UgYmUgYXdhcmUgdGhhdCB0aGlzIG1heSBicmVhayBoeXBlcmxpbmtzIHRvIHRoaXMgcHJvamVjdC5cIiwgJ3dhcm5pbmcnKTtcbiAgICAgICAgfVxuICAgIH1cblxuXG4gICAgJHNjb3BlLnNhdmUgPSBmdW5jdGlvbihhcHBseSkge1xuICAgICAgICBhcHBseSA9IHR5cGVvZiBhcHBseSAhPT0gJ3VuZGVmaW5lZCcgPyBhcHBseSA6IGZhbHNlO1xuXG4gICAgICAgIGlmICgkc2NvcGUuc2x1ZyAhPSAkc2NvcGUuZGF0YS5zbHVnKSB7XG4gICAgICAgICAgICBpZiAoY29uZmlybSgnQXJlIHlvdSBzdXJlIHlvdSB3aXNoIHRvIGNoYW5nZSB0aGUgc2x1Zz8nKSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5wdXQoYXBwbHkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5zbHVnID0gJHNjb3BlLnNsdWc7XG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5yZW1vdmVCeVR5cGUoJ3dhcm5pbmcnKTtcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmFkZChcIlNsdWcgcmVzZXRcIiwgJ2luZm8nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRzY29wZS5wdXQoYXBwbHkpO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICAkc2NvcGUucHV0ID0gZnVuY3Rpb24oYXBwbHkpIHtcbiAgICAgICAgJGh0dHAucHV0KFJlc3RmdWxBcGkuZ2V0Um91dGUoJ3Byb2plY3QnLCAndXBkYXRlJywgJHN0YXRlUGFyYW1zLmlkKSwgJHNjb3BlLmRhdGEpXG4gICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5hZGQoXCJQcm9qZWN0ICdcIiArIGRhdGEudGl0bGUgKyBcIicgdXBkYXRlZCBzdWNjZXNzZnVsbHlcIiwgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gW107XG4gICAgICAgICAgICAgICAgaWYgKCFhcHBseSkge1xuICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oIFwicHJvamVjdC5pbmRleFwiICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9ycyA9IGRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cblxufSk7XG5cblxuXG5cblxuYXBwLmNvbnRyb2xsZXIoJ2VkaXRTZWN0aW9uQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwLCAkbW9kYWxJbnN0YW5jZSwgUmVzdGZ1bEFwaSwgbm90aWZpY2F0aW9uU2VydmljZSwgbW9kYWxEYXRhKSB7XG5cbiAgICBpZiAoIW1vZGFsRGF0YS5jcmVhdGUpIHtcblxuICAgICAgICAkaHR0cC5nZXQoUmVzdGZ1bEFwaS5nZXRSb3V0ZSgnc2VjdGlvbicsICdzaG93JywgbW9kYWxEYXRhLnNlY3Rpb25JZCkpXG4gICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnNlY3Rpb24gPSBkYXRhO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9ycyA9IGRhdGE7XG4gICAgICAgICAgICB9KTtcblxuICAgIH1cblxuXG4gICAgJHNjb3BlLnNhdmUgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICBjb25zb2xlLmxvZyhtb2RhbERhdGEuY3JlYXRlKTtcblxuICAgICAgICBpZiAobW9kYWxEYXRhLmNyZWF0ZSl7XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjcmVhdGluZycpO1xuXG4gICAgICAgICAgICAkaHR0cC5wb3N0KFJlc3RmdWxBcGkuZ2V0Um91dGUoJ3Byb2plY3RTZWN0aW9uJywgJ3N0b3JlJywgbW9kYWxEYXRhLnByb2plY3RJZCksICRzY29wZS5zZWN0aW9uKVxuICAgICAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5hZGQoXCJTZWN0aW9uICdcIiArIGRhdGEudGl0bGUgKyBcIicgY3JlYXRlZCBzdWNjZXNzZnVsbHlcIiwgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9ycyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAkbW9kYWxJbnN0YW5jZS5jbG9zZShkYXRhKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBkYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdlZGl0aW5nJyk7XG5cbiAgICAgICAgICAgICRodHRwLnB1dChSZXN0ZnVsQXBpLmdldFJvdXRlKCdzZWN0aW9uJywgJ3VwZGF0ZScsICRzY29wZS5zZWN0aW9uLmlkKSwgJHNjb3BlLnNlY3Rpb24pXG4gICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmFkZChcIlNlY3Rpb24gJ1wiICsgZGF0YS50aXRsZSArIFwiJyB1cGRhdGVkIHN1Y2Nlc3NmdWxseVwiLCAnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gW107XG4gICAgICAgICAgICAgICAgICAgICRtb2RhbEluc3RhbmNlLmNsb3NlKGRhdGEpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9ycyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgfTtcblxuICAgICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRtb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xuICAgIH07XG59KTtcblxuYXBwLmNvbnRyb2xsZXIoJ1RhZ0NvbnRyb2xsZXInLCBmdW5jdGlvbigkc2NvcGUsICRmaWx0ZXIsIG5nVGFibGVQYXJhbXMsICRodHRwLCBub3RpZmljYXRpb25TZXJ2aWNlKSB7XG5cbiAgICAvLyBJbml0aWFsaXNlIGFuIGVtcHR5IGFycmF5IHRvIGhvbGQgZGF0YVxuICAgICRzY29wZS5kYXRhID0gW107XG5cbiAgICAvLyBJbml0aWFsaXNlIHRoZSBkYXRhIHRhYmxlXG4gICAgJHNjb3BlLnRhYmxlUGFyYW1zID0gbmV3IG5nVGFibGVQYXJhbXMoe1xuICAgICAgICBwYWdlOiAxLCAgICAgICAgICAgIC8vIHNob3cgZmlyc3QgcGFnZVxuICAgICAgICBjb3VudDogMTAsICAgICAgICAgIC8vIGNvdW50IHBlciBwYWdlXG4gICAgICAgIHNvcnRpbmc6IHtcbiAgICAgICAgICAgIHVwZGF0ZWRfYXQ6ICdkZXNjJyAgICAgLy8gaW5pdGlhbCBzb3J0aW5nXG4gICAgICAgIH0sXG4gICAgfSwge1xuICAgICAgICBmaWx0ZXJEZWxheTogMTAsXG4gICAgICAgIHRvdGFsOiAkc2NvcGUuZGF0YS5sZW5ndGgsIC8vIGxlbmd0aCBvZiBkYXRhXG4gICAgICAgIGdldERhdGE6IGZ1bmN0aW9uKCRkZWZlciwgcGFyYW1zKSB7XG4gICAgICAgICAgICAvLyB1c2UgYnVpbGQtaW4gYW5ndWxhciBmaWx0ZXJcbiAgICAgICAgICAgIHZhciBmaWx0ZXJlZERhdGEgPSBwYXJhbXMuZmlsdGVyKCkgP1xuICAgICAgICAgICAgICAgICRmaWx0ZXIoJ2ZpbHRlcicpKCRzY29wZS5kYXRhLCBwYXJhbXMuZmlsdGVyKCkpIDpcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YTtcbiAgICAgICAgICAgIHZhciBvcmRlcmVkRGF0YSA9IHBhcmFtcy5zb3J0aW5nKCkgP1xuICAgICAgICAgICAgICAgICRmaWx0ZXIoJ29yZGVyQnknKShmaWx0ZXJlZERhdGEsIHBhcmFtcy5vcmRlckJ5KCkpIDpcbiAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YTtcblxuICAgICAgICAgICAgcGFyYW1zLnRvdGFsKG9yZGVyZWREYXRhLmxlbmd0aCk7IC8vIHNldCB0b3RhbCBmb3IgcmVjYWxjIHBhZ2luYXRpb25cbiAgICAgICAgICAgICRkZWZlci5yZXNvbHZlKG9yZGVyZWREYXRhLnNsaWNlKChwYXJhbXMucGFnZSgpIC0gMSkgKiBwYXJhbXMuY291bnQoKSwgcGFyYW1zLnBhZ2UoKSAqIHBhcmFtcy5jb3VudCgpKSk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEluaXRpYWxpc2UgKGxvYWQpIGRhdGFcbiAgICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICRodHRwLmdldCgnL2FwaS90YWcnKVxuICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5kYXRhID0gZGF0YTtcbiAgICAgICAgICAgICAgICAkc2NvcGUudGFibGVQYXJhbXMucmVsb2FkKCk7XG4gICAgICAgICAgICB9KVxuXG4gICAgfTtcblxuXG4gICAgJHNjb3BlLmRlbGV0ZSA9IGZ1bmN0aW9uKGlkLCB0aXRsZSkge1xuXG4gICAgICAgIGlmIChjb25maXJtKCdBcmUgeW91IHN1cmUgeW91IHdpc2ggdG8gZGVsZXRlICcgKyB0aXRsZSArICc/JykpIHtcblxuICAgICAgICAgICAgJGh0dHAuZGVsZXRlKCcvYXBpL3RhZy8nICsgaWQpXG4gICAgICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmFkZChcIlByb2plY3QgJ1wiICsgZGF0YS50aXRsZSArIFwiJyBkZWxldGVkIHN1Y2Nlc3NmdWxseVwiLCAnaW5mbycpO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuaW5pdCgpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9ycyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkc2NvcGUuaW5pdCgpO1xuXG5cbn0pO1xuXG5cbmFwcC5jb250cm9sbGVyKCdUYWdDcmVhdGVDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHN0YXRlUGFyYW1zLCAkc3RhdGUsIG5vdGlmaWNhdGlvblNlcnZpY2UpIHtcblxuICAgICRzY29wZS5kYXRhID0ge307XG5cbiAgICAkc2NvcGUuc2F2ZSA9IGZ1bmN0aW9uKGFwcGx5KSB7XG5cbiAgICAgICAgJGh0dHAucG9zdCgnL2FwaS90YWcnLCAkc2NvcGUuZGF0YSlcbiAgICAgICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmFkZChcIlRhZyAnXCIgKyBkYXRhLnRpdGxlICsgXCInIGFkZGVkIHN1Y2Nlc3NmdWxseVwiLCAnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBbXTtcbiAgICAgICAgICAgICAgICBpZiAoIWFwcGx5KSB7XG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbyggXCJ0YWcuaW5kZXhcIiApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cdCAgICAgICAgICAgICAgICAkc3RhdGUuZ28oIFwidGFnLmVkaXRcIiwge2lkOiBkYXRhLmlkfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9ycyA9IGRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbn0pO1xuXG5cbmFwcC5jb250cm9sbGVyKCdUYWdFZGl0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRzdGF0ZVBhcmFtcywgJHN0YXRlLCBub3RpZmljYXRpb25TZXJ2aWNlLCBuZ1RhYmxlUGFyYW1zLCAkZmlsdGVyLCAkbW9kYWwpIHtcblxuICAgICRzY29wZS5kYXRhID0ge1xuICAgICAgICBwcm9qZWN0czogW11cbiAgICB9O1xuXG5cbiAgICAkc2NvcGUudGFibGVQYXJhbXMgPSBuZXcgbmdUYWJsZVBhcmFtcyh7XG4gICAgICAgIHBhZ2U6IDEsICAgICAgICAgICAgLy8gc2hvdyBmaXJzdCBwYWdlXG4gICAgICAgIGNvdW50OiAxMCwgICAgICAgICAgLy8gY291bnQgcGVyIHBhZ2VcbiAgICAgICAgc29ydGluZzoge1xuICAgICAgICAgICAgdXBkYXRlZF9hdDogJ2Rlc2MnICAgICAvLyBpbml0aWFsIHNvcnRpbmdcbiAgICAgICAgfSxcbiAgICB9LCB7XG4gICAgICAgIGZpbHRlckRlbGF5OiAxMCxcbiAgICAgICAgdG90YWw6ICRzY29wZS5kYXRhLnByb2plY3RzLmxlbmd0aCwgLy8gbGVuZ3RoIG9mIGRhdGFcbiAgICAgICAgZ2V0RGF0YTogZnVuY3Rpb24oJGRlZmVyLCBwYXJhbXMpIHtcbiAgICAgICAgICAgIC8vIHVzZSBidWlsZC1pbiBhbmd1bGFyIGZpbHRlclxuICAgICAgICAgICAgdmFyIGZpbHRlcmVkRGF0YSA9IHBhcmFtcy5maWx0ZXIoKSA/XG4gICAgICAgICAgICAgICAgJGZpbHRlcignZmlsdGVyJykoJHNjb3BlLmRhdGEucHJvamVjdHMsIHBhcmFtcy5maWx0ZXIoKSkgOlxuICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLnByb2plY3RzO1xuICAgICAgICAgICAgdmFyIG9yZGVyZWREYXRhID0gcGFyYW1zLnNvcnRpbmcoKSA/XG4gICAgICAgICAgICAgICAgJGZpbHRlcignb3JkZXJCeScpKGZpbHRlcmVkRGF0YSwgcGFyYW1zLm9yZGVyQnkoKSkgOlxuICAgICAgICAgICAgICAgICRzY29wZS5kYXRhLnByb2plY3RzO1xuXG4gICAgICAgICAgICBwYXJhbXMudG90YWwob3JkZXJlZERhdGEubGVuZ3RoKTsgLy8gc2V0IHRvdGFsIGZvciByZWNhbGMgcGFnaW5hdGlvblxuICAgICAgICAgICAgJGRlZmVyLnJlc29sdmUob3JkZXJlZERhdGEuc2xpY2UoKHBhcmFtcy5wYWdlKCkgLSAxKSAqIHBhcmFtcy5jb3VudCgpLCBwYXJhbXMucGFnZSgpICogcGFyYW1zLmNvdW50KCkpKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG5cbiAgICAkaHR0cC5nZXQoJy9hcGkvdGFnLycgKyAkc3RhdGVQYXJhbXMuaWQpXG4gICAgICAgIC5zdWNjZXNzKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICRzY29wZS5kYXRhID0gZGF0YTtcbiAgICAgICAgICAgICRzY29wZS50YWJsZVBhcmFtcy5yZWxvYWQoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmVycm9yKGZ1bmN0aW9uKGRhdGEpIHtcbiAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBkYXRhO1xuICAgICAgICB9KTtcblxuXG4gICAgJHNjb3BlLnNhdmUgPSBmdW5jdGlvbihhcHBseSkge1xuICAgICAgICBhcHBseSA9IHR5cGVvZiBhcHBseSAhPT0gJ3VuZGVmaW5lZCcgPyBhcHBseSA6IGZhbHNlO1xuXG4gICAgICAgICRodHRwLnB1dCgnL2FwaS90YWcvJyArICRzdGF0ZVBhcmFtcy5pZCwgJHNjb3BlLmRhdGEpXG4gICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5hZGQoXCJUYWcgJ1wiICsgZGF0YS50aXRsZSArIFwiJyB1cGRhdGVkIHN1Y2Nlc3NmdWxseVwiLCAnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBbXTtcbiAgICAgICAgICAgICAgICBpZiAoIWFwcGx5KSB7XG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbyggXCJ0YWcuaW5kZXhcIiApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9ycyA9IGRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICB9O1xuXG59KTtcblxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9