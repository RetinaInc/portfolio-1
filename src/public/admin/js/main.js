var app=angular.module("ng-portfolio",["ui.router","ui.bootstrap","ngTable","hc.marked"]);app.config(function($httpProvider){$httpProvider.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"});app.config(function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/dashboard");$stateProvider.state("dashboard",{url:"/dashboard",templateUrl:"/vendor/portfolio/admin/views/dashboard.html",controller:"DashboardController"}).state("project",{url:"/project",templateUrl:"/vendor/portfolio/admin/views/project/project.html"}).state("project.index",{url:"/index",templateUrl:"/vendor/portfolio/admin/views/project/project.index.html",controller:"ProjectController"}).state("project.create",{url:"/create",templateUrl:"/vendor/portfolio/admin/views/project/project.edit.html",controller:"ProjectCreateController"}).state("project.edit",{url:"/:id/edit",templateUrl:"/vendor/portfolio/admin/views/project/project.edit.html",controller:"ProjectEditController"}).state("project-section",{url:"/project/:id/section",templateUrl:"/vendor/portfolio/admin/views/project/project.section.index.html",controller:"ProjectSectionController"}).state("section-edit",{url:"/section/:id/edit",templateUrl:"/vendor/portfolio/admin/views/section/section.edit.html",controller:"SectionEditController"})});app.config(["markedProvider",function(markedProvider){markedProvider.setOptions({gfm:true,tables:true})}]);app.factory("RestfulApi",function($http,notificationService){var checkResponseCode=function(data,status){switch(status){case 422:notificationService.clear();var msg=[];angular.forEach(data,function(value,key){msg=msg.concat(value)});notificationService.add("Validation failed, please correct the following issues:","danger",msg);break;case 401:notificationService.add("You have been logged out","warning");break;case 500:notificationService.add("API error","danger");break;default:console.log("Some other problem!");console.log(data)}};return{getRoute:function(resource,method,id){if(typeof id==="undefined"){id="0"}var prefix="/admin/api";var routes={project:{index:prefix+"/project",show:prefix+"/project/"+id,store:prefix+"/project",update:prefix+"/project/"+id,destroy:prefix+"/project/"+id},section:{index:prefix+"/section",show:prefix+"/section/"+id,store:prefix+"/section",update:prefix+"/section/"+id,destroy:prefix+"/section/"+id}};return routes[resource][method]},success:function(data,status,headers,config){notificationService.removeByType("danger");return data},error:function(data,status,headers,config){checkResponseCode(data,status);return data}}});app.service("notificationService",function($timeout){var notifications=[];this.get=function(){return notifications};this.add=function(message,type,messages){if(type=="success"){this.removeByType("success")}var notification={type:type,message:message,messages:messages};notifications.push(notification);console.log("added "+type+" message");if(type!="danger"){$timeout(function(){notifications.splice(notifications.indexOf(notification),1)},6e3)}};this.removeByIndex=function(index){console.log("removing one message: "+index);notifications.splice(index,1)};this.removeByType=function(type){console.log("clearing "+type+" messages");for(i=0;i<notifications.length;i++){if(notifications[i].type==type){notifications.splice(i,1)}}};this.clear=function(){console.log("clearing all messages");notifications=[]}});app.controller("NotificationController",function($scope,notificationService,$timeout){$scope.notifier=notificationService;$scope.$watch("notifier.get()",function(notifications){if(angular.isDefined(notifications)){$scope.notifications=notifications}},true);$scope.closeNotification=function(index){notificationService.removeByIndex(index)}});app.controller("DashboardController",function($scope,$http,$stateParams){});app.controller("ProjectController",function($scope,$filter,ngTableParams,$http,RestfulApi,notificationService){$scope.data=[];$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{updated_at:"desc"}},{filterDelay:10,total:$scope.data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data;var orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length);$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}});$scope.init=function(){$http.get(RestfulApi.getRoute("project","index")).success(function(data,status,headers,config){RestfulApi.success(data,status,headers,config);$scope.data=data;$scope.tableParams.reload()}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config)})};$scope.delete=function(id,title){if(confirm("Are you sure you wish to delete "+title+"?")){$http.delete("/admin/api/project/"+id).success(function(data,status,headers,config){notificationService.add("Project '"+data.title+"' deleted successfully","info");$scope.init()}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config);$scope.errors=data})}};$scope.init()});app.controller("ProjectCreateController",function($scope,$http,$stateParams,$state,RestfulApi,notificationService){$scope.data={};$scope.save=function(apply){$http.post(RestfulApi.getRoute("project","store"),$scope.data).success(function(data,status,headers,config){RestfulApi.success(data,status,headers,config);notificationService.add("Project '"+data.title+"' added successfully","success");$scope.errors=[];if(!apply){$state.go("project.index")}else{$state.go("project.edit",{id:data.id})}}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config);$scope.errors=data})}});app.controller("ProjectEditController",function($scope,$http,$stateParams,$state,RestfulApi,notificationService,ngTableParams,$filter,$modal){$scope.data={sections:[]};$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{updated_at:"desc"}},{filterDelay:10,total:$scope.data.sections.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data.sections,params.filter()):$scope.data.sections;var orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data.sections;params.total(orderedData.length);$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}});$http.get(RestfulApi.getRoute("project","show",$stateParams.id)).success(function(data,status,headers,config){RestfulApi.success(data,status,headers,config);$scope.data=data;$scope.slug=$scope.data.slug;$scope.tableParams.reload()}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config);$scope.errors=data});$scope.editSection=function(sectionIndex){var modalInstance=$modal.open({animation:$scope.animationsEnabled,templateUrl:"sectionEdit.html",controller:"editSectionController",size:"lg",resolve:{section:function(){return $scope.data.sections[sectionIndex]}}})};$scope.toggleAnimation=function(){$scope.animationsEnabled=!$scope.animationsEnabled};$scope.slugWarning=function(){notificationService.removeByType("warning");if($scope.slug!=$scope.data.slug){notificationService.add("You have modified the project slug. Please be aware that this may break hyperlinks to this project.","warning")}};$scope.save=function(apply){apply=typeof apply!=="undefined"?apply:false;if($scope.slug!=$scope.data.slug){if(confirm("Are you sure you wish to change the slug?")){$scope.put(apply)}else{$scope.data.slug=$scope.slug;notificationService.removeByType("warning");notificationService.add("Slug reset","info")}}else{$scope.put(apply)}};$scope.put=function(apply){$http.put(RestfulApi.getRoute("project","update",$stateParams.id),$scope.data).success(function(data,status,headers,config){RestfulApi.success(data,status,headers,config);notificationService.add("Project '"+data.title+"' updated successfully","success");$scope.errors=[];if(!apply){$state.go("project.index")}}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config);$scope.errors=data})}});app.controller("editSectionController",function($scope,$http,$modalInstance,RestfulApi,notificationService,section){$scope.section=section;$scope.save=function(apply){$http.put(RestfulApi.getRoute("section","update",$scope.section.id),$scope.section).success(function(data,status,headers,config){RestfulApi.success(data,status,headers,config);notificationService.add("Section '"+data.title+"' updated successfully","success");$scope.errors=[];if(!apply){$modalInstance.close()}}).error(function(data,status,headers,config){RestfulApi.error(data,status,headers,config);$scope.errors=data})};$scope.cancel=function(){$modalInstance.dismiss("cancel")}});app.controller("ProjectSectionController",function($scope,$filter,ngTableParams,$http,$route,$routeParams,$location){$scope.data=[];$scope.tableParams=new ngTableParams({page:1,count:10,sorting:{created_at:"desc"}},{filterDelay:10,total:$scope.data.length,getData:function($defer,params){var filteredData=params.filter()?$filter("filter")($scope.data,params.filter()):$scope.data;var orderedData=params.sorting()?$filter("orderBy")(filteredData,params.orderBy()):$scope.data;params.total(orderedData.length);$defer.resolve(orderedData.slice((params.page()-1)*params.count(),params.page()*params.count()))}});$scope.init=function(){console.log($routeParams.project_id);$http.get("/admin/api/project/"+$routeParams.project_id+"/section").success(function(data,status,headers,config){$scope.data=data;angular.forEach(data,function(data){data.id=parseFloat(data.id)});$scope.tableParams.reload()}).error(function(data,status,headers,config){console.log(status);if(status==401){$scope.errors=[{"Logged out":"You have been logged out. Refresh the page to log back in again"}]}else{$scope.errors=data}})};$scope.delete=function(id){$http.delete("/admin/api/project/"+id).success(function(data,status,headers,config){$scope.init()}).error(function(data,status,headers,config){$scope.errors=data})};$scope.init()});app.controller("SectionCreateController",function($scope,$http,$route,$routeParams,$location){$scope.data={};$scope.save=function(){$http.post("/admin/api/project",$scope.data).success(function(data,status,headers,config){$location.path("/project")}).error(function(data,status,headers,config){if(status==401){$scope.errors=[{"Logged out":"You have been logged out. Refresh the page to log back in again"}]}else{$scope.errors=data}})}});app.controller("SectionEditController",function($scope,$http,$route,$routeParams,$location){$scope.data={};$http.get("/admin/api/section/"+$routeParams.id).success(function(data,status,headers,config){$scope.data=data}).error(function(data,status,headers,config){if(status==401){$scope.errors=[{"Logged out":"You have been logged out. Refresh the page to log back in again"}]}else{$scope.errors=data}});$scope.addSection=function(){$scope.data.sections.push({})};$scope.deleteSection=function(index){$scope.data.sections.splice(index,1)};$scope.save=function(){$http.put("/admin/api/section/"+$routeParams.id,$scope.data).success(function(data,status,headers,config){$location.path("/project/"+data.attachment_id+"/section")}).error(function(data,status,headers,config){if(status==401){$scope.errors=[{"Logged out":"You have been logged out. Refresh the page to log back in again"}]}else{$scope.errors=data}})}});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9wdWJsaWMvYWRtaW4vanMvbWFpbi5qcyJdLCJuYW1lcyI6WyJhcHAiLCJhbmd1bGFyIiwibW9kdWxlIiwiY29uZmlnIiwiJGh0dHBQcm92aWRlciIsImRlZmF1bHRzIiwiaGVhZGVycyIsImNvbW1vbiIsIiRzdGF0ZVByb3ZpZGVyIiwiJHVybFJvdXRlclByb3ZpZGVyIiwib3RoZXJ3aXNlIiwic3RhdGUiLCJ1cmwiLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCJtYXJrZWRQcm92aWRlciIsInNldE9wdGlvbnMiLCJnZm0iLCJ0YWJsZXMiLCJmYWN0b3J5IiwiJGh0dHAiLCJub3RpZmljYXRpb25TZXJ2aWNlIiwiY2hlY2tSZXNwb25zZUNvZGUiLCJkYXRhIiwic3RhdHVzIiwiY2xlYXIiLCJtc2ciLCJmb3JFYWNoIiwidmFsdWUiLCJrZXkiLCJjb25jYXQiLCJhZGQiLCJjb25zb2xlIiwibG9nIiwiZ2V0Um91dGUiLCJyZXNvdXJjZSIsIm1ldGhvZCIsImlkIiwicHJlZml4Iiwicm91dGVzIiwicHJvamVjdCIsImluZGV4Iiwic2hvdyIsInN0b3JlIiwidXBkYXRlIiwiZGVzdHJveSIsInNlY3Rpb24iLCJzdWNjZXNzIiwicmVtb3ZlQnlUeXBlIiwiZXJyb3IiLCJzZXJ2aWNlIiwiJHRpbWVvdXQiLCJub3RpZmljYXRpb25zIiwidGhpcyIsImdldCIsIm1lc3NhZ2UiLCJ0eXBlIiwibWVzc2FnZXMiLCJub3RpZmljYXRpb24iLCJwdXNoIiwic3BsaWNlIiwiaW5kZXhPZiIsInJlbW92ZUJ5SW5kZXgiLCJpIiwibGVuZ3RoIiwiJHNjb3BlIiwibm90aWZpZXIiLCIkd2F0Y2giLCJpc0RlZmluZWQiLCJjbG9zZU5vdGlmaWNhdGlvbiIsIiRzdGF0ZVBhcmFtcyIsIiRmaWx0ZXIiLCJuZ1RhYmxlUGFyYW1zIiwiUmVzdGZ1bEFwaSIsInRhYmxlUGFyYW1zIiwicGFnZSIsImNvdW50Iiwic29ydGluZyIsInVwZGF0ZWRfYXQiLCJmaWx0ZXJEZWxheSIsInRvdGFsIiwiZ2V0RGF0YSIsIiRkZWZlciIsInBhcmFtcyIsImZpbHRlcmVkRGF0YSIsImZpbHRlciIsIm9yZGVyZWREYXRhIiwib3JkZXJCeSIsInJlc29sdmUiLCJzbGljZSIsImluaXQiLCJyZWxvYWQiLCJkZWxldGUiLCJ0aXRsZSIsImNvbmZpcm0iLCJlcnJvcnMiLCIkc3RhdGUiLCJzYXZlIiwiYXBwbHkiLCJwb3N0IiwiZ28iLCIkbW9kYWwiLCJzZWN0aW9ucyIsInNsdWciLCJlZGl0U2VjdGlvbiIsInNlY3Rpb25JbmRleCIsIm1vZGFsSW5zdGFuY2UiLCJvcGVuIiwiYW5pbWF0aW9uIiwiYW5pbWF0aW9uc0VuYWJsZWQiLCJzaXplIiwidG9nZ2xlQW5pbWF0aW9uIiwic2x1Z1dhcm5pbmciLCJwdXQiLCIkbW9kYWxJbnN0YW5jZSIsImNsb3NlIiwiY2FuY2VsIiwiZGlzbWlzcyIsIiRyb3V0ZSIsIiRyb3V0ZVBhcmFtcyIsIiRsb2NhdGlvbiIsImNyZWF0ZWRfYXQiLCJwcm9qZWN0X2lkIiwicGFyc2VGbG9hdCIsIkxvZ2dlZCBvdXQiLCJwYXRoIiwiYWRkU2VjdGlvbiIsImRlbGV0ZVNlY3Rpb24iLCJhdHRhY2htZW50X2lkIl0sIm1hcHBpbmdzIjoiQUFDQSxHQUFJQSxLQUFNQyxRQUFRQyxPQUFPLGdCQUFpQixZQUFhLGVBQWdCLFVBQVcsYUFVbEZGLEtBQUlHLE9BQU8sU0FBU0MsZUFFaEJBLGNBQWNDLFNBQVNDLFFBQVFDLE9BQU8sb0JBQXNCLGtCQUtoRVAsS0FBSUcsT0FBTyxTQUFTSyxlQUFnQkMsb0JBR2xDQSxtQkFBbUJDLFVBQVUsYUFLN0JGLGdCQUNHRyxNQUFNLGFBQ0xDLElBQUssYUFDTEMsWUFBYSwrQ0FDYkMsV0FBWSx3QkFFYkgsTUFBTSxXQUNMQyxJQUFLLFdBQ0xDLFlBQWEsdURBRWRGLE1BQU0saUJBQ0xDLElBQUssU0FDTEMsWUFBYSwyREFDYkMsV0FBWSxzQkFFYkgsTUFBTSxrQkFDTEMsSUFBSyxVQUNMQyxZQUFhLDBEQUNiQyxXQUFZLDRCQUViSCxN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U0FBUzFCLEtBQU1DLE9BQVFsQixRQUFTSCxRQUNsQyxHQUFJcUIsUUFBVSxJQUFLLENBQ2Z5QyxPQUFPOEIsU0FBVzZCLGFBQWUsd0VBQzlCLENBQ0gzRCxPQUFPOEIsT0FBU3hFLE9BSzVCMEMsUUFBTzZELFdBQWEsV0FFaEI3RCxPQUFPMUMsS0FBSytFLFNBQVMzQyxTQUl6Qk0sUUFBTzhELGNBQWdCLFNBQVN0RixPQUU1QndCLE9BQU8xQyxLQUFLK0UsU0FBUzFDLE9BQU9uQixNQUFPLEdBS3ZDd0IsUUFBT2dDLEtBQU8sV0FFVjdFLE1BQU02RixJQUFJLHNCQUF3Qk0sYUFBYWxGLEdBQUk0QixPQUFPMUMsTUFDdER3QixRQUFRLFNBQVN4QixLQUFNQyxPQUFRbEIsUUFBU0gsUUFHcENxSCxVQUFVSyxLQUFNLFlBQWN0RyxLQUFLeUcsY0FBZ0IsY0FFdkQvRSxNQUFNLFNBQVMxQixLQUFNQyxPQUFRbEIsUUFBU0gsUUFDbEMsR0FBSXFCLFFBQVUsSUFBSyxDQUNmeUMsT0FBTzhCLFNBQVc2QixhQUFlLHdFQUM5QixDQUNIM0QsT0FBTzhCLE9BQVN4RSIsImZpbGUiOiJzcmMvcHVibGljL2FkbWluL2pzL21haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBGaXJlIHVwIHRoZSBhcHBcbnZhciBhcHAgPSBhbmd1bGFyLm1vZHVsZSgnbmctcG9ydGZvbGlvJywgWyd1aS5yb3V0ZXInLCAndWkuYm9vdHN0cmFwJywgJ25nVGFibGUnLCAnaGMubWFya2VkJ10pO1xuXG4vLyBDb25maWd1cmUgQW5ndWxhclxuXG4vKiBhcHAuY29uZmlnKGZ1bmN0aW9uKCRpbnRlcnBvbGF0ZVByb3ZpZGVyKSB7XG4gICAgLy8gU2V0IEFuZ3VsYXIgdG8gdXNlIHNxdWFyZS1icmFja2V0cyBpbnN0ZWFkIG9mIGN1cmx5IC0gYSB3b3JrIGFyb3VuZCB0byBwbGF5IG5pY2Ugd2l0aCBMYXJhdmVsIEJsYWRlIHRlbXBsYXRlc1xuICAgICRpbnRlcnBvbGF0ZVByb3ZpZGVyLnN0YXJ0U3ltYm9sKCd7eycpO1xuICAgICRpbnRlcnBvbGF0ZVByb3ZpZGVyLmVuZFN5bWJvbCgnfX0nKTtcbn0pOyAqL1xuXG5hcHAuY29uZmlnKGZ1bmN0aW9uKCRodHRwUHJvdmlkZXIpIHtcbiAgICAvLyBBZGQgdGhlIFhNTEh0dHBSZXF1ZXN0IGhlYWRlciBzbyB0aGF0IExhcmF2ZWwgY2FuIHRlbGwgYXBhcnQgQUpBWCByZXF1ZXN0c1xuICAgICRodHRwUHJvdmlkZXIuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bXCJYLVJlcXVlc3RlZC1XaXRoXCJdID0gXCJYTUxIdHRwUmVxdWVzdFwiO1xufSk7XG5cblxuLy8gU2V0dXAgdGhlIHN0YXRlIG1hbmFnZXIgKFJvdXRlcilcbmFwcC5jb25maWcoZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xuXG4gIC8vIEZvciBhbnkgdW5tYXRjaGVkIHVybCwgcmVkaXJlY3QgdG8gL3N0YXRlMVxuICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKFwiL2Rhc2hib2FyZFwiKTtcblxuICAvLyR1cmxSb3V0ZXJQcm92aWRlci53aGVuKCcvcHJvamVjdCcsICcvcHJvamVjdC9pbmRleCcpO1xuXG4gIC8vIE5vdyBzZXQgdXAgdGhlIHN0YXRlc1xuICAkc3RhdGVQcm92aWRlclxuICAgIC5zdGF0ZSgnZGFzaGJvYXJkJywge1xuICAgICAgdXJsOiBcIi9kYXNoYm9hcmRcIixcbiAgICAgIHRlbXBsYXRlVXJsOiBcIi92ZW5kb3IvcG9ydGZvbGlvL2FkbWluL3ZpZXdzL2Rhc2hib2FyZC5odG1sXCIsXG4gICAgICBjb250cm9sbGVyOiBcIkRhc2hib2FyZENvbnRyb2xsZXJcIlxuICAgIH0pXG4gICAgLnN0YXRlKCdwcm9qZWN0Jywge1xuICAgICAgdXJsOiBcIi9wcm9qZWN0XCIsXG4gICAgICB0ZW1wbGF0ZVVybDogXCIvdmVuZG9yL3BvcnRmb2xpby9hZG1pbi92aWV3cy9wcm9qZWN0L3Byb2plY3QuaHRtbFwiLFxuICAgIH0pXG4gICAgLnN0YXRlKCdwcm9qZWN0LmluZGV4Jywge1xuICAgICAgdXJsOiBcIi9pbmRleFwiLFxuICAgICAgdGVtcGxhdGVVcmw6IFwiL3ZlbmRvci9wb3J0Zm9saW8vYWRtaW4vdmlld3MvcHJvamVjdC9wcm9qZWN0LmluZGV4Lmh0bWxcIixcbiAgICAgIGNvbnRyb2xsZXI6IFwiUHJvamVjdENvbnRyb2xsZXJcIlxuICAgIH0pXG4gICAgLnN0YXRlKCdwcm9qZWN0LmNyZWF0ZScsIHtcbiAgICAgIHVybDogXCIvY3JlYXRlXCIsXG4gICAgICB0ZW1wbGF0ZVVybDogXCIvdmVuZG9yL3BvcnRmb2xpby9hZG1pbi92aWV3cy9wcm9qZWN0L3Byb2plY3QuZWRpdC5odG1sXCIsXG4gICAgICBjb250cm9sbGVyOiBcIlByb2plY3RDcmVhdGVDb250cm9sbGVyXCJcbiAgICB9KVxuICAgIC5zdGF0ZSgncHJvamVjdC5lZGl0Jywge1xuICAgICAgdXJsOiBcIi86aWQvZWRpdFwiLFxuICAgICAgdGVtcGxhdGVVcmw6IFwiL3ZlbmRvci9wb3J0Zm9saW8vYWRtaW4vdmlld3MvcHJvamVjdC9wcm9qZWN0LmVkaXQuaHRtbFwiLFxuICAgICAgY29udHJvbGxlcjogXCJQcm9qZWN0RWRpdENvbnRyb2xsZXJcIlxuICAgIH0pXG4gICAgLnN0YXRlKCdwcm9qZWN0LXNlY3Rpb24nLCB7XG4gICAgICB1cmw6IFwiL3Byb2plY3QvOmlkL3NlY3Rpb25cIixcbiAgICAgIHRlbXBsYXRlVXJsOiBcIi92ZW5kb3IvcG9ydGZvbGlvL2FkbWluL3ZpZXdzL3Byb2plY3QvcHJvamVjdC5zZWN0aW9uLmluZGV4Lmh0bWxcIixcbiAgICAgIGNvbnRyb2xsZXI6IFwiUHJvamVjdFNlY3Rpb25Db250cm9sbGVyXCJcbiAgICB9KVxuICAgIC5zdGF0ZSgnc2VjdGlvbi1lZGl0Jywge1xuICAgICAgdXJsOiBcIi9zZWN0aW9uLzppZC9lZGl0XCIsXG4gICAgICB0ZW1wbGF0ZVVybDogXCIvdmVuZG9yL3BvcnRmb2xpby9hZG1pbi92aWV3cy9zZWN0aW9uL3NlY3Rpb24uZWRpdC5odG1sXCIsXG4gICAgICBjb250cm9sbGVyOiBcIlNlY3Rpb25FZGl0Q29udHJvbGxlclwiXG4gICAgfSk7XG59KTtcblxuXG5hcHAuY29uZmlnKFsnbWFya2VkUHJvdmlkZXInLCBmdW5jdGlvbihtYXJrZWRQcm92aWRlcikge1xuICAgIG1hcmtlZFByb3ZpZGVyLnNldE9wdGlvbnMoe1xuICAgICAgICBnZm06IHRydWUsXG4gICAgICAgIHRhYmxlczogdHJ1ZVxuICAgIH0pO1xufV0pO1xuXG5cbi8vIFNvbWUgaGVscGZ1bCBmdW5jdGlvbnMgZm9yIEFKQVggcmVxdWVzdHNcbmFwcC5mYWN0b3J5KCdSZXN0ZnVsQXBpJywgZnVuY3Rpb24gKCRodHRwLCBub3RpZmljYXRpb25TZXJ2aWNlKSB7XG5cbiAgICAvLyBXb3QgdG8gZG8gaW5jYXNlIEFQSSBmYWlscyB0byByZXNwb25kIHdpdGggMjAwXG4gICAgdmFyIGNoZWNrUmVzcG9uc2VDb2RlID0gZnVuY3Rpb24oZGF0YSwgc3RhdHVzKSB7XG4gICAgICAgIHN3aXRjaChzdGF0dXMpIHtcbiAgICAgICAgICAgIC8vIEZhaWxlZCB2YWxpZGF0aW9uXG4gICAgICAgICAgICBjYXNlIDQyMjpcblxuICAgICAgICAgICAgICAgIC8vIENsZWFyIGFsbCBleGlzdGluZyBub3RpZmljYXRpb25zXG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5jbGVhcigpO1xuXG4gICAgICAgICAgICAgICAgLy8gQ29uY2F0ZW5hdGUgYWxsIHRoZSB2YWxpZGF0aW9uIGVycm9yIG1lc3NhZ2VzXG4gICAgICAgICAgICAgICAgdmFyIG1zZyA9IFtdO1xuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChkYXRhLCBmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIG1zZyA9IG1zZy5jb25jYXQodmFsdWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gQWRkIHRoZSBub3RpZmljYXRpb25cbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmFkZChcIlZhbGlkYXRpb24gZmFpbGVkLCBwbGVhc2UgY29ycmVjdCB0aGUgZm9sbG93aW5nIGlzc3VlczpcIiwgJ2RhbmdlcicsIG1zZyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgIC8vIFVuYXV0aGVudGljYXRlZFxuICAgICAgICAgICAgY2FzZSA0MDE6XG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5hZGQoJ1lvdSBoYXZlIGJlZW4gbG9nZ2VkIG91dCcsICd3YXJuaW5nJyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDUwMDpcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmFkZCgnQVBJIGVycm9yJywgJ2RhbmdlcicpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNvbWUgb3RoZXIgcHJvYmxlbSFcIik7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuXG4gICAgICAgIC8vIFJldHVybnMgdGhlIHN0cmluZyBvZiBhIHBhcnRpY3VsYXIgcm91dGVcbiAgICAgICAgZ2V0Um91dGU6IGZ1bmN0aW9uKHJlc291cmNlLCBtZXRob2QsIGlkKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGlkID09PSAndW5kZWZpbmVkJykgeyBpZCA9ICcwJzsgfVxuXG4gICAgICAgICAgICB2YXIgcHJlZml4ID0gJy9hZG1pbi9hcGknO1xuXG4gICAgICAgICAgICB2YXIgcm91dGVzID0ge1xuICAgICAgICAgICAgICAgIHByb2plY3QgICAgIDogIHtcbiAgICAgICAgICAgICAgICAgICAgaW5kZXggICA6IHByZWZpeCArICcvcHJvamVjdCcsXG4gICAgICAgICAgICAgICAgICAgIHNob3cgICAgOiBwcmVmaXggKyAnL3Byb2plY3QvJyArIGlkLFxuICAgICAgICAgICAgICAgICAgICBzdG9yZSAgIDogcHJlZml4ICsgJy9wcm9qZWN0JyxcbiAgICAgICAgICAgICAgICAgICAgdXBkYXRlICA6IHByZWZpeCArICcvcHJvamVjdC8nICsgaWQsXG4gICAgICAgICAgICAgICAgICAgIGRlc3Ryb3kgOiBwcmVmaXggKyAnL3Byb2plY3QvJyArIGlkXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBzZWN0aW9uICAgICA6ICB7XG4gICAgICAgICAgICAgICAgICAgIGluZGV4ICAgOiBwcmVmaXggKyAnL3NlY3Rpb24nLFxuICAgICAgICAgICAgICAgICAgICBzaG93ICAgIDogcHJlZml4ICsgJy9zZWN0aW9uLycgKyBpZCxcbiAgICAgICAgICAgICAgICAgICAgc3RvcmUgICA6IHByZWZpeCArICcvc2VjdGlvbicsXG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZSAgOiBwcmVmaXggKyAnL3NlY3Rpb24vJyArIGlkLFxuICAgICAgICAgICAgICAgICAgICBkZXN0cm95IDogcHJlZml4ICsgJy9zZWN0aW9uLycgKyBpZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJldHVybiByb3V0ZXNbcmVzb3VyY2VdW21ldGhvZF07XG5cbiAgICAgICAgfSxcblxuICAgICAgICAvLyBEbyBzb21lIHN0dWZmIHVwb24gYSBzdWNjZXNzZnVsIEFqYXggcmVxdWVzdFxuICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5yZW1vdmVCeVR5cGUoJ2RhbmdlcicpO1xuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgIH0sXG4gICAgICAgIC8vIERvIHNvbWUgc3R1ZmYgdXBvbiBhbiB1bnN1Y2Nlc3NmdWwgQWpheCByZXF1ZXN0XG4gICAgICAgIGVycm9yOiBmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgY2hlY2tSZXNwb25zZUNvZGUoZGF0YSwgc3RhdHVzKTtcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICB9XG4gICAgfVxufSk7XG5cblxuYXBwLnNlcnZpY2UoJ25vdGlmaWNhdGlvblNlcnZpY2UnLCBmdW5jdGlvbiAoJHRpbWVvdXQpIHtcblxuICAgIHZhciBub3RpZmljYXRpb25zID0gW107XG5cbiAgICAvLyBSZXRyaWV2ZSBhbGwgbWVzc2FnZXNcbiAgICB0aGlzLmdldCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gbm90aWZpY2F0aW9ucztcbiAgICB9O1xuXG4gICAgLy8gUmVtb3ZlIG5ldyBub3RpZmljYXRpb25cbiAgICB0aGlzLmFkZCA9IGZ1bmN0aW9uKG1lc3NhZ2UsIHR5cGUsIG1lc3NhZ2VzKSB7XG5cbiAgICAgICAgLy8gT25seSBhbGxvdyBvbmUgc3VjY2VzcyBtZXNzYWdlIGF0IGEgdGltZVxuICAgICAgICBpZiAodHlwZSA9PSAnc3VjY2VzcycpIHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlQnlUeXBlKCdzdWNjZXNzJyk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgbm90aWZpY2F0aW9uID0ge1xuICAgICAgICAgICAgdHlwZSA6IHR5cGUsXG4gICAgICAgICAgICBtZXNzYWdlIDogbWVzc2FnZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzIDogbWVzc2FnZXMsXG4gICAgICAgICAgICAvL2FjdGlvbiA6IGFjdGlvblxuICAgICAgICB9O1xuXG4gICAgICAgIG5vdGlmaWNhdGlvbnMucHVzaChub3RpZmljYXRpb24pO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKCdhZGRlZCAnICsgdHlwZSArICcgbWVzc2FnZScpO1xuXG4gICAgICAgIGlmICh0eXBlICE9ICdkYW5nZXInKSB7XG4gICAgICAgICAgICAvLyBTZXQgdGhlIGFsZXJ0IHRvIGJlIHJlbW92ZWQgYWZ0ZXIgYSBkZWxheVxuICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25zLnNwbGljZShub3RpZmljYXRpb25zLmluZGV4T2Yobm90aWZpY2F0aW9uKSwgMSk7XG4gICAgICAgICAgICAgICAgLy8kc2NvcGUuYWxlcnRzLnNwbGljZSgkc2NvcGUuYWxlcnRzLmluZGV4T2YoYWxlcnQpLCAxKTtcbiAgICAgICAgICAgIH0sIDYwMDApOyAvLyBtYXliZSAnfSwgMzAwMCwgZmFsc2UpOycgdG8gYXZvaWQgY2FsbGluZyBhcHBseVxuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgLy8gUmVtb3ZlIG5vdGlmaWNhdGlvbiBieSBhcnJheSBpbmRleFxuICAgIHRoaXMucmVtb3ZlQnlJbmRleCA9IGZ1bmN0aW9uKGluZGV4KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdyZW1vdmluZyBvbmUgbWVzc2FnZTogJyArIGluZGV4KTtcbiAgICAgICAgbm90aWZpY2F0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgIH1cblxuICAgIC8vIFJlbW92ZSBhbGwgbm90aWZpY2F0aW9ucyBvZiB0eXBlXG4gICAgdGhpcy5yZW1vdmVCeVR5cGUgPSBmdW5jdGlvbih0eXBlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdjbGVhcmluZyAnICsgdHlwZSArICcgbWVzc2FnZXMnKTtcbiAgICAgICAgZm9yIChpPTA7IGkgPCBub3RpZmljYXRpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAobm90aWZpY2F0aW9uc1tpXS50eXBlID09IHR5cGUpIHtcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25zLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIENsZWFyIGFsbCBub3RpZmljYXRpb25zXG4gICAgdGhpcy5jbGVhciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBjb25zb2xlLmxvZygnY2xlYXJpbmcgYWxsIG1lc3NhZ2VzJyk7XG4gICAgICAgIG5vdGlmaWNhdGlvbnMgPSBbXTtcbiAgICB9XG5cbn0pO1xuXG5hcHAuY29udHJvbGxlcignTm90aWZpY2F0aW9uQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgbm90aWZpY2F0aW9uU2VydmljZSwgJHRpbWVvdXQpIHtcblxuICAgICRzY29wZS5ub3RpZmllciA9IG5vdGlmaWNhdGlvblNlcnZpY2U7XG5cblxuICAgICRzY29wZS4kd2F0Y2goJ25vdGlmaWVyLmdldCgpJywgZnVuY3Rpb24gKG5vdGlmaWNhdGlvbnMpIHtcbiAgICAgICAgaWYgKGFuZ3VsYXIuaXNEZWZpbmVkKG5vdGlmaWNhdGlvbnMpKSB7XG4gICAgICAgICAgICAkc2NvcGUubm90aWZpY2F0aW9ucyA9IG5vdGlmaWNhdGlvbnM7XG4gICAgICAgIH1cbiAgICB9LCB0cnVlKTtcblxuXG4gICAgJHNjb3BlLmNsb3NlTm90aWZpY2F0aW9uID0gZnVuY3Rpb24oaW5kZXgpIHtcbiAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5yZW1vdmVCeUluZGV4KGluZGV4KTtcbiAgICB9O1xuXG5cbn0pO1xuXG5hcHAuY29udHJvbGxlcignRGFzaGJvYXJkQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRzdGF0ZVBhcmFtcykge1xuXG5cblxufSk7XG5cbmFwcC5jb250cm9sbGVyKCdQcm9qZWN0Q29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGZpbHRlciwgbmdUYWJsZVBhcmFtcywgJGh0dHAsIFJlc3RmdWxBcGksIG5vdGlmaWNhdGlvblNlcnZpY2UpIHtcblxuICAgIC8vIEluaXRpYWxpc2UgYW4gZW1wdHkgYXJyYXkgdG8gaG9sZCBkYXRhXG4gICAgJHNjb3BlLmRhdGEgPSBbXTtcblxuICAgIC8vIEluaXRpYWxpc2UgdGhlIGRhdGEgdGFibGVcbiAgICAkc2NvcGUudGFibGVQYXJhbXMgPSBuZXcgbmdUYWJsZVBhcmFtcyh7XG4gICAgICAgIHBhZ2U6IDEsICAgICAgICAgICAgLy8gc2hvdyBmaXJzdCBwYWdlXG4gICAgICAgIGNvdW50OiAxMCwgICAgICAgICAgLy8gY291bnQgcGVyIHBhZ2VcbiAgICAgICAgc29ydGluZzoge1xuICAgICAgICAgICAgdXBkYXRlZF9hdDogJ2Rlc2MnICAgICAvLyBpbml0aWFsIHNvcnRpbmdcbiAgICAgICAgfSxcbiAgICB9LCB7XG4gICAgICAgIGZpbHRlckRlbGF5OiAxMCxcbiAgICAgICAgdG90YWw6ICRzY29wZS5kYXRhLmxlbmd0aCwgLy8gbGVuZ3RoIG9mIGRhdGFcbiAgICAgICAgZ2V0RGF0YTogZnVuY3Rpb24oJGRlZmVyLCBwYXJhbXMpIHtcbiAgICAgICAgICAgIC8vIHVzZSBidWlsZC1pbiBhbmd1bGFyIGZpbHRlclxuICAgICAgICAgICAgdmFyIGZpbHRlcmVkRGF0YSA9IHBhcmFtcy5maWx0ZXIoKSA/XG4gICAgICAgICAgICAgICAgICAgICRmaWx0ZXIoJ2ZpbHRlcicpKCRzY29wZS5kYXRhLCBwYXJhbXMuZmlsdGVyKCkpIDpcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGE7XG4gICAgICAgICAgICB2YXIgb3JkZXJlZERhdGEgPSBwYXJhbXMuc29ydGluZygpID9cbiAgICAgICAgICAgICAgICAgICAgJGZpbHRlcignb3JkZXJCeScpKGZpbHRlcmVkRGF0YSwgcGFyYW1zLm9yZGVyQnkoKSkgOlxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YTtcblxuICAgICAgICAgICAgcGFyYW1zLnRvdGFsKG9yZGVyZWREYXRhLmxlbmd0aCk7IC8vIHNldCB0b3RhbCBmb3IgcmVjYWxjIHBhZ2luYXRpb25cbiAgICAgICAgICAgICRkZWZlci5yZXNvbHZlKG9yZGVyZWREYXRhLnNsaWNlKChwYXJhbXMucGFnZSgpIC0gMSkgKiBwYXJhbXMuY291bnQoKSwgcGFyYW1zLnBhZ2UoKSAqIHBhcmFtcy5jb3VudCgpKSk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEluaXRpYWxpc2UgKGxvYWQpIGRhdGFcbiAgICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIC8vY29uc29sZS5sb2coUmVzdGZ1bEFwaS5nZXRSb3V0ZSgncHJvamVjdCcsICd1cGRhdGUnLCA0KSk7XG5cbiAgICAgICAgJGh0dHAuZ2V0KFJlc3RmdWxBcGkuZ2V0Um91dGUoJ3Byb2plY3QnLCAnaW5kZXgnKSkuXG4gICAgICAgIHN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgIFJlc3RmdWxBcGkuc3VjY2VzcyhkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZyk7XG4gICAgICAgICAgICAkc2NvcGUuZGF0YSA9IGRhdGE7XG4gICAgICAgICAgICAkc2NvcGUudGFibGVQYXJhbXMucmVsb2FkKCk7XG4gICAgICAgIH0pLlxuICAgICAgICBlcnJvcihmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgUmVzdGZ1bEFwaS5lcnJvcihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZyk7XG4gICAgICAgIH0pO1xuXG4gICAgfTtcblxuXG4gICAgJHNjb3BlLmRlbGV0ZSA9IGZ1bmN0aW9uKGlkLCB0aXRsZSkge1xuXG4gICAgICAgIGlmIChjb25maXJtKCdBcmUgeW91IHN1cmUgeW91IHdpc2ggdG8gZGVsZXRlICcgKyB0aXRsZSArICc/JykpIHtcblxuICAgICAgICAgICAgJGh0dHAuZGVsZXRlKCcvYWRtaW4vYXBpL3Byb2plY3QvJyArIGlkKS5cbiAgICAgICAgICAgICAgICBzdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuYWRkKFwiUHJvamVjdCAnXCIgKyBkYXRhLnRpdGxlICsgXCInIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5XCIsICdpbmZvJyk7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5pbml0KCk7XG4gICAgICAgICAgICAgICAgfSkuXG4gICAgICAgICAgICAgICAgZXJyb3IoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgICAgICAgICAgUmVzdGZ1bEFwaS5lcnJvcihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZyk7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBkYXRhO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgJHNjb3BlLmluaXQoKTtcblxuXG59KTtcblxuXG5cbmFwcC5jb250cm9sbGVyKCdQcm9qZWN0Q3JlYXRlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRzdGF0ZVBhcmFtcywgJHN0YXRlLCBSZXN0ZnVsQXBpLCBub3RpZmljYXRpb25TZXJ2aWNlKSB7XG5cbiAgICAkc2NvcGUuZGF0YSA9IHt9O1xuXG4gICAgJHNjb3BlLnNhdmUgPSBmdW5jdGlvbihhcHBseSkge1xuXG4gICAgICAgICRodHRwLnBvc3QoUmVzdGZ1bEFwaS5nZXRSb3V0ZSgncHJvamVjdCcsICdzdG9yZScpLCAkc2NvcGUuZGF0YSkuXG4gICAgICAgICAgICBzdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgUmVzdGZ1bEFwaS5zdWNjZXNzKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKTtcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmFkZChcIlByb2plY3QgJ1wiICsgZGF0YS50aXRsZSArIFwiJyBhZGRlZCBzdWNjZXNzZnVsbHlcIiwgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gW107XG4gICAgICAgICAgICAgICAgaWYgKCFhcHBseSkge1xuICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oIFwicHJvamVjdC5pbmRleFwiICk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblx0ICAgICAgICAgICAgICAgICRzdGF0ZS5nbyggXCJwcm9qZWN0LmVkaXRcIiwge2lkOiBkYXRhLmlkfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkuXG4gICAgICAgICAgICBlcnJvcihmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgICAgIFJlc3RmdWxBcGkuZXJyb3IoZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpO1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBkYXRhO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG59KTtcblxuXG5hcHAuY29udHJvbGxlcignUHJvamVjdEVkaXRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHN0YXRlUGFyYW1zLCAkc3RhdGUsIFJlc3RmdWxBcGksIG5vdGlmaWNhdGlvblNlcnZpY2UsIG5nVGFibGVQYXJhbXMsICRmaWx0ZXIsICRtb2RhbCkge1xuXG4gICAgJHNjb3BlLmRhdGEgPSB7XG4gICAgICAgIHNlY3Rpb25zIDogW11cbiAgICB9O1xuXG5cbiAgICAkc2NvcGUudGFibGVQYXJhbXMgPSBuZXcgbmdUYWJsZVBhcmFtcyh7XG4gICAgICAgIHBhZ2U6IDEsICAgICAgICAgICAgLy8gc2hvdyBmaXJzdCBwYWdlXG4gICAgICAgIGNvdW50OiAxMCwgICAgICAgICAgLy8gY291bnQgcGVyIHBhZ2VcbiAgICAgICAgc29ydGluZzoge1xuICAgICAgICAgICAgdXBkYXRlZF9hdDogJ2Rlc2MnICAgICAvLyBpbml0aWFsIHNvcnRpbmdcbiAgICAgICAgfSxcbiAgICB9LCB7XG4gICAgICAgIGZpbHRlckRlbGF5OiAxMCxcbiAgICAgICAgdG90YWw6ICRzY29wZS5kYXRhLnNlY3Rpb25zLmxlbmd0aCwgLy8gbGVuZ3RoIG9mIGRhdGFcbiAgICAgICAgZ2V0RGF0YTogZnVuY3Rpb24oJGRlZmVyLCBwYXJhbXMpIHtcbiAgICAgICAgICAgIC8vIHVzZSBidWlsZC1pbiBhbmd1bGFyIGZpbHRlclxuICAgICAgICAgICAgdmFyIGZpbHRlcmVkRGF0YSA9IHBhcmFtcy5maWx0ZXIoKSA/XG4gICAgICAgICAgICAgICAgICAgICRmaWx0ZXIoJ2ZpbHRlcicpKCRzY29wZS5kYXRhLnNlY3Rpb25zLCBwYXJhbXMuZmlsdGVyKCkpIDpcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGEuc2VjdGlvbnM7XG4gICAgICAgICAgICB2YXIgb3JkZXJlZERhdGEgPSBwYXJhbXMuc29ydGluZygpID9cbiAgICAgICAgICAgICAgICAgICAgJGZpbHRlcignb3JkZXJCeScpKGZpbHRlcmVkRGF0YSwgcGFyYW1zLm9yZGVyQnkoKSkgOlxuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZGF0YS5zZWN0aW9ucztcblxuICAgICAgICAgICAgcGFyYW1zLnRvdGFsKG9yZGVyZWREYXRhLmxlbmd0aCk7IC8vIHNldCB0b3RhbCBmb3IgcmVjYWxjIHBhZ2luYXRpb25cbiAgICAgICAgICAgICRkZWZlci5yZXNvbHZlKG9yZGVyZWREYXRhLnNsaWNlKChwYXJhbXMucGFnZSgpIC0gMSkgKiBwYXJhbXMuY291bnQoKSwgcGFyYW1zLnBhZ2UoKSAqIHBhcmFtcy5jb3VudCgpKSk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuXG5cblxuICAgICRodHRwLmdldChSZXN0ZnVsQXBpLmdldFJvdXRlKCdwcm9qZWN0JywgJ3Nob3cnLCAkc3RhdGVQYXJhbXMuaWQpKS5cbiAgICAgICAgc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgUmVzdGZ1bEFwaS5zdWNjZXNzKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKTtcbiAgICAgICAgICAgICRzY29wZS5kYXRhID0gZGF0YTtcbiAgICAgICAgICAgICRzY29wZS5zbHVnID0gJHNjb3BlLmRhdGEuc2x1ZztcbiAgICAgICAgICAgICRzY29wZS50YWJsZVBhcmFtcy5yZWxvYWQoKTtcbiAgICAgICAgfSkuXG4gICAgICAgIGVycm9yKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICBSZXN0ZnVsQXBpLmVycm9yKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKTtcbiAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBkYXRhO1xuICAgICAgICB9KTtcblxuXG4vKlxuICAgICRzY29wZS5hZGRTZWN0aW9uID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgJHNjb3BlLmRhdGEuc2VjdGlvbnMucHVzaCh7fSk7XG5cbiAgICB9O1xuXG4gICAgJHNjb3BlLmRlbGV0ZVNlY3Rpb24gPSBmdW5jdGlvbihpbmRleCkge1xuXG4gICAgICAgICRzY29wZS5kYXRhLnNlY3Rpb25zLnNwbGljZShpbmRleCwgMSk7XG5cbiAgICB9O1xuKi9cblxuXG4kc2NvcGUuZWRpdFNlY3Rpb24gPSBmdW5jdGlvbiAoc2VjdGlvbkluZGV4KSB7XG5cbiAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICRtb2RhbC5vcGVuKHtcbiAgICAgIGFuaW1hdGlvbjogJHNjb3BlLmFuaW1hdGlvbnNFbmFibGVkLFxuICAgICAgdGVtcGxhdGVVcmw6ICdzZWN0aW9uRWRpdC5odG1sJyxcbiAgICAgIGNvbnRyb2xsZXI6ICdlZGl0U2VjdGlvbkNvbnRyb2xsZXInLFxuICAgICAgc2l6ZTogJ2xnJyxcbiAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgc2VjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiAkc2NvcGUuZGF0YS5zZWN0aW9uc1tzZWN0aW9uSW5kZXhdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbi8qXG4gICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAkc2NvcGUuc2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW07XG4gICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgLy8kbG9nLmluZm8oJ01vZGFsIGRpc21pc3NlZCBhdDogJyArIG5ldyBEYXRlKCkpO1xuICAgIH0pO1xuKi9cbiAgfTtcblxuICAkc2NvcGUudG9nZ2xlQW5pbWF0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICRzY29wZS5hbmltYXRpb25zRW5hYmxlZCA9ICEkc2NvcGUuYW5pbWF0aW9uc0VuYWJsZWQ7XG4gIH07XG5cblxuXG5cbiAgICAkc2NvcGUuc2x1Z1dhcm5pbmcgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5yZW1vdmVCeVR5cGUoJ3dhcm5pbmcnKTtcbiAgICAgICAgaWYgKCRzY29wZS5zbHVnICE9ICRzY29wZS5kYXRhLnNsdWcpIHtcbiAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UuYWRkKFwiWW91IGhhdmUgbW9kaWZpZWQgdGhlIHByb2plY3Qgc2x1Zy4gUGxlYXNlIGJlIGF3YXJlIHRoYXQgdGhpcyBtYXkgYnJlYWsgaHlwZXJsaW5rcyB0byB0aGlzIHByb2plY3QuXCIsICd3YXJuaW5nJyk7XG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgICRzY29wZS5zYXZlID0gZnVuY3Rpb24oYXBwbHkpIHtcbiAgICAgICAgYXBwbHkgPSB0eXBlb2YgYXBwbHkgIT09ICd1bmRlZmluZWQnID8gYXBwbHkgOiBmYWxzZTtcblxuICAgICAgICBpZiAoJHNjb3BlLnNsdWcgIT0gJHNjb3BlLmRhdGEuc2x1Zykge1xuICAgICAgICAgICAgaWYgKGNvbmZpcm0oJ0FyZSB5b3Ugc3VyZSB5b3Ugd2lzaCB0byBjaGFuZ2UgdGhlIHNsdWc/JykpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUucHV0KGFwcGx5KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmRhdGEuc2x1ZyA9ICRzY29wZS5zbHVnO1xuICAgICAgICAgICAgICAgIG5vdGlmaWNhdGlvblNlcnZpY2UucmVtb3ZlQnlUeXBlKCd3YXJuaW5nJyk7XG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5hZGQoXCJTbHVnIHJlc2V0XCIsICdpbmZvJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkc2NvcGUucHV0KGFwcGx5KTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG4gICAgJHNjb3BlLnB1dCA9IGZ1bmN0aW9uKGFwcGx5KSB7XG4gICAgICAgICAgICAkaHR0cC5wdXQoUmVzdGZ1bEFwaS5nZXRSb3V0ZSgncHJvamVjdCcsICd1cGRhdGUnLCAkc3RhdGVQYXJhbXMuaWQpLCAkc2NvcGUuZGF0YSkuXG4gICAgICAgICAgICBzdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgUmVzdGZ1bEFwaS5zdWNjZXNzKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKTtcbiAgICAgICAgICAgICAgICBub3RpZmljYXRpb25TZXJ2aWNlLmFkZChcIlByb2plY3QgJ1wiICsgZGF0YS50aXRsZSArIFwiJyB1cGRhdGVkIHN1Y2Nlc3NmdWxseVwiLCAnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBbXTtcbiAgICAgICAgICAgICAgICBpZiAoIWFwcGx5KSB7XG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbyggXCJwcm9qZWN0LmluZGV4XCIgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS5cbiAgICAgICAgICAgIGVycm9yKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgUmVzdGZ1bEFwaS5lcnJvcihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZyk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9ycyA9IGRhdGE7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cblxufSk7XG5cblxuXG5cblxuYXBwLmNvbnRyb2xsZXIoJ2VkaXRTZWN0aW9uQ29udHJvbGxlcicsIGZ1bmN0aW9uICgkc2NvcGUsICRodHRwLCAkbW9kYWxJbnN0YW5jZSwgUmVzdGZ1bEFwaSwgbm90aWZpY2F0aW9uU2VydmljZSwgc2VjdGlvbikge1xuXG4gICAgJHNjb3BlLnNlY3Rpb24gPSBzZWN0aW9uO1xuXG4gICAgJHNjb3BlLnNhdmUgPSBmdW5jdGlvbihhcHBseSkge1xuXG4gICAgICAgICRodHRwLnB1dChSZXN0ZnVsQXBpLmdldFJvdXRlKCdzZWN0aW9uJywgJ3VwZGF0ZScsICRzY29wZS5zZWN0aW9uLmlkKSwgJHNjb3BlLnNlY3Rpb24pXG4gICAgICAgICAgICAuc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgICAgIFJlc3RmdWxBcGkuc3VjY2VzcyhkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZyk7XG4gICAgICAgICAgICAgICAgbm90aWZpY2F0aW9uU2VydmljZS5hZGQoXCJTZWN0aW9uICdcIiArIGRhdGEudGl0bGUgKyBcIicgdXBkYXRlZCBzdWNjZXNzZnVsbHlcIiwgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gW107XG4gICAgICAgICAgICAgICAgaWYgKCFhcHBseSkge1xuICAgICAgICAgICAgICAgICAgICAkbW9kYWxJbnN0YW5jZS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZXJyb3IoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgICAgICBSZXN0ZnVsQXBpLmVycm9yKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gZGF0YTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgfTtcblxuICAgICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICRtb2RhbEluc3RhbmNlLmRpc21pc3MoJ2NhbmNlbCcpO1xuICAgIH07XG59KTtcblxuYXBwLmNvbnRyb2xsZXIoJ1Byb2plY3RTZWN0aW9uQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGZpbHRlciwgbmdUYWJsZVBhcmFtcywgJGh0dHAsICRyb3V0ZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24pIHtcblxuICAgICRzY29wZS5kYXRhID0gW107XG5cbiAgICAvLyBJbml0aWFsaXNlIHRoZSBkYXRhIHRhYmxlXG4gICAgJHNjb3BlLnRhYmxlUGFyYW1zID0gbmV3IG5nVGFibGVQYXJhbXMoe1xuICAgICAgICBwYWdlOiAxLCAgICAgICAgICAgIC8vIHNob3cgZmlyc3QgcGFnZVxuICAgICAgICBjb3VudDogMTAsICAgICAgICAgIC8vIGNvdW50IHBlciBwYWdlXG4gICAgICAgIHNvcnRpbmc6IHtcbiAgICAgICAgICAgIGNyZWF0ZWRfYXQ6ICdkZXNjJyAgICAgLy8gaW5pdGlhbCBzb3J0aW5nXG4gICAgICAgIH0sXG4gICAgfSwge1xuICAgICAgICBmaWx0ZXJEZWxheTogMTAsXG4gICAgICAgIHRvdGFsOiAkc2NvcGUuZGF0YS5sZW5ndGgsIC8vIGxlbmd0aCBvZiBkYXRhXG4gICAgICAgIGdldERhdGE6IGZ1bmN0aW9uKCRkZWZlciwgcGFyYW1zKSB7XG4gICAgICAgICAgICAvLyB1c2UgYnVpbGQtaW4gYW5ndWxhciBmaWx0ZXJcbiAgICAgICAgICAgIHZhciBmaWx0ZXJlZERhdGEgPSBwYXJhbXMuZmlsdGVyKCkgP1xuICAgICAgICAgICAgICAgICAgICAkZmlsdGVyKCdmaWx0ZXInKSgkc2NvcGUuZGF0YSwgcGFyYW1zLmZpbHRlcigpKSA6XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5kYXRhO1xuICAgICAgICAgICAgdmFyIG9yZGVyZWREYXRhID0gcGFyYW1zLnNvcnRpbmcoKSA/XG4gICAgICAgICAgICAgICAgICAgICRmaWx0ZXIoJ29yZGVyQnknKShmaWx0ZXJlZERhdGEsIHBhcmFtcy5vcmRlckJ5KCkpIDpcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmRhdGE7XG5cbiAgICAgICAgICAgIHBhcmFtcy50b3RhbChvcmRlcmVkRGF0YS5sZW5ndGgpOyAvLyBzZXQgdG90YWwgZm9yIHJlY2FsYyBwYWdpbmF0aW9uXG4gICAgICAgICAgICAkZGVmZXIucmVzb2x2ZShvcmRlcmVkRGF0YS5zbGljZSgocGFyYW1zLnBhZ2UoKSAtIDEpICogcGFyYW1zLmNvdW50KCksIHBhcmFtcy5wYWdlKCkgKiBwYXJhbXMuY291bnQoKSkpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAkc2NvcGUuaW5pdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIGNvbnNvbGUubG9nKCRyb3V0ZVBhcmFtcy5wcm9qZWN0X2lkKTtcblxuICAgICAgICAkaHR0cC5nZXQoJy9hZG1pbi9hcGkvcHJvamVjdC8nICsgJHJvdXRlUGFyYW1zLnByb2plY3RfaWQgKyAnL3NlY3Rpb24nKS5cbiAgICAgICAgc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgJHNjb3BlLmRhdGEgPSBkYXRhO1xuXG4gICAgICAgICAgICAvLyBQYXJzZSBJRCBmcm9tIHRleHQgdG8gaW50ZWdlclxuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGRhdGEsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5pZCAgPSBwYXJzZUZsb2F0KGRhdGEuaWQpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICRzY29wZS50YWJsZVBhcmFtcy5yZWxvYWQoKTtcblxuICAgICAgICB9KS5cbiAgICAgICAgZXJyb3IoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHN0YXR1cyk7XG4gICAgICAgICAgICBpZiAoc3RhdHVzID09IDQwMSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvcnMgPSBbe1wiTG9nZ2VkIG91dFwiIDogXCJZb3UgaGF2ZSBiZWVuIGxvZ2dlZCBvdXQuIFJlZnJlc2ggdGhlIHBhZ2UgdG8gbG9nIGJhY2sgaW4gYWdhaW5cIn1dO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gZGF0YTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgIH07XG5cblxuICAgICRzY29wZS5kZWxldGUgPSBmdW5jdGlvbihpZCkge1xuXG4gICAgICAgICRodHRwLmRlbGV0ZSgnL2FkbWluL2FwaS9wcm9qZWN0LycgKyBpZCkuXG4gICAgICAgICAgc3VjY2VzcyhmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgICAgICRzY29wZS5pbml0KCk7XG4gICAgICAgICAgfSkuXG4gICAgICAgICAgZXJyb3IoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gZGF0YTtcbiAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAkc2NvcGUuaW5pdCgpO1xuXG59KTtcblxuXG5cbmFwcC5jb250cm9sbGVyKCdTZWN0aW9uQ3JlYXRlQ29udHJvbGxlcicsIGZ1bmN0aW9uKCRzY29wZSwgJGh0dHAsICRyb3V0ZSwgJHJvdXRlUGFyYW1zLCAkbG9jYXRpb24pIHtcblxuICAgICRzY29wZS5kYXRhID0ge307XG5cbiAgICAkc2NvcGUuc2F2ZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICRodHRwLnBvc3QoJy9hZG1pbi9hcGkvcHJvamVjdCcsICRzY29wZS5kYXRhKS5cbiAgICAgICAgICAgIHN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCggXCIvcHJvamVjdFwiICk7XG4gICAgICAgICAgICB9KS5cbiAgICAgICAgICAgIGVycm9yKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PSA0MDEpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9ycyA9IFt7XCJMb2dnZWQgb3V0XCIgOiBcIllvdSBoYXZlIGJlZW4gbG9nZ2VkIG91dC4gUmVmcmVzaCB0aGUgcGFnZSB0byBsb2cgYmFjayBpbiBhZ2FpblwifV07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmVycm9ycyA9IGRhdGE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG59KTtcblxuXG5hcHAuY29udHJvbGxlcignU2VjdGlvbkVkaXRDb250cm9sbGVyJywgZnVuY3Rpb24oJHNjb3BlLCAkaHR0cCwgJHJvdXRlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbikge1xuXG4gICAgJHNjb3BlLmRhdGEgPSB7fTtcblxuICAgICRodHRwLmdldCgnL2FkbWluL2FwaS9zZWN0aW9uLycgKyAkcm91dGVQYXJhbXMuaWQpLlxuICAgICAgICBzdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG4gICAgICAgICAgICAkc2NvcGUuZGF0YSA9IGRhdGE7XG4gICAgICAgIH0pLlxuICAgICAgICBlcnJvcihmdW5jdGlvbihkYXRhLCBzdGF0dXMsIGhlYWRlcnMsIGNvbmZpZykge1xuICAgICAgICAgICAgaWYgKHN0YXR1cyA9PSA0MDEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gW3tcIkxvZ2dlZCBvdXRcIiA6IFwiWW91IGhhdmUgYmVlbiBsb2dnZWQgb3V0LiBSZWZyZXNoIHRoZSBwYWdlIHRvIGxvZyBiYWNrIGluIGFnYWluXCJ9XTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9ycyA9IGRhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG5cbiAgICAkc2NvcGUuYWRkU2VjdGlvbiA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICRzY29wZS5kYXRhLnNlY3Rpb25zLnB1c2goe30pO1xuXG4gICAgfTtcblxuICAgICRzY29wZS5kZWxldGVTZWN0aW9uID0gZnVuY3Rpb24oaW5kZXgpIHtcblxuICAgICAgICAkc2NvcGUuZGF0YS5zZWN0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xuXG4gICAgfTtcblxuXG4gICAgJHNjb3BlLnNhdmUgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAkaHR0cC5wdXQoJy9hZG1pbi9hcGkvc2VjdGlvbi8nICsgJHJvdXRlUGFyYW1zLmlkLCAkc2NvcGUuZGF0YSkuXG4gICAgICAgICAgICBzdWNjZXNzKGZ1bmN0aW9uKGRhdGEsIHN0YXR1cywgaGVhZGVycywgY29uZmlnKSB7XG5cblxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCBcIi9wcm9qZWN0L1wiICsgZGF0YS5hdHRhY2htZW50X2lkICsgXCIvc2VjdGlvblwiKTtcbiAgICAgICAgICAgIH0pLlxuICAgICAgICAgICAgZXJyb3IoZnVuY3Rpb24oZGF0YSwgc3RhdHVzLCBoZWFkZXJzLCBjb25maWcpIHtcbiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09IDQwMSkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gW3tcIkxvZ2dlZCBvdXRcIiA6IFwiWW91IGhhdmUgYmVlbiBsb2dnZWQgb3V0LiBSZWZyZXNoIHRoZSBwYWdlIHRvIGxvZyBiYWNrIGluIGFnYWluXCJ9XTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JzID0gZGF0YTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbn0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9